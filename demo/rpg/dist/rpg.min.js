System.registerDynamic("games/demo.js",[],!0,function(e,t,n){"use strict";this||self;Object.defineProperty(t,"__esModule",{value:!0}),t.Game1=void 0;var o=function(){function e(){}return e.prototype.onInit=function(e){console.log("on game init: "+e.name),console.log("screen size: "+e.width+"x"+e.height)},e.prototype.sortObjects=function(e){e.zOrder=e.y},e}();t.Game1=o}),System.registerDynamic("scenes/battle1/battle1.js",[],!0,function(e,t,n){"use strict";this||self;Object.defineProperty(t,"__esModule",{value:!0}),t.Scene1=void 0;var o=function(){function e(){this.scene=null,this.path=[]}return e.prototype.onInit=function(e){console.log("on scene init: "+e.name)},e.prototype.onActivate=function(e){this.scene=e,console.log("on scene activate: "+e.name)},e.prototype.onPointerdown=function(e,t){var n=t.data.getLocalPosition(e.components.display.object);console.log("scene onPointerdown: "+e.name+" - x="+n.x+" , y="+n.y)},e.prototype.onUpdate=function(e){},e}();t.Scene1=o}),System.registerDynamic("scenes/battle1/sprites/plot-enemy-fight.js",[],!0,function(e,t,n){"use strict";this||self;var o=t&&t.__generator||function(e,t){var n,o,i,s,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(i=2&s[0]?o.return:s[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,s[1])).done)return i;switch(o=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,o=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(!(i=(i=r.trys).length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){r=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){r.label=s[1];break}if(6===s[0]&&r.label<i[1]){r.label=i[1],i=s;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(s);break}i[2]&&r.ops.pop(),r.trys.pop();continue}s=t.call(e,r)}catch(e){s=[6,e],o=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.PlotEnemyFight=void 0;var i=function(){function e(){}return e.prototype.onUpdate=function(e){var t,n,i,s,r,a,l,c,p,u,g,y,f,h;return o(this,function(o){switch(o.label){case 0:return t=e.scene,n=t.sys("tween"),i=t.sys("motion"),t.game.get("rpg"),console.log("plot started - "+e.name),s=t.spr("enemy1"),r=s.get("display").object,a=t.spr("fighter1"),l=a.get("display").object,c=a.get("display").animation,p=t.spr("effect1"),u=p.get("display").object,g=p.get("display").animation,y=t.spr("num1"),f=y.get("display").object,i.moveTo(s,r.x+50,r.y,10,function(){return e.plot.signal()}),[4,e.plot.wait()];case 1:return o.sent(),c.reset("hurt",!0),c.onComplete=function(){return e.plot.signal("end1")},c.play(!1),p.active=!0,u.x=l.x,u.y=l.y,u.loop=!1,u.animationSpeed=.4,g.reset("style3",!0),g.onComplete=function(){e.plot.signal("end2"),g.reset(),g.onComplete=null,p.active=!1},g.play(!1),t.game.lib("audio").sounds["rpg-fight3"].play(),[4,e.plot.wait(["end1","end2"])];case 2:return o.sent(),h=Math.floor(50*Math.random())+50,y.active=!0,f.x=l.x,f.y=l.y-30,f.alpha=.8,f.text="-"+h.toString(),f.style.fontSize=28,f.style.fill="#ff0000",n.get(f).to({y:l.y-40,alpha:1},500).to({y:l.y-50,alpha:0},500).call(function(){f.active=!1}),i.moveTo(a,l.x+20,l.y,5,function(){i.moveTo(a,l.x-20,l.y,5,function(){e.plot.signal("end1")})}),[4,e.plot.wait("end1")];case 3:return o.sent(),c.reset("stand",!0),c.onComplete=null,c.play(!0),i.moveTo(s,r.x-50,r.y,10,function(){return e.plot.signal("end2")}),[4,e.plot.wait("end2")];case 4:return o.sent(),[4,e.plot.wait(1e3)];case 5:return o.sent(),console.log("plot ended - "+e.name),e.active=!1,t.spr("plot-menu").active=!0,[2]}})},e}();t.PlotEnemyFight=i}),System.registerDynamic("scenes/battle1/sprites/plot-fight.js",[],!0,function(e,t,n){"use strict";this||self;var o=t&&t.__generator||function(e,t){var n,o,i,s,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(i=2&s[0]?o.return:s[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,s[1])).done)return i;switch(o=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,o=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(!(i=(i=r.trys).length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){r=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){r.label=s[1];break}if(6===s[0]&&r.label<i[1]){r.label=i[1],i=s;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(s);break}i[2]&&r.ops.pop(),r.trys.pop();continue}s=t.call(e,r)}catch(e){s=[6,e],o=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.PlotFight=void 0;var i=function(){function e(){}return e.prototype.onUpdate=function(e){var t,n,i,s,r,a,l,c,p,u,g,y,f,h,m;return o(this,function(o){switch(o.label){case 0:return t=e.scene,n=t.sys("tween"),i=t.sys("motion"),t.game.get("rpg"),console.log("plot started - "+e.name),s=t.spr("fighter1"),r=s.get("display").object,a=s.get("display").animation,l=t.spr("enemy1"),c=l.get("display").object,p=l.get("rpg"),u=t.spr("effect1"),g=u.get("display").object,y=u.get("display").animation,f=t.spr("num1"),h=f.get("display").object,i.moveTo(s,r.x-50,r.y,10,function(){return e.plot.signal()}),[4,e.plot.wait()];case 1:return o.sent(),a.reset("fight",!0),a.onComplete=function(){return e.plot.signal("end1")},a.play(!1),u.active=!0,g.x=c.x,g.y=c.y,g.loop=!1,g.animationSpeed=.4,y.reset("style2",!0),y.onComplete=function(){e.plot.signal("end2"),y.reset(),y.onComplete=null,u.active=!1},y.play(!1),t.game.lib("audio").sounds["rpg-fight1"].play(),c.tint=16742263,[4,e.plot.wait(["end1","end2"])];case 2:return o.sent(),m=Math.floor(150*Math.random())+100,p.hp-=m,f.active=!0,h.x=c.x,h.y=c.y-80,h.alpha=.8,h.text="-"+m.toString(),h.style.fontSize=28,h.style.fill="#ff0000",n.get(h).to({y:c.y-90,alpha:1},500).to({y:c.y-100,alpha:0},500).call(function(){h.active=!1}),i.moveTo(l,c.x-20,c.y,5,function(){i.moveTo(l,c.x+20,c.y,5,function(){c.tint=16777215,e.plot.signal("end1")})}),a.reset("stand",!0),a.onComplete=null,a.play(!0),[4,e.plot.wait("end1")];case 3:return o.sent(),p.hp<=0&&(n.blink(c,1200,10,function(){l.active=!1,e.plot.signal("end1")}),t.game.lib("audio").sounds["enemy-cry"].play()),i.moveTo(s,r.x+50,r.y,10,function(){return e.plot.signal("end2")}),p.hp<=0?[4,e.plot.wait(["end1","end2"])]:[3,5];case 4:return o.sent(),[3,8];case 5:return[4,e.plot.wait("end2")];case 6:return o.sent(),[4,e.plot.wait(1e3)];case 7:o.sent(),o.label=8;case 8:return console.log("plot ended - "+e.name),e.active=!1,p.hp<=0?t.spr("plot-win").active=!0:t.spr("plot-enemy-fight").active=!0,[2]}})},e}();t.PlotFight=i}),System.registerDynamic("scenes/battle1/sprites/plot-menu.js",[],!0,function(e,t,n){"use strict";this||self;var o=t&&t.__generator||function(e,t){var n,o,i,s,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(i=2&s[0]?o.return:s[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,s[1])).done)return i;switch(o=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,o=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(!(i=(i=r.trys).length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){r=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){r.label=s[1];break}if(6===s[0]&&r.label<i[1]){r.label=i[1],i=s;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(s);break}i[2]&&r.ops.pop(),r.trys.pop();continue}s=t.call(e,r)}catch(e){s=[6,e],o=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.PlotMenu=void 0;var i=function(){function e(){}return e.prototype.onUpdate=function(e){var t,n,i,s;return o(this,function(o){switch(o.label){case 0:return t=e.scene,t.sys("tween"),t.sys("motion"),t.game.get("rpg"),n=t.get("rpg"),console.log("plot started - "+e.name),[4,e.plot.wait(100)];case 1:o.sent(),(i=t.spr("list-box1").code).show(e,["Attack","Magic","Items","Defend","Escape"]),console.log("Please select an item"),o.label=2;case 2:return[4,e.plot.wait()];case 3:return o.sent(),console.log("Selected - "+i.selected),1==i.selected?(i.cleanup(),n.previous=e.name,t.spr("plot-select-enemy").active=!0,[3,4]):5==i.selected?(i.close(),console.log("Okay... you selected to give up"),[3,4]):(console.log("Please select a correct item"),[3,2]);case 4:if(console.log("plot ended - "+e.name),e.active=!1,5==i.selected){if((s=e.scene.systems.transition).isWorking())return[2];t.game.lib("audio").musics["rpg-battle"].stop(),s.callScene(t.game.get("rpg").lastmap)}return[2]}})},e}();t.PlotMenu=i}),System.registerDynamic("scenes/battle1/sprites/plot-select-enemy.js",[],!0,function(e,t,n){"use strict";this||self;var o=t&&t.__generator||function(e,t){var n,o,i,s,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(i=2&s[0]?o.return:s[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,s[1])).done)return i;switch(o=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,o=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(!(i=(i=r.trys).length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){r=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){r.label=s[1];break}if(6===s[0]&&r.label<i[1]){r.label=i[1],i=s;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(s);break}i[2]&&r.ops.pop(),r.trys.pop();continue}s=t.call(e,r)}catch(e){s=[6,e],o=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.PlotSelectEnemy=void 0;var i=function(){function e(){}return e.prototype.onUpdate=function(e){var t,n,i,s;return o(this,function(o){switch(o.label){case 0:t=e.scene,t.sys("tween"),t.sys("motion"),t.game.get("rpg"),n=t.get("rpg"),console.log("plot started - "+e.name),i=t.spr("list-box1").code,(s=[]).push.apply(s,n.enemyTeam),s.push("Go Back"),i.show(e,s),console.log("Please select an enemy"),o.label=1;case 1:return[4,e.plot.wait()];case 2:return o.sent(),console.log("Selected - "+i.selected),1==i.selected?(i.close(),n.fighter="fighter1",n.target="enemy1",t.spr("plot-fight").active=!0,[3,3]):i.selected==s.length?(i.cleanup(),t.spr(n.previous).active=!0,[3,3]):(console.log("Please select a correct enemy"),[3,1]);case 3:return e.active=!1,[2]}})},e}();t.PlotSelectEnemy=i}),System.registerDynamic("scenes/battle1/sprites/plot-win.js",[],!0,function(e,t,n){"use strict";this||self;var o=t&&t.__generator||function(e,t){var n,o,i,s,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(i=2&s[0]?o.return:s[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,s[1])).done)return i;switch(o=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,o=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(!(i=(i=r.trys).length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){r=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){r.label=s[1];break}if(6===s[0]&&r.label<i[1]){r.label=i[1],i=s;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(s);break}i[2]&&r.ops.pop(),r.trys.pop();continue}s=t.call(e,r)}catch(e){s=[6,e],o=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.PlotWin=void 0;var i=function(){function e(){}return e.prototype.onUpdate=function(e){var t,n,i,s;return o(this,function(o){switch(o.label){case 0:return t=e.scene,t.sys("tween"),t.sys("motion"),t.game.get("rpg"),console.log("plot started - "+e.name),n=t.spr("fighter1"),n.get("display").object,(i=n.get("display").animation).reset("win",!0),i.onComplete=null,i.play(!0),t.game.lib("audio").musics["rpg-battle"].stop(),t.game.lib("audio").sounds["rpg-win2"].play(),[4,e.plot.wait(4500)];case 1:return o.sent(),console.log("plot ended - "+e.name),e.active=!1,(s=e.scene.systems.transition).isWorking()?[2]:(s.callScene("map1"),[2])}})},e}();t.PlotWin=i}),System.registerDynamic("scenes/dialog/sprites/answer-box1.js",[],!0,function(e,t,n){"use strict";this||self;Object.defineProperty(t,"__esModule",{value:!0}),t.SceneDialogSpriteAnswerBox1=void 0;var o=function(){function e(){this.selected=0,this.answering=!1,this.textRelativeX=50,this.textRelativeY=20,this.iconRelativeX=30,this.iconRelativeY=28}return e.prototype.show=function(e,t,n,o,i){void 0===n&&(n=150),void 0===o&&(o=40),void 0===i&&(i=80);var s=e.scene,r=s.sprites["dialog-msg1"];r&&r.custom&&(r.custom.more=!1,r.custom.history="");var a=e.scene.sprites["dialog-box1"];a&&a.custom&&(a.custom.status="wait");for(var l=0,c=n,p=o,u=0,g=t;u<g.length;u++){var y=g[u];l++;var f=s.getFreeSprite("answer-box1"),h=s.getFreeSprite("answer-msg1"),m=f.get("display").object,d=h.get("display").object;if(m.x=c,m.y=p,f.custom||(f.custom={}),f.custom.flag=l,f.active=!0,d.x=c+this.textRelativeX,d.y=p+this.textRelativeY,d.text=y,h.active=!0,1==l){var v=s.sprites["answer-icon1"];v.custom||(v.custom={}),v.custom.flag=l;var b=v.get("display").object;b.x=c+this.iconRelativeX,b.y=p+this.iconRelativeY,v.active=!0}p+=i}this.answering=!0},e.prototype.close=function(){for(var e=this.owner,t=0,n=e.scene.pools["answer-box1"];t<n.length;t++){(s=n[t]).active=!1,s.custom&&(s.custom.flag=0)}for(var o=0,i=e.scene.pools["answer-msg1"];o<i.length;o++){var s;(s=i[o]).active=!1}var r=e.scene.sprites["answer-icon1"];r.custom.flag=0,r.active=!1,this.answering=!1},e.prototype.getChoice=function(){return this.selected},e.prototype.isAnswering=function(){return this.answering},e.prototype.moveCursorTo=function(e){if(e&&e.active){var t=e.scene.sprites["answer-icon1"];if(t&&t.active){var n=t.get("display").object,o=e,i=o.get("display").object;n.x=i.x+this.iconRelativeX,n.y=i.y+this.iconRelativeY,t.custom.flag=o.custom.flag}}},e.prototype.moveCursor=function(e){void 0===e&&(e="down");var t=this.owner,n=t.scene.sprites["answer-icon1"];if(n&&n.active){var o=0;if("down"==e?o++:"up"==e&&o--,0!=o){for(var i=0,s=0,r=0,a=0,l=0,c=t.scene.pools["answer-box1"];l<c.length;l++){var p=c[l];if(p.active&&p.custom&&p.custom.flag>0){i++;var u=p.get("display").object;1==i&&(r=u.y+this.iconRelativeY),2==i&&(s=u.y-a),a=u.y}}a+=this.iconRelativeY;var g=n.get("display").object;if(o<0)(y=g.y-s)<r?(y=a,g.y=y,n.custom.flag=i):(g.y=y,n.custom.flag-=1);else if(o>0){var y;(y=g.y+s)>a?(y=r,g.y=y,n.custom.flag=1):(g.y=y,n.custom.flag+=1)}}}},e.prototype.selectAnswer=function(e){var t=e&&e.custom?e.custom.flag:0;this.selected=t,this.close();var n=e.scene.sprites["dialog-msg1"];n&&n.code.onDisplayDone(!1);var o=e.scene.sprites["dialog-box1"];o&&o.code.next()},e.prototype.onPointerdown=function(e,t){this.moveCursorTo(e)},e.prototype.onPointerup=function(e,t){this.selectAnswer(e)},e}();t.SceneDialogSpriteAnswerBox1=o}),System.registerDynamic("scenes/dialog/sprites/dialog-box1.js",[],!0,function(e,t,n){"use strict";this||self;Object.defineProperty(t,"__esModule",{value:!0}),t.SceneDialogSpriteDialogBox1=void 0;var o=function(){function e(){this.minHeight=60}return e.prototype.open=function(e,t,n,o,i,s){void 0===o&&(o=50),void 0===i&&(i=!1),void 0===s&&(s="#FFFFFF");var r=e.game,a=e.scene.sys("tween"),l=e.scene.sprites["dialog-box1"],c=e.scene.sprites["dialog-msg1"],p=e.scene.sprites["dialog-speaker1"],u=e.scene.sprites["dialog-icon1"];if(l&&c&&u){var g=l.active,y=l.get("display").object;g||(y.x=(r.get("display").width-y.width)/2,y.y=r.get("display").height-y.height),l.custom||(l.custom={},y&&(l.custom.posY=y.y,l.custom.maxH=y.height,l.custom.minH=this.minHeight)),c.custom||(c.custom={}),l.custom.status="open",l.custom.plot=e.name,p&&(p.get("display").object.text=t||""),c.code.prepareCurrent(n,i,s);var f=!g&&a&&y&&l.custom.posY&&l.custom.maxH&&l.custom.minH;f&&(y.y=l.custom.posY+(l.custom.maxH-l.custom.minH)/2,y.height=l.custom.minH),l.active=!0,c.active=c.code.history.length>0,p&&(p.active=c.active),u.active=!1,f?a.get(y).to({y:l.custom.posY,height:l.custom.maxH},120).call(function(){c.active=!0,c.code.updateText(o,i),p&&(p.active=c.active)}):(c.active=!0,p&&(p.active=c.active),e.scene.timeout(150,function(){return c.code.updateText(o,i)}))}},e.prototype.next=function(){var e=this.owner,t=e.scene.sprites["dialog-box1"],n=e.scene.sprites["dialog-msg1"],o=t&&t.custom?t.custom.status:"";if("done"==o||"more"==o){t.custom.more?n.code.appendHistory():n.code.clearHistory();var i=e.scene.sprites[t.custom.plot];i&&i.plot.signal()}else"open"==o&&n&&n.code.enableCurrent()},e.prototype.close=function(e){void 0===e&&(e=!0);var t=this.owner,n=t.scene.sys("tween"),o=t.scene.sprites["dialog-box1"],i=t.scene.sprites["dialog-speaker1"],s=t.scene.sprites["dialog-msg1"],r=t.scene.sprites["dialog-icon1"];if(o&&s&&r){s.active=!1,i&&(i.active=s.active),r.active=!1,s.code.disableCurrent();var a=o.active,l=o.get("display").object;if(a&&n&&l&&o.custom.posY&&o.custom.maxH&&o.custom.minH&&e)n.get(l).to({y:o.custom.posY+(o.custom.maxH-o.custom.minH)/2,height:o.custom.minH},120).call(function(){o.active=!1,l.y=o.custom.posY,l.height=o.custom.maxH;var e=t.scene.sys("rpg-map");e&&e.stopNpcWaiting(t.scene)});else o.active=!1,(c=t.scene.sys("rpg-map"))&&c.stopNpcWaiting(t.scene)}else{var c;(c=t.scene.sys("rpg-map"))&&c.stopNpcWaiting(t.scene)}},e.prototype.isAnswering=function(){var e=this.owner.scene.spr("answer-box1").code;return e&&e.isAnswering()},e.prototype.getChoice=function(){var e=this.owner.scene.spr("answer-box1").code;return e?e.getChoice():0},e.prototype.moveCursor=function(e){var t=this.owner.scene.spr("answer-box1").code;t&&t.moveCursor(e)},e.prototype.selectAnswer=function(){var e=this.owner,t=e.scene.spr("answer-icon1"),n=e.scene.spr("answer-box1").code;n&&t&&n.selectAnswer(t)},e.prototype.clearHistory=function(){var e=this.owner.scene.spr("dialog-msg1").code;e&&e.clearHistory()},e.prototype.list=function(e,t,n,o,i){void 0===n&&(n=150),void 0===o&&(o=40),void 0===i&&(i=80);var s=e.scene.spr("answer-box1").code;s&&s.show(e,t,n,o,i)},e.prototype.onPointerup=function(e,t){this.next()},e}();t.SceneDialogSpriteDialogBox1=o}),System.registerDynamic("scenes/dialog/sprites/dialog-icon1.js",[],!0,function(e,t,n){"use strict";this||self;Object.defineProperty(t,"__esModule",{value:!0}),t.SceneDialogSpriteDialogIcon1=void 0;var o=function(){function e(){}return e.prototype.onActivate=function(e){var t=e.scene.sprites["dialog-box1"];t&&t.active&&e.scene.timeout(500,function(){e.active=!1,e.scene.timeout(300,function(){e.active=t.active&&"done"==t.custom.status})})},e}();t.SceneDialogSpriteDialogIcon1=o}),System.registerDynamic("scenes/dialog/sprites/dialog-msg1.js",[],!0,function(e,t,n){"use strict";this||self;Object.defineProperty(t,"__esModule",{value:!0}),t.SceneDialogSpriteDialogMsg1=void 0;var o=function(){function e(){this.history=[],this.current=[],this.defaultX=35,this.defaultY=45,this.lineHeight=20}return e.prototype.prepareCurrent=function(e,t,n){for(var o=this.owner,i=this.defaultX,s=this.defaultY,r=0,a=this.current;r<a.length;r++){(g=a[r]).spr.active=!1}for(var l=0;l<this.history.length;l++){if((g=this.history[l]).spr.active=!0,g.spr.nline)i=this.defaultX,s+=this.lineHeight;else{var c=PIXI.TextMetrics.measureText(g.content,g.spr.get("display").object.style);i=this.defaultX+c.width}}this.current=[];for(l=0;l<e.length;l++){var p=e[l],u=o.scene.getFreeSprite("dialog-msg1"),g={spr:u,content:p,nline:l!=e.length-1||!t};u.get("display").object.text="",u.get("display").object.style.fill=n,u.get("display").object.x=i,u.get("display").object.y=s,u.active=!0,i=this.defaultX,s+=this.lineHeight,this.current.push(g)}},e.prototype.disableCurrent=function(){for(var e=0,t=this.current;e<t.length;e++){var n=t[e];n.spr.active=!1,n.spr.get("display").object.text=""}},e.prototype.enableCurrent=function(){for(var e=0,t=this.current;e<t.length;e++){var n=t[e];n.spr.active=!0,n.spr.get("display").object.text=n.content}},e.prototype.appendHistory=function(){var e;(e=this.history).push.apply(e,this.current)},e.prototype.clearHistory=function(){for(var e=0,t=this.history;e<t.length;e++){t[e].spr.active=!1}this.history=[]},e.prototype.updateText=function(e,t){var n=this;void 0===e&&(e=50),void 0===t&&(t=!1);var o=e;(!o||o<1)&&(o=1),o>100&&(o=100);for(var i=this.owner,s=0;s<this.current.length;s++){var r=this.current[s];if(r.spr){r.spr.active||(r.spr.active=!0);var a=r.spr.get("display").object.text.length;if(r.content.length>a){r.spr.get("display").object.text=r.content.substr(0,a+1),r.spr.scene.timeout(100/o*10,function(){return n.updateText(o,t)});break}if(r.content.length==a){if(s<this.current.length-1)continue;i.scene.sprites["dialog-box1"].custom.more=t,this.onDisplayDone()}}}},e.prototype.onDisplayDone=function(e){void 0===e&&(e=!0);var t=this.owner,n=t.scene.sprites["dialog-box1"],o=t.scene.sprites["dialog-icon1"];n&&o&&(n.custom&&n.custom.more?(n.custom.status="more",n.code.next()):(e&&(o.active=!0),n.custom.status="done"))},e}();t.SceneDialogSpriteDialogMsg1=o}),System.registerDynamic("scenes/info/sprites/fps1.js",[],!0,function(e,t,n){"use strict";this||self;Object.defineProperty(t,"__esModule",{value:!0}),t.SceneInfoSpriteFps1=void 0;var o=function(){function e(){}return e.prototype.onSceneActivate=function(e){var t=e.scene.get("display").bgcolor;console.log(t),e.get("display").object.style.fill="#ffffff"==t?"#000000":"#ffffff"},e}();t.SceneInfoSpriteFps1=o}),System.registerDynamic("scenes/list/sprites/list-box1.js",[],!0,function(e,t,n){"use strict";this||self;Object.defineProperty(t,"__esModule",{value:!0}),t.SceneListSpriteListBox1=void 0;var o=function(){function e(){this.plotName="",this.selected=0,this.listing=!1,this.textRelativeX=50,this.textRelativeY=10,this.iconRelativeX=30,this.iconRelativeY=18}return e.prototype.show=function(e,t,n,o,i,s){void 0===n&&(n=260),void 0===o&&(o=40),void 0===i&&(i=180),void 0===s&&(s=30);var r=e.scene,a=e.game.lib("audio"),l=0,c=n,p=o,u=e.scene.sprites["list-box1"];if(u){var g=u.get("display").object;g.x=c,g.y=p,g.width=i,t&&t.length>0&&(g.height=s*(t.length+2)-s/2),u.active||a.sounds["menu-popup"].play(),u.active=!0}p+=s/2;for(var y=0,f=t;y<f.length;y++){var h=f[y];l++;var m=r.getFreeSprite("list-item1"),d=r.getFreeSprite("list-label1"),v=m.get("display").object,b=d.get("display").object;if(v.x=c,v.y=p,m.custom||(m.custom={}),m.custom.flag=l,m.active=!0,b.x=c+this.textRelativeX,b.y=p+this.textRelativeY,b.text=h,d.active=!0,1==l){var w=r.sprites["list-cursor1"];w.custom||(w.custom={}),w.custom.flag=l;var x=w.get("display").object;x.x=c+this.iconRelativeX,x.y=p+this.iconRelativeY,w.active=!0}p+=s}this.plotName=e.name,this.listing=!0},e.prototype.cleanup=function(){for(var e=this.owner,t=0,n=e.scene.pools["list-item1"];t<n.length;t++){(s=n[t]).active=!1,s.custom&&(s.custom.flag=0)}for(var o=0,i=e.scene.pools["list-label1"];o<i.length;o++){var s;(s=i[o]).active=!1}var r=e.scene.sprites["list-cursor1"];r.custom&&(r.custom.flag=0),r.active=!1,this.plotName&&(this.plotName="")},e.prototype.close=function(){this.cleanup(),this.owner.scene.sprites["list-box1"].active=!1,this.listing=!1},e.prototype.getChoice=function(){return this.selected},e.prototype.isListing=function(){return this.listing},e.prototype.moveCursorTo=function(e){if(e&&e.active){var t=e.scene.sprites["list-cursor1"];if(t&&t.active){var n=t.get("display").object,o=e,i=o.get("display").object;n.x=i.x+this.iconRelativeX,n.y=i.y+this.iconRelativeY,t.custom.flag=o.custom.flag}}},e.prototype.moveCursor=function(e){void 0===e&&(e="down");var t=this.owner,n=t.scene.sprites["list-cursor1"];if(n&&n.active){var o=0;if("down"==e?o++:"up"==e&&o--,0!=o){for(var i=0,s=0,r=0,a=0,l=0,c=t.scene.pools["list-item1"];l<c.length;l++){var p=c[l];if(p.active&&p.custom&&p.custom.flag>0){i++;var u=p.get("display").object;1==i&&(r=u.y+this.iconRelativeY),2==i&&(s=u.y-a),a=u.y}}a+=this.iconRelativeY;var g=n.get("display").object;if(o<0)(y=g.y-s)<r?(y=a,g.y=y,n.custom.flag=i):(g.y=y,n.custom.flag-=1);else if(o>0){var y;(y=g.y+s)>a?(y=r,g.y=y,n.custom.flag=1):(g.y=y,n.custom.flag+=1)}t.game.lib("audio").sounds["move-cursor"].play()}}},e.prototype.selectItem=function(e){void 0===e&&(e=null);var t=e;t||(t=this.owner.scene.sprites["list-cursor1"]);var n=t&&t.custom?t.custom.flag:0;this.selected=n,t&&this.plotName&&t.scene.sprites[this.plotName].plot.signal(),t&&t.game.lib("audio").sounds["menu-select"].play(),console.log("ListBox1 - onPointerup",t.name,this.selected)},e.prototype.onPointerup=function(e,t){},e}();t.SceneListSpriteListBox1=o}),System.registerDynamic("scenes/list/sprites/list-item1.js",[],!0,function(e,t,n){"use strict";this||self;Object.defineProperty(t,"__esModule",{value:!0}),t.SceneListSpriteItem1=void 0;var o=function(){function e(){}return e.prototype.onPointerdown=function(e,t){var n=e.scene.sprites["list-box1"];n&&n.code.moveCursorTo(e)},e.prototype.onPointerup=function(e,t){var n=e.scene.sprites["list-box1"];n&&n.code.selectItem(e)},e}();t.SceneListSpriteItem1=o}),System.registerDynamic("scenes/map1/map1.js",[],!0,function(e,t,n){"use strict";this||self;Object.defineProperty(t,"__esModule",{value:!0}),t.Scene1=void 0;var o=function(){function e(){this.sceneName=null,this.path=[]}return e.prototype.onInit=function(e){console.log("on scene init: "+e.name)},e.prototype.onActivate=function(e){this.sceneName=e.name;var t=e.get("rpg");console.log("on scene activate: "+e.name+" ("+t.times+")");var n=e.game.lib("audio").musics[t.bgm];n.volume=1,n.play()},e.prototype.onUpdate=function(e){},e}();t.Scene1=o}),System.registerDynamic("scenes/map1/sprites/lightmap1.js",[],!0,function(e,t,n){"use strict";this||self;Object.defineProperty(t,"__esModule",{value:!0}),t.SpriteLightMap1=void 0;var o=function(){function e(){}return e.prototype.onSceneActivate=function(t){var n=t.get("display").object.filters;(!n||n.length<=0)&&(e.filter=new PIXI.Filter(null,e.shaderFrag4Sprite,{stagePos:new PIXI.Point,spritePos:new PIXI.Point}),t.get("display").object.filters=[e.filter])},e.prototype.onUpdate=function(t){var n=t.scene.get("rpg"),o=n?t.scene.spr(n.player):null;if(o){var i=new PIXI.Point(t.scene.get("stage").x,t.scene.get("stage").y),s=new PIXI.Point(o.get("stage").x,o.get("stage").y);e.filter.uniforms.stagePos.copyFrom(i),e.filter.uniforms.spritePos.copyFrom(s)}},e.shaderFrag4Mouse="\n        precision highp float;\n\n        varying vec2 vTextureCoord;\n\n        uniform vec2 mouse;\n        uniform vec4 inputSize;\n        uniform vec4 outputFrame;\n        uniform sampler2D uSampler;\n\n        void main() {\n            vec4 color = texture2D(uSampler, vTextureCoord);\n            vec2 screenPos = vTextureCoord * inputSize.xy + outputFrame.xy;\n            float dist = distance(mouse, screenPos);\n            float rv = 64.0;\n            if (dist <= rv) {\n                float av = color.a - (rv - dist) / rv;\n                if (av > 1.0) av = 1.0;\n                if (av < 0.0) av = 0.0;\n                gl_FragColor = vec4(color.r, color.g, color.b, av);\n            } else {\n                gl_FragColor = color;\n            }\n        }\n    ",e.shaderFrag4Sprite="\n        precision highp float;\n\n        varying vec2 vTextureCoord;\n\n        uniform vec2 stagePos;\n        uniform vec2 spritePos;\n        uniform vec4 inputSize;\n        uniform vec4 outputFrame;\n        uniform sampler2D uSampler;\n\n        void main() {\n            vec4 color = texture2D(uSampler, vTextureCoord);\n            vec2 pointPos = vTextureCoord * inputSize.xy + outputFrame.xy + stagePos;\n            float dist = distance(pointPos, spritePos);\n            float rv = 64.0;\n            if (dist <= rv) {\n                float av = color.a - (rv - dist) / rv;\n                if (av > 1.0) av = 1.0;\n                if (av < 0.0) av = 0.0;\n                gl_FragColor = vec4(color.r, color.g, color.b, av);\n            } else {\n                gl_FragColor = color;\n            }\n        }\n    ",e}();t.SpriteLightMap1=o}),System.registerDynamic("scenes/map1/sprites/npc1.js",[],!0,function(e,t,n){"use strict";this||self;Object.defineProperty(t,"__esModule",{value:!0}),t.Map1Npc1=void 0;var o=function(){function e(){}return e.prototype.onUpdate=function(e){},e.prototype.onSceneActivate=function(e){console.log("Npc - onSceneActivate: "+e.name),e.base.onSceneActivate(e)},e}();t.Map1Npc1=o}),System.registerDynamic("scenes/map1/sprites/player1.js",[],!0,function(e,t,n){"use strict";this||self;Object.defineProperty(t,"__esModule",{value:!0}),t.Map1Player1=void 0;var o=function(){function e(){}return e.prototype.onUpdate=function(e){},e.prototype.onSceneActivate=function(e){console.log("Player - onSceneActivate: "+e.name),e.base.onSceneActivate(e)},e}();t.Map1Player1=o}),System.registerDynamic("scenes/map1/sprites/plot1.js",[],!0,function(e,t,n){"use strict";this||self;var o=t&&t.__generator||function(e,t){var n,o,i,s,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(i=2&s[0]?o.return:s[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,s[1])).done)return i;switch(o=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,o=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(!(i=(i=r.trys).length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){r=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){r.label=s[1];break}if(6===s[0]&&r.label<i[1]){r.label=i[1],i=s;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(s);break}i[2]&&r.ops.pop(),r.trys.pop();continue}s=t.call(e,r)}catch(e){s=[6,e],o=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.Plot1=void 0;var i=function(){function e(){}return e.prototype.onUpdate=function(e){var t,n;return o(this,function(o){switch(o.label){case 0:return t=e.scene,t.sys("stage"),t.sys("tween"),t.sys("motion"),t.game.get("rpg"),console.log("plot started - "+e.name),[4,e.plot.wait(1e3)];case 1:return o.sent(),n=t.get("stage").follow,console.log("following - "+n),console.log("plot ended - "+e.name),e.active=!1,[2]}})},e}();t.Plot1=i}),System.registerDynamic("scenes/map1/sprites/plot2.js",[],!0,function(e,t,n){"use strict";this||self;var o=t&&t.__generator||function(e,t){var n,o,i,s,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(i=2&s[0]?o.return:s[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,s[1])).done)return i;switch(o=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,o=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(!(i=(i=r.trys).length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){r=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){r.label=s[1];break}if(6===s[0]&&r.label<i[1]){r.label=i[1],i=s;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(s);break}i[2]&&r.ops.pop(),r.trys.pop();continue}s=t.call(e,r)}catch(e){s=[6,e],o=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.Plot2=void 0;var i=function(){function e(){}return e.prototype.onUpdate=function(e){var t,n;return o(this,function(o){switch(o.label){case 0:return t=e.scene,t.sys("stage"),t.sys("tween"),t.sys("motion"),t.game.get("rpg"),console.log("plot started - "+e.name),(n=t.spr("dialog-box1").code).open(e,"God",["Welcome! My dear boy!","You will be the next new hero soon.","So please go and make yourself stronger."]),[4,e.plot.wait()];case 1:return o.sent(),n.open(e,"神之声",["孩子，你是被命运选中的英雄 ——"],50,!0),[4,e.plot.wait()];case 2:return o.sent(),n.open(e,"神之声",[" 天选之子！ "],2,!0,"#FF0000"),[4,e.plot.wait()];case 3:return o.sent(),n.open(e,"神之声",["","没什么好害怕，神的意志和光辉将会与你同在。","只要无时无刻谨记神的教诲，神的力量会一直保护你。"]),[4,e.plot.wait()];case 4:return o.sent(),n.open(e,"評価項目",["舞台となる惑星は、地球ではありません。","古風な雰囲気のある分かりやすい操作の見下ろし型アクション。","世界観が作りこまれているのに、肝心のメインストーリーがお粗末です。"]),[4,e.plot.wait()];case 5:return o.sent(),n.close(),console.log("plot ended - "+e.name),e.active=!1,[2]}})},e}();t.Plot2=i}),System.registerDynamic("scenes/map1/sprites/plot3.js",[],!0,function(e,t,n){"use strict";this||self;var o=t&&t.__generator||function(e,t){var n,o,i,s,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(i=2&s[0]?o.return:s[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,s[1])).done)return i;switch(o=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,o=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(!(i=(i=r.trys).length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){r=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){r.label=s[1];break}if(6===s[0]&&r.label<i[1]){r.label=i[1],i=s;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(s);break}i[2]&&r.ops.pop(),r.trys.pop();continue}s=t.call(e,r)}catch(e){s=[6,e],o=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.Plot3=void 0;var i=function(){function e(){}return e.prototype.onUpdate=function(e){var t,n,i,s,r,a,l;return o(this,function(o){switch(o.label){case 0:return t=e.scene,t.sys("stage"),t.sys("tween"),t.sys("motion"),t.game.get("rpg"),console.log("plot started - "+e.name),n=e.get("rpg"),i=t.spr("dialog-box1").code,0!=n.times?[3,2]:(i.open(e,"Man",["I am a farmer living in the forest.","Do you know what is Forest Farming?","That is what I am doing here to make a living."]),[4,e.plot.wait()]);case 1:return o.sent(),i.close(),n.times+=1,[3,6];case 2:return i.open(e,"Man",["Do you like farmers?"],50,!0),[4,e.plot.wait()];case 3:return o.sent(),i.list(e,["Yes.","No.","I won't tell you."]),[4,e.plot.wait()];case 4:return o.sent(),i.clearHistory(),s=["I am glad to hear that.","You should get to know more about them.","Okay..."],i.open(e,"Man",[s[i.getChoice()-1]]),[4,e.plot.wait()];case 5:o.sent(),2!=i.getChoice()?i.close():(i.close(!1),(r=e.scene.systems["rpg-transition"]).isWorking()?i.close():(a=t.game.lib("audio").musics[t.get("rpg").bgm],l=t.game.lib("audio").musics["rpg-battle"],a.stop(),l.play(),t.game.get("rpg").lastmap=t.name,r.callScene("battle1",function(e){e.reset()},500,1e3))),o.label=6;case 6:return console.log("plot ended - "+e.name),e.active=!1,[2]}})},e}();t.Plot3=i}),System.registerDynamic("scenes/map1/sprites/plot4.js",[],!0,function(e,t,n){"use strict";this||self;var o=t&&t.__generator||function(e,t){var n,o,i,s,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(i=2&s[0]?o.return:s[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,s[1])).done)return i;switch(o=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,o=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(!(i=(i=r.trys).length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){r=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){r.label=s[1];break}if(6===s[0]&&r.label<i[1]){r.label=i[1],i=s;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(s);break}i[2]&&r.ops.pop(),r.trys.pop();continue}s=t.call(e,r)}catch(e){s=[6,e],o=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.Plot3=void 0;var i=function(){function e(){}return e.prototype.onUpdate=function(e){var t,n;return o(this,function(o){switch(o.label){case 0:return t=e.scene,t.sys("stage"),t.sys("tween"),t.sys("motion"),t.game.get("rpg"),console.log("plot started - "+e.name),(n=t.spr("dialog-box1").code).open(e,"Old Man",["I am looking for my grandson.","He is clever, but also a naughty kid.","If you see him please tell him to go home."]),[4,e.plot.wait()];case 1:return o.sent(),n.close(),console.log("plot ended - "+e.name),e.active=!1,[2]}})},e}();t.Plot3=i}),System.registerDynamic("scenes/map1/sprites/plot5.js",[],!0,function(e,t,n){"use strict";this||self;var o=t&&t.__generator||function(e,t){var n,o,i,s,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(i=2&s[0]?o.return:s[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,s[1])).done)return i;switch(o=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,o=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(!(i=(i=r.trys).length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){r=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){r.label=s[1];break}if(6===s[0]&&r.label<i[1]){r.label=i[1],i=s;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(s);break}i[2]&&r.ops.pop(),r.trys.pop();continue}s=t.call(e,r)}catch(e){s=[6,e],o=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.Plot3=void 0;var i=function(){function e(){}return e.prototype.onUpdate=function(e){var t,n;return o(this,function(o){switch(o.label){case 0:return t=e.scene,t.sys("stage"),t.sys("tween"),t.sys("motion"),t.game.get("rpg"),console.log("plot started - "+e.name),(n=t.spr("dialog-box1").code).open(e,"Kid",["Here is my secret garden.","I feel peaceful and calm everytime when I get here."]),[4,e.plot.wait()];case 1:return o.sent(),n.open(e,"Kid",["You look not a bad guy.","Could you please come and play with me?"]),[4,e.plot.wait()];case 2:return o.sent(),n.close(),console.log("plot ended - "+e.name),e.active=!1,[2]}})},e}();t.Plot3=i}),System.registerDynamic("scenes/preload/preload.js",[],!0,function(e,t,n){"use strict";this||self;Object.defineProperty(t,"__esModule",{value:!0}),t.ScenePreload=void 0;var o=function(){function e(){this.nextSceneName="map1",this.preloadScenes=["info","dialog","list","map1","battle1"],this.preloadPackFiles=["pack2.pack","pack3.pack"],this.signs=[".","..","...","....",".....","......"],this.times=0,this.moveon=!1,this.progress=0,this.message="Loading"}return e.prototype.onInit=function(e){console.log("on scene init: "+e.name)},e.prototype.onActivate=function(e){var t=this;console.log("on scene activate: "+e.name),this.times=0,this.moveon=!1,this.progress=0,this.message="Loading";var n=e.spr("progress1");n.get("display").object.scale.x=10,e.game.lib("preload").loadPacks(this.preloadPackFiles,function(){console.log("finished loading packages"),e.game.loadScenes(t.preloadScenes,function(){if(console.log("finished loading scenes"),t.progress=100,t.message="Done",e.game.lib("audio").locked())e.spr("label2").active=!0,e.spr("button1").active=!0,e.components.event.onPointerdown=function(){var n=e.systems.transition;n&&!n.isWorking()&&n.callScene(t.nextSceneName)};else{var n=e.systems.transition;n&&!n.isWorking()&&n.callScene(t.nextSceneName)}},function(e){var o=.5+e/200;n.get("display").object.scale.x=420*o,t.message="Loading scenes",t.progress=Math.round(100*o)})},function(e,o){if(e>0&&o>0){var i=e/o/2;n.get("display").object.scale.x=420*i,t.message="Loading packages",t.progress=Math.round(100*i)}}),this.moveon=!0},e.prototype.onUpdate=function(e){var t=this;if(this.moveon){this.times+=1,this.moveon=!1;var n=e.spr("label1"),o=e.spr("number1");if(this.message){var i=this.message;this.progress<100&&(i+=this.signs[this.times%this.signs.length]),n.get("display").object.text=i}else n.get("display").object.text="";o.get("display").object.text=this.progress+"%",e.timeout(100,function(){return t.moveon=!0})}},e}();t.ScenePreload=o}),System.registerDynamic("sprites/bar.js",[],!0,function(e,t,n){"use strict";this||self;Object.defineProperty(t,"__esModule",{value:!0}),t.SpriteBar=void 0;var o=function(){function e(){}return e.prototype.prepareTexture=function(e){var t=e.scene.name+"."+(e.origin?e.origin.name:e.name),n=e.game.lib("image").getTexture(t);if(n)return n;var o=-1,i="#FFFFFF";e.components["custom-display"]&&e.components["custom-display"].color&&(i=e.components["custom-display"].color.toString()).length>1&&"#"==i.charAt(0)&&(o=parseInt(i.substring(1),16));var s=e.game.get("display").pixi,r=new PIXI.Graphics;return r.beginFill(o,1),r.drawRect(0,0,1,1),r.endFill(),n=s.renderer.generateTexture(r,PIXI.SCALE_MODES.NEAREST,1),e.game.lib("image").setTexture(t,n),n},e}();t.SpriteBar=o}),System.registerDynamic("sprites/boy.js",[],!0,function(e,t,n){"use strict";this||self;Object.defineProperty(t,"__esModule",{value:!0}),t.SpriteBoy=void 0;var o=function(){function e(){}return e.prototype.prepareSpriteAsync=function(e,t){var n=e.components.spine;e.game.lib("image").loadImageByType(n.png,1,function(o){o||t(null),e.game.lib("json").loadString(n.atlas,function(i){i||t(null),e.game.lib("json").loadJson(n.json,function(e){e||t(null);var n=e,s=i,r=new PIXI.spine.core.TextureAtlas(s,function(e,t){t(o)}),a=new PIXI.spine.core.AtlasAttachmentLoader(r),l=new PIXI.spine.core.SkeletonJson(a).readSkeletonData(n),c=new PIXI.spine.Spine(l);c.state.hasAnimation("walk")&&c.state.setAnimation(0,"walk",!0),t(c)})})})},e}();t.SpriteBoy=o}),System.registerDynamic("sprites/enemy.js",[],!0,function(e,t,n){"use strict";this||self;Object.defineProperty(t,"__esModule",{value:!0}),t.SpriteEnemy=void 0;var o=function(){function e(){}return e.prototype.onActivate=function(e){},e}();t.SpriteEnemy=o}),System.registerDynamic("sprites/fighter.js",[],!0,function(e,t,n){"use strict";this||self;Object.defineProperty(t,"__esModule",{value:!0}),t.SpriteFighter=void 0;var o=function(){function e(){}return e.prototype.onSceneActivate=function(e){console.log("onSceneActivate - "+e.name)},e}();t.SpriteFighter=o}),System.registerDynamic("sprites/fps.js",[],!0,function(e,t,n){"use strict";this||self;Object.defineProperty(t,"__esModule",{value:!0}),t.SpriteFps=void 0;var o=function(){function e(){}return e.prototype.onUpdate=function(e){var t=e.components.display;t&&t.object&&(t.object.text=Math.round(e.game.fps).toString())},e}();t.SpriteFps=o}),System.registerDynamic("sprites/icon-triangle.js",[],!0,function(e,t,n){"use strict";this||self;Object.defineProperty(t,"__esModule",{value:!0}),t.SpriteTriangle=void 0;var o=function(){function e(){}return e.prototype.prepareTexture=function(e){var t=e.scene.name+"."+(e.origin?e.origin.name:e.name),n=e.game.lib("image").getTexture(t);if(n)return n;var o=document.createElement("canvas");o.width=20,o.height=20;var i=o.getContext("2d");return i.clearRect(0,0,20,20),i.beginPath(),i.moveTo(0,0),i.lineTo(20,0),i.lineTo(10,10),i.closePath(),i.fillStyle="#FFFFFF",i.fill(),n=PIXI.Texture.from(o),e.game.lib("image").setTexture(t,n),n},e}();t.SpriteTriangle=o}),System.registerDynamic("sprites/npc.js",[],!0,function(e,t,n){"use strict";this||self;Object.defineProperty(t,"__esModule",{value:!0}),t.SpriteNpc=void 0;var o=function(){function e(){}return e.prototype.walkOnTile=function(e,t,n,o){var i=this;void 0===n&&(n=2),void 0===o&&(o=null);var s=e.scene.sys("rpg-map"),r=e.get("movement"),a=e.get("display").animation,l=e.scene.systems.motion,c=e.scene.get("stage").gamemap;if(r&&a&&l&&c&&!0!==r.moving){var p=0,u=0;switch(t){case"up":a.set("run_up"),u=-32;break;case"down":a.set("run_down"),u=32;break;case"left":a.set("run_left"),p=-32;break;case"right":a.set("run_right"),p=32;break;default:return}var g=e.get("stage").x+p,y=e.get("stage").y+u,f=c.pixelToTile(g,y);s&&!s.isOccupiedTile(e.scene,null,f.x,f.y)&&0===c.getTileCost(f.x,f.y)?(r.moving=!0,r.next={x:g,y:y},s.occupyTile(e,f.x,f.y),l.moveTo(e,g,y,n,function(){r.moving=!1,r.next=null;var t=c.pixelToTile(g-p,y-u);s.leaveTile(e,t.x,t.y),i.walkOneStep(e,n,o)})):this.walkOneStep(e,n,o)}},e.prototype.walkOneStep=function(e,t,n){void 0===t&&(t=2),void 0===n&&(n=null);var o=e.scene.sys("rpg-map"),i=e.get("movement"),s=e.get("display").animation,r=e.scene.get("stage").gamemap;if(i&&s&&r&&!0!==i.moving){var a=e.get("stage").x,l=e.get("stage").y;if(i.path.length>0){var c=i.path.shift();if(0!==r.getTileCost(c.x,c.y)||o.isOccupiedTile(e.scene,null,c.x,c.y))this.stopWalking(e,"",n);else{var p=r.tileToPixel(c.x,c.y),u=o.getDirection({x:a,y:l},p);this.walkOnTile(e,u,t,n)}}else this.stopWalking(e,"",n)}},e.prototype.walkToTile=function(e,t,n,o,i,s){var r;void 0===o&&(o=2),void 0===i&&(i=0),void 0===s&&(s=null);var a=e.get("movement"),l=e.scene.get("stage").gamemap,c=a.next&&a.next.x>=0?a.next.x:e.get("stage").x,p=a.next&&a.next.y>=0?a.next.y:e.get("stage").y,u=l.pixelToTile(c,p),g={x:t,y:n},y=l.findPath(u.x,u.y,g.x,g.y,!1,function(t,n,o){return e.scene.sys("rpg-map").isOccupiedTile(e.scene,null,t,n)?-1:o}),f=y&&y.length>0;if(f&&i>0&&y.length>i&&(f=!1),f)a.path=[],(r=a.path).push.apply(r,y),a.target={x:g.x,y:g.y},a.moving||this.walkOneStep(e,o,s);else{var h=e.scene.sys("rpg-map").getDirection(u,g);h&&e.get("display").animation.set(h),s&&s()}},e.prototype.stopWalking=function(e,t,n){void 0===t&&(t=""),void 0===n&&(n=null);var o=e.scene.sys("rpg-map"),i=e.get("movement"),s=e.get("display").animation,r=e.scene.get("stage").gamemap,a=e.get("stage").x,l=e.get("stage").y;if(i){i.path=[],i.moving=!1;var c="";if(i.target){var p=r.pixelToTile(a,l);c=o.getDirection(p,i.target)}if(s)if(t)s.set(t);else if(c)s.set(c);else{var u=s.current.split("_");u&&u.length>=2&&s.set(u[1])}i.target&&(i.target=null),n&&n()}},e.prototype.walkOnMap=function(e){var t=this,n=e.scene.sys("rpg-map"),o=e.get("movement"),i=e.scene.get("stage").gamemap;n&&o&&i&&!o.waiting&&!0===o.auto?e.scene.timeout(1e3*(Math.floor(3*Math.random())+1),function(){if(!0!==o.waiting){var n=e.get("stage").x,s=e.get("stage").y,r=i.pixelToTile(n,s),a=Math.floor(2*Math.random())+1,l=i.findRange(r.x,r.y,a,!1,function(t,n,i){return t<o.start.x-2||t>o.start.x+2?-1:n<o.start.y-2||n>o.start.y+2?-1:e.scene.sys("rpg-map").isOccupiedTile(e.scene,null,t,n)?-1:i>=0?1:-1});if(l&&l.length>0){var c=Math.floor(Math.random()*l.length);t.walkToTile(e,l[c].x,l[c].y,2,2,function(){return t.walkOnMap(e)})}else t.walkOnMap(e)}else t.walkOnMap(e)}):e.scene.timeout(1e3*(Math.floor(3*Math.random())+1),function(){return t.walkOnMap(e)})},e.prototype.wait=function(e,t){void 0===t&&(t=!0);var n=e.get("movement");n&&(n.waiting=t)},e.prototype.onUpdate=function(e){},e.prototype.onSceneActivate=function(e){var t=e.scene.get("rpg");if(t&&1==t.times){var n=e.scene.sys("rpg-map"),o=e.scene.get("stage").gamemap,i=e.get("tile");if(i&&o){var s=o.tileToPixel(i.x,i.y);e.get("stage").x=s.x,e.get("stage").y=s.y}if(n&&(n.alignToTile(e),n.occupyCurrentTile(e)),(c=e.get("movement"))&&(c.waiting=!1),o&&c&&!0===c.auto){var r=e.get("stage").x,a=e.get("stage").y,l=o.pixelToTile(r,a);c.start={x:l.x,y:l.y},this.walkOnMap(e)}}else{var c;(n=e.scene.sys("rpg-map"))&&n.occupyCurrentTile(e),(c=e.get("movement"))&&(c.waiting=!1),c&&!0===c.auto&&this.walkOnMap(e)}},e}();t.SpriteNpc=o}),System.registerDynamic("sprites/panel.js",[],!0,function(e,t,n){"use strict";this||self;Object.defineProperty(t,"__esModule",{value:!0}),t.SpritePanel=void 0;var o=function(){function e(){}return e.prototype.onPointerdown=function(e,t){console.log("[base] sprite onPointerdown: "+e.name)},e}();t.SpritePanel=o}),System.registerDynamic("sprites/player.js",[],!0,function(e,t,n){"use strict";this||self;Object.defineProperty(t,"__esModule",{value:!0}),t.SpritePlayer=void 0;var o=function(){function e(){}return e.prototype.walkOnTile=function(e,t,n){var o=this;void 0===n&&(n=2);var i=e.scene.sys("rpg-map"),s=e.get("movement"),r=e.get("display").animation,a=e.scene.systems.motion,l=e.scene.get("stage").gamemap;if(s&&r&&a&&l&&!0!==s.moving){var c=0,p=0;switch(t){case"up":r.set("run_up"),p=-32;break;case"down":r.set("run_down"),p=32;break;case"left":r.set("run_left"),c=-32;break;case"right":r.set("run_right"),c=32;break;default:return}var u=e.get("stage").x+c,g=e.get("stage").y+p,y=l.pixelToTile(u,g);i&&!i.isOccupiedTile(e.scene,[e.name],y.x,y.y)&&0===l.getTileCost(y.x,y.y)?(s.moving=!0,s.next={x:u,y:g},i.occupyTile(e,y.x,y.y),a.moveTo(e,u,g,n,function(){s.moving=!1,s.next=null;var t=l.pixelToTile(u-c,g-p);i.leaveTile(e,t.x,t.y),i.checkMovementControl()?(s.path=[],s.target=null):o.walkOneStep(e,n)})):this.walkOneStep(e,n)}},e.prototype.walkOneStep=function(e,t){void 0===t&&(t=2);var n=e.scene.sys("rpg-map"),o=e.get("movement"),i=e.get("display").animation,s=e.scene.get("stage").gamemap;if(o&&i&&s&&!0!==o.moving){var r=e.get("stage").x,a=e.get("stage").y;if(o.path.length>0){var l=o.path.shift();if(0!==s.getTileCost(l.x,l.y)||n.isOccupiedTile(e.scene,[e.name],l.x,l.y))if(o.path.length>0&&o.target){var c=s.tileToPixel(o.target.x,o.target.y);this.walkTo(e,c.x,c.y,t)}else this.stopWalking(e);else{var p=s.tileToPixel(l.x,l.y),u=n.getDirection({x:r,y:a},p);this.walkOnTile(e,u,t)}}else this.stopWalking(e)}},e.prototype.walkToTile=function(e,t,n,o){var i;void 0===o&&(o=2);var s=e.get("movement"),r=e.scene.get("stage").gamemap,a=s.next&&s.next.x>=0?s.next.x:e.get("stage").x,l=s.next&&s.next.y>=0?s.next.y:e.get("stage").y,c=r.pixelToTile(a,l),p={x:t,y:n},u=r.findPath(c.x,c.y,p.x,p.y,!1,function(t,n,o){return e.scene.sys("rpg-map").isOccupiedTile(e.scene,[e.name],t,n)?-1:o});u&&u.length>0?(s.path=[],(i=s.path).push.apply(i,u),s.target={x:p.x,y:p.y},s.moving||this.walkOneStep(e,o)):(s.path=[],s.target={x:p.x,y:p.y},this.stopWalking(e))},e.prototype.walkTo=function(e,t,n,o){void 0===o&&(o=2);var i=e.scene.sys("rpg-map");if(!i||!i.isTalking()){e.get("movement");var s=e.scene.get("stage").gamemap,r=e.scene.game.get("rpg");if(!r||!1!==r.controllable){var a=s.pixelToTile(t,n);this.walkToTile(e,a.x,a.y,o)}}},e.prototype.stopWalking=function(e,t){void 0===t&&(t="");var n=e.scene.sys("rpg-map"),o=e.get("movement"),i=e.get("display").animation,s=e.scene.get("stage").gamemap,r=e.get("stage").x,a=e.get("stage").y,l=null;if(o){o.path=[],o.moving=!1;var c="",p=null;if(o.target){var u=s.pixelToTile(r,a);c=n.getDirection(u,o.target)}if(i)if(t)i.set(t);else if(c)i.set(c);else{var g=i.current.split("_");g&&g.length>=2&&i.set(g[1])}if(o.target&&((p=n.getNextTile(e))&&p.x==o.target.x&&p.y==o.target.y&&(l=n.getPlotOnTile(e.scene,p.x,p.y)),o.target=null),l){var y=n.getPlotNpc(l),f=y&&n.isNpcWalking(y);if(y&&p&&!n.isNpcWalking(y)){n.startNpcWaiting(y);var h=y.get("display").animation,m=n.getCurrentTile(y),d=n.getCurrentTile(e),v=m?n.getDirection(m,d):null;v&&h&&h.set(v)}(!y||y&&!f)&&(l.active=!0)}}},e.prototype.onUpdate=function(e){},e.prototype.onSceneActivate=function(e){var t=e.scene.get("rpg");if(t&&1==t.times){var n=e.scene.sys("rpg-map"),o=e.scene.get("stage").gamemap,i=e.get("tile");if(i&&o){var s=o.tileToPixel(i.x,i.y);e.get("stage").x=s.x,e.get("stage").y=s.y}n&&(n.alignToTile(e),n.occupyCurrentTile(e));var r=e.get("movement");r&&(r.moving=!1,r.next=null)}else{(n=e.scene.sys("rpg-map"))&&n.occupyCurrentTile(e)}},e}();t.SpritePlayer=o}),System.registerDynamic("sprites/text.js",[],!0,function(e,t,n){"use strict";this||self;Object.defineProperty(t,"__esModule",{value:!0}),t.SpriteText=void 0;var o=function(){function e(){}return e.prototype.onActivate=function(e){},e}();t.SpriteText=o}),System.registerDynamic("systems/rpg-battle.js",[],!0,function(e,t,n){"use strict";this||self;Object.defineProperty(t,"__esModule",{value:!0}),t.RpgBattle=void 0;var o=function(){function e(){this.name="rpg-battle",this.entry=null,this.listbox=null,this.profile=null,this.gamepad=null,this.keyboard=null,this.holdon=!1}return e.prototype.init=function(e){return this.profile=e.components.rpg,console.log("rpg-battle system is loaded successfully"),!0},e.prototype.activate=function(e){var t=this;this.listbox=null,this.holdon=!1,this.gamepad=e.systems.gamepad,this.keyboard=e.systems.keyboard;var n=e.components.rpg;n&&(n.listbox&&(this.listbox=e.sprites[n.listbox]),n.entry&&(this.entry=e.sprites[n.entry])),this.entry&&e.timeout(500,function(){return t.entry.active=!0})},e.prototype.update=function(e,t){this.handleKeyboard(e)},e.prototype.checkMovementControl=function(){return this.keyboard?this.keyboard.keys.ArrowUp?"up":this.keyboard.keys.ArrowDown?"down":this.keyboard.keys.ArrowLeft?"left":this.keyboard.keys.ArrowRight?"right":"":null},e.prototype.checkActionControl=function(){return this.keyboard?this.keyboard.keys[" "]?"check":"":null},e.prototype.cleanup=function(e){e.components.rpg},e.prototype.isListing=function(){return this.listbox&&this.listbox.active&&this.listbox.code&&this.listbox.code.isListing()},e.prototype.selectItem=function(){this.listbox&&this.listbox.active&&this.listbox.code&&this.listbox.code.selectItem()},e.prototype.onSceneBattleClick=function(e,t){var n=t.data.getLocalPosition(e.components.display.object);console.log("scene onPointerdown: "+e.name+" - x="+n.x+" , y="+n.y)},e.prototype.handleKeyboard=function(e){var t=this;if(!e.paused&&null!=this.keyboard&&null!=this.keyboard&&null!=this.profile&&null!=this.profile&&!0===this.profile.controllable){if(this.gamepad){var n=this.gamepad.getFirstGamepad();n&&(this.keyboard.keys.ArrowUp=n.keys.up,this.keyboard.keys.ArrowDown=n.keys.down,this.keyboard.keys.ArrowLeft=n.keys.left,this.keyboard.keys.ArrowRight=n.keys.right,this.keyboard.keys[" "]=n.keys.b0,this.keyboard.keys.Escape=n.keys.b1)}var o=window.vbuttons;if(o){var i=o.up,s=o.down,r=o.left,a=o.right;i||s||r||a?(this.keyboard.keys.ArrowUp=i,this.keyboard.keys.ArrowDown=s,this.keyboard.keys.ArrowLeft=r,this.keyboard.keys.ArrowRight=a):(this.keyboard.keys.ArrowUp=!1,this.keyboard.keys.ArrowDown=!1,this.keyboard.keys.ArrowLeft=!1,this.keyboard.keys.ArrowRight=!1),this.keyboard.keys[" "]=!0===o.b1,this.keyboard.keys.Escape=!0===o.b2}if(e.game.get("rpg")){var l=this.checkMovementControl(),c=this.checkActionControl();!l&&!c||this.holdon||this.isListing()&&(!l||"up"!=l&&"down"!=l||(this.listbox.code.moveCursor(l),this.holdon=!0,this.listbox.scene.timeout(200,function(){return t.holdon=!1})),c&&!this.holdon&&(this.selectItem(),this.holdon=!0,this.listbox.scene.timeout(200,function(){return t.holdon=!1})))}}},e}();t.RpgBattle=o}),System.registerDynamic("systems/rpg-map.js",[],!0,function(e,t,n){"use strict";this||self;Object.defineProperty(t,"__esModule",{value:!0}),t.RpgMap=void 0;var o=function(){function e(){this.name="rpg-map",this.stage=null,this.player=null,this.dialog=null,this.profile=null,this.gamepad=null,this.keyboard=null,this.holdon=!1}return e.prototype.init=function(e){return this.profile=e.components.rpg,console.log("rpg-map system is loaded successfully"),!0},e.prototype.activate=function(e){this.player=null,this.dialog=null,this.holdon=!1,this.stage=e.systems.stage,this.gamepad=e.systems.gamepad,this.keyboard=e.systems.keyboard;var t=e.components.rpg;if(t){if(this.cleanupMap(e),t.player&&(this.player=e.sprites[t.player]),this.stage&&this.player){var n=e.game.get("rpg");n&&(n.controllable=!0),this.stage.follow(e,this.player.name)}t.dialog&&(this.dialog=e.sprites[t.dialog]),t.times?t.times+=1:t.times=1}},e.prototype.update=function(e,t){this.handleKeyboard(e)},e.prototype.checkMovementControl=function(){return this.keyboard?this.keyboard.keys.ArrowUp?"up":this.keyboard.keys.ArrowDown?"down":this.keyboard.keys.ArrowLeft?"left":this.keyboard.keys.ArrowRight?"right":"":null},e.prototype.checkActionControl=function(){return this.keyboard?this.keyboard.keys[" "]?"check":"":null},e.prototype.cleanupMap=function(e){var t=e.components.rpg;t&&(t.tempMarks?t.tempMarks.forEach(function(e,t,n){return e.length=0}):t.tempMarks=new Map)},e.prototype.occupyTile=function(e,t,n){var o=e.scene.components.rpg;if(e.scene.get("stage").gamemap&&o&&o.tempMarks){var i=t+"_"+n;if(o.tempMarks.has(i)){(s=o.tempMarks.get(i)).indexOf(e.name)<0&&s.push(e.name)}else{var s=[e.name];o.tempMarks.set(i,s)}}},e.prototype.leaveTile=function(e,t,n){var o=e.scene.components.rpg;if(e.scene.get("stage").gamemap&&o&&o.tempMarks){var i=t+"_"+n;if(o.tempMarks.has(i)){var s=o.tempMarks.get(i),r=s?s.indexOf(e.name):-1;r>=0&&s.splice(r,1)}}},e.prototype.occupyCurrentTile=function(e){var t=e.scene.components.rpg,n=e.scene.get("stage").gamemap;if(n&&t&&t.tempMarks){var o=e.get("stage"),i=n.pixelToTile(o.x,o.y);this.occupyTile(e,i.x,i.y)}},e.prototype.isOccupiedTile=function(e,t,n,o){var i=e.components.rpg;if(e.get("stage").gamemap&&i&&i.tempMarks){var s=n+"_"+o;if(i.tempMarks.has(s)){var r=i.tempMarks.get(s);if(!r||0==r.length)return!1;if(!t||0==t.length)return!0;for(var a=0,l=r;a<l.length;a++){var c=l[a];if(t.indexOf(c)<0)return!0}return!1}}return!1},e.prototype.alignToTile=function(e){var t=e.scene.get("stage").gamemap;if(t){var n=e.get("stage").x,o=e.get("stage").y,i=t.align(n,o);i&&(e.get("stage").x=i.x,e.get("stage").y=i.y)}},e.prototype.getDirection=function(e,t){if(e.x==t.x){if(e.y>t.y)return"up";if(e.y<t.y)return"down"}else if(e.y==t.y){if(e.x>t.x)return"left";if(e.x<t.x)return"right"}return null},e.prototype.getCurrentTile=function(e){var t=e.scene.get("stage").gamemap;if(t){var n=e.get("stage").x,o=e.get("stage").y;return t.pixelToTile(n,o)}return null},e.prototype.getNextTile=function(e){var t=e.get("display").animation,n=e.scene.get("stage").gamemap;if(t&&n){var o=0,i=0,s=t.current;if(s.indexOf("_")>=0){var r=t.current.split("_");r&&r.length>=2&&(s=r[1])}switch(s){case"up":i=-32;break;case"down":i=32;break;case"left":o=-32;break;case"right":o=32;break;default:return null}var a=e.get("stage").x+o,l=e.get("stage").y+i;return n.pixelToTile(a,l)}return null},e.prototype.getPlotOnTile=function(e,t,n){for(var o in e.sprites){var i=e.sprites[o];if(i&&"plot"==i.template){var s=i.get("rpg");if(s){var r=null;if(s.tile)r=s.tile;else if(s.npc){var a=e.sprites[s.npc],l=e.get("stage").gamemap;if(a&&l){var c=a.get("stage").x,p=a.get("stage").y;r=l.pixelToTile(c,p)}}if(r&&r.x==t&&r.y==n)return i}}}return null},e.prototype.getPlotNpc=function(e){var t=e.get("rpg");if(t&&t.npc){var n=e.scene.sprites[t.npc];if(n)return n}return null},e.prototype.startNpcWaiting=function(e){var t=e.get("movement");t&&(t.waiting=!0)},e.prototype.stopNpcWaiting=function(e){if(!e.get("stage").gamemap)return null;for(var t in e.sprites){var n=e.sprites[t];if(n&&"npc"==n.template){var o=n.get("movement");o&&(o.waiting=!1)}}return null},e.prototype.isNpcWalking=function(e){var t=e.get("movement");return t&&(t.moving||t.walking)},e.prototype.isTalking=function(){return this.dialog&&this.dialog.active},e.prototype.isAnswering=function(){return this.dialog&&this.dialog.active&&this.dialog.code&&this.dialog.code.isAnswering()},e.prototype.selectAnswer=function(){this.dialog&&this.dialog.active&&this.dialog.code&&this.dialog.code.selectAnswer()},e.prototype.onSceneMapClick=function(e,t){var n=t.data.getLocalPosition(e.components.display.object),o=e.systems.stage.transform(n),i=e.components.rpg,s=e.sprites[i.player];s&&s.code.walkTo(s,o.x,o.y)},e.prototype.handleKeyboard=function(e){var t=this;if(!e.paused&&null!=this.keyboard&&null!=this.keyboard&&null!=this.profile&&null!=this.profile&&!0===this.profile.controllable){if(this.gamepad){var n=this.gamepad.getFirstGamepad();n&&(this.keyboard.keys.ArrowUp=n.keys.up,this.keyboard.keys.ArrowDown=n.keys.down,this.keyboard.keys.ArrowLeft=n.keys.left,this.keyboard.keys.ArrowRight=n.keys.right,this.keyboard.keys[" "]=n.keys.b0,this.keyboard.keys.Escape=n.keys.b1)}var o=window.vbuttons;if(o){var i=o.up,s=o.down,r=o.left,a=o.right;i||s||r||a?(this.keyboard.keys.ArrowUp=i,this.keyboard.keys.ArrowDown=s,this.keyboard.keys.ArrowLeft=r,this.keyboard.keys.ArrowRight=a):(this.keyboard.keys.ArrowUp=!1,this.keyboard.keys.ArrowDown=!1,this.keyboard.keys.ArrowLeft=!1,this.keyboard.keys.ArrowRight=!1),this.keyboard.keys[" "]=!0===o.b1,this.keyboard.keys.Escape=!0===o.b2}var l=e.game.get("rpg"),c=this.player&&this.player.active?this.player.code:null;if(c){var p=l?l.movespeed:1,u=this.checkMovementControl(),g=this.checkActionControl(),y=!1,f=this.isTalking();if(u&&!f){var h=this.player.get("movement");h&&(h.path=[],h.target=null),c.walkOnTile(this.player,u,p),y=!0}if(f&&!this.holdon&&this.isAnswering()&&(!u||"up"!=u&&"down"!=u||(this.dialog.code.moveCursor(u),this.holdon=!0,this.player.scene.timeout(200,function(){return t.holdon=!1})),g&&!this.holdon&&(this.selectAnswer(),this.holdon=!0,this.player.scene.timeout(200,function(){return t.holdon=!1}))),g&&!this.holdon)if(f)this.dialog.code.next(),this.holdon=!0,this.player.scene.timeout(500,function(){return t.holdon=!1});else if(!y){var m=this.getNextTile(this.player),d=m?this.getPlotOnTile(this.player.scene,m.x,m.y):null;if(d){var v=this.getPlotNpc(d),b=v&&this.isNpcWalking(v);if(v&&!b){this.startNpcWaiting(v);var w=v.get("display").animation,x=this.getCurrentTile(v),k=this.getCurrentTile(this.player),S=this.getDirection(x,k);S&&w&&w.set(S)}(!v||v&&!b)&&(d.active=!0,this.holdon=!0,this.player.scene.timeout(500,function(){return t.holdon=!1}))}}}}},e}();t.RpgMap=o}),System.registerDynamic("systems/rpg-transition.js",[],!0,function(e,t,n){"use strict";this||self;Object.defineProperty(t,"__esModule",{value:!0}),t.RpgTransition=void 0;var o=function(){function e(){this.name="rpg-transition",this._game=null,this._player=null,this._stage=null,this._bright=null,this._pixi=null,this._target=""}return e.prototype.init=function(e){this._game=e,this._pixi=e.components.display.pixi,this._stage=e.components.display.object;var t=new PIXI.Graphics;t.beginFill(16777215),t.drawRect(0,0,1,1),t.endFill();var n=this._pixi.renderer.generateTexture(t,PIXI.SCALE_MODES.NEAREST,1);this._bright=new PIXI.Sprite(n),this._bright.scale.set(e.width,e.height);var o=e.components.display.layers,i=o?Object.keys(o):[];return i.length>0&&(this._bright.parentGroup=new PIXI.display.Group(i.length+1,!1),this._stage.addChild(new PIXI.display.Layer(this._bright.parentGroup))),!0},e.prototype.activate=function(e){this._player=null;var t=e.components.rpg;t&&t.player&&(this._player=e.sprites[t.player]);var n=e.sys("stage");n&&n.zoom(e,!1)},e.prototype.isWorking=function(){return this._target&&this._target.length>0},e.prototype.callScene=function(e,t,n,o){var i=this,s=n||1e3,r=o||1e3;if(!(this._target&&this._target.length>0)){var a=this._game.scene.systems.tween;if(a&&e&&this._game.scene.name!=e){if(this._target=e,this._bright.alpha=0,this._stage.addChild(this._bright),this._player){var l={x:this._player.get("stage").x,y:this._player.get("stage").y},c=this._game.scene.sys("stage");l=c.transform(l,!1),c.zoomTo(this._game.scene,2,2,l.x,l.y,s,function(){console.log("done")})}a.get(this._bright).to({alpha:1},s).call(function(){i._target&&i._target==e&&i._game.loadScene(e,function(e){if(e){t&&t(e),i._stage.removeChild(i._bright),i._game.scene=e;var n=i._game.scene.systems.tween;n&&(i._bright.alpha=1,i._stage.addChild(i._bright),n.get(i._bright).to({alpha:0},r).call(function(){i._stage.removeChild(i._bright)}))}i._target=""})})}}},e}();t.RpgTransition=o});