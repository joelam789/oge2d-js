System.registerDynamic("games/demo.js",[],!0,function(e,t,n){"use strict";this||self;Object.defineProperty(t,"__esModule",{value:!0}),t.Game1=void 0;var o=function(){function e(){}return e.prototype.onInit=function(e){console.log("on game init: "+e.name),console.log("screen size: "+e.width+"x"+e.height)},e.prototype.sortObjects=function(e){e.zOrder=e.y},e}();t.Game1=o}),System.registerDynamic("scenes/battle1/battle1.js",[],!0,function(e,t,n){"use strict";this||self;Object.defineProperty(t,"__esModule",{value:!0}),t.Scene1=void 0;var o=function(){function e(){this.scene=null,this.path=[]}return e.prototype.onInit=function(e){console.log("on scene init: "+e.name)},e.prototype.onActivate=function(e){this.scene=e,console.log("on scene activate: "+e.name)},e.prototype.onPointerdown=function(e,t){var n=t.data.getLocalPosition(e.components.display.object);console.log("scene onPointerdown: "+e.name+" - x="+n.x+" , y="+n.y)},e.prototype.onUpdate=function(e){},e}();t.Scene1=o}),System.registerDynamic("scenes/battle1/sprites/plot-enemy-fight.js",[],!0,function(e,t,n){"use strict";this||self;var o=t&&t.__generator||function(e,t){var n,o,s,i,r={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(s=2&i[0]?o.return:i[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,i[1])).done)return s;switch(o=0,s&&(i=[2&i[0],s.value]),i[0]){case 0:case 1:s=i;break;case 4:return r.label++,{value:i[1],done:!1};case 5:r.label++,o=i[1],i=[0];continue;case 7:i=r.ops.pop(),r.trys.pop();continue;default:if(!(s=(s=r.trys).length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){r=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){r.label=i[1];break}if(6===i[0]&&r.label<s[1]){r.label=s[1],s=i;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(i);break}s[2]&&r.ops.pop(),r.trys.pop();continue}i=t.call(e,r)}catch(e){i=[6,e],o=0}finally{n=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.PlotEnemyFight=void 0;var s=function(){function e(){}return e.prototype.onUpdate=function(e){var t,n,s,i,r,a,l,c,p,u,g,f,y,h;return o(this,function(o){switch(o.label){case 0:return t=e.scene,n=t.sys("tween"),s=t.sys("motion"),t.game.get("rpg"),console.log("plot started - "+e.name),i=t.spr("enemy1"),r=i.get("display").object,a=t.spr("fighter1"),l=a.get("display").object,c=a.get("display").animation,p=t.spr("effect1"),u=p.get("display").object,g=p.get("display").animation,f=t.spr("num1"),y=f.get("display").object,s.moveTo(i,r.x+50,r.y,10,function(){return e.plot.signal()}),[4,e.plot.wait()];case 1:return o.sent(),c.reset("hurt",!0),c.onComplete=function(){return e.plot.signal("end1")},c.play(!1),p.active=!0,u.x=l.x,u.y=l.y,u.loop=!1,u.animationSpeed=.4,g.reset("style3",!0),g.onComplete=function(){e.plot.signal("end2"),g.reset(),g.onComplete=null,p.active=!1},g.play(!1),t.game.lib("audio").sounds["rpg-fight3"].play(),[4,e.plot.wait(["end1","end2"])];case 2:return o.sent(),h=Math.floor(50*Math.random())+50,f.active=!0,y.x=l.x,y.y=l.y-30,y.alpha=.8,y.text="-"+h.toString(),y.style.fontSize=28,y.style.fill="#ff0000",n.get(y).to({y:l.y-40,alpha:1},500).to({y:l.y-50,alpha:0},500).call(function(){y.active=!1}),s.moveTo(a,l.x+20,l.y,5,function(){s.moveTo(a,l.x-20,l.y,5,function(){e.plot.signal("end1")})}),[4,e.plot.wait("end1")];case 3:return o.sent(),c.reset("stand",!0),c.onComplete=null,c.play(!0),s.moveTo(i,r.x-50,r.y,10,function(){return e.plot.signal("end2")}),[4,e.plot.wait("end2")];case 4:return o.sent(),[4,e.plot.wait(1e3)];case 5:return o.sent(),console.log("plot ended - "+e.name),e.active=!1,t.spr("plot-menu").active=!0,[2]}})},e}();t.PlotEnemyFight=s}),System.registerDynamic("scenes/battle1/sprites/plot-fight.js",[],!0,function(e,t,n){"use strict";this||self;var o=t&&t.__generator||function(e,t){var n,o,s,i,r={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(s=2&i[0]?o.return:i[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,i[1])).done)return s;switch(o=0,s&&(i=[2&i[0],s.value]),i[0]){case 0:case 1:s=i;break;case 4:return r.label++,{value:i[1],done:!1};case 5:r.label++,o=i[1],i=[0];continue;case 7:i=r.ops.pop(),r.trys.pop();continue;default:if(!(s=(s=r.trys).length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){r=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){r.label=i[1];break}if(6===i[0]&&r.label<s[1]){r.label=s[1],s=i;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(i);break}s[2]&&r.ops.pop(),r.trys.pop();continue}i=t.call(e,r)}catch(e){i=[6,e],o=0}finally{n=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.PlotFight=void 0;var s=function(){function e(){}return e.prototype.onUpdate=function(e){var t,n,s,i,r,a,l,c,p,u,g,f,y,h,m;return o(this,function(o){switch(o.label){case 0:return t=e.scene,n=t.sys("tween"),s=t.sys("motion"),t.game.get("rpg"),console.log("plot started - "+e.name),i=t.spr("fighter1"),r=i.get("display").object,a=i.get("display").animation,l=t.spr("enemy1"),c=l.get("display").object,p=l.get("rpg"),u=t.spr("effect1"),g=u.get("display").object,f=u.get("display").animation,y=t.spr("num1"),h=y.get("display").object,s.moveTo(i,r.x-50,r.y,10,function(){return e.plot.signal()}),[4,e.plot.wait()];case 1:return o.sent(),a.reset("fight",!0),a.onComplete=function(){return e.plot.signal("end1")},a.play(!1),u.active=!0,g.x=c.x,g.y=c.y,g.loop=!1,g.animationSpeed=.4,f.reset("style2",!0),f.onComplete=function(){e.plot.signal("end2"),f.reset(),f.onComplete=null,u.active=!1},f.play(!1),t.game.lib("audio").sounds["rpg-fight1"].play(),c.tint=16742263,[4,e.plot.wait(["end1","end2"])];case 2:return o.sent(),m=Math.floor(150*Math.random())+100,p.hp-=m,y.active=!0,h.x=c.x,h.y=c.y-80,h.alpha=.8,h.text="-"+m.toString(),h.style.fontSize=28,h.style.fill="#ff0000",n.get(h).to({y:c.y-90,alpha:1},500).to({y:c.y-100,alpha:0},500).call(function(){h.active=!1}),s.moveTo(l,c.x-20,c.y,5,function(){s.moveTo(l,c.x+20,c.y,5,function(){c.tint=16777215,e.plot.signal("end1")})}),a.reset("stand",!0),a.onComplete=null,a.play(!0),[4,e.plot.wait("end1")];case 3:return o.sent(),p.hp<=0&&(n.blink(c,1200,10,function(){l.active=!1,e.plot.signal("end1")}),t.game.lib("audio").sounds["enemy-cry"].play()),s.moveTo(i,r.x+50,r.y,10,function(){return e.plot.signal("end2")}),p.hp<=0?[4,e.plot.wait(["end1","end2"])]:[3,5];case 4:return o.sent(),[3,8];case 5:return[4,e.plot.wait("end2")];case 6:return o.sent(),[4,e.plot.wait(1e3)];case 7:o.sent(),o.label=8;case 8:return console.log("plot ended - "+e.name),e.active=!1,p.hp<=0?t.spr("plot-win").active=!0:t.spr("plot-enemy-fight").active=!0,[2]}})},e}();t.PlotFight=s}),System.registerDynamic("scenes/battle1/sprites/plot-menu.js",[],!0,function(e,t,n){"use strict";this||self;var o=t&&t.__generator||function(e,t){var n,o,s,i,r={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(s=2&i[0]?o.return:i[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,i[1])).done)return s;switch(o=0,s&&(i=[2&i[0],s.value]),i[0]){case 0:case 1:s=i;break;case 4:return r.label++,{value:i[1],done:!1};case 5:r.label++,o=i[1],i=[0];continue;case 7:i=r.ops.pop(),r.trys.pop();continue;default:if(!(s=(s=r.trys).length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){r=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){r.label=i[1];break}if(6===i[0]&&r.label<s[1]){r.label=s[1],s=i;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(i);break}s[2]&&r.ops.pop(),r.trys.pop();continue}i=t.call(e,r)}catch(e){i=[6,e],o=0}finally{n=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.PlotMenu=void 0;var s=function(){function e(){}return e.prototype.onUpdate=function(e){var t,n,s,i;return o(this,function(o){switch(o.label){case 0:return t=e.scene,t.sys("tween"),t.sys("motion"),t.game.get("rpg"),n=t.get("rpg"),console.log("plot started - "+e.name),[4,e.plot.wait(100)];case 1:o.sent(),(s=t.spr("list-box1").code).show(e,["Attack","Magic","Items","Defend","Escape"]),console.log("Please select an item"),o.label=2;case 2:return[4,e.plot.wait()];case 3:return o.sent(),console.log("Selected - "+s.selected),1==s.selected?(s.cleanup(),n.previous=e.name,t.spr("plot-select-enemy").active=!0,[3,4]):5==s.selected?(s.close(),console.log("Okay... you selected to give up"),[3,4]):(console.log("Please select a correct item"),[3,2]);case 4:if(console.log("plot ended - "+e.name),e.active=!1,5==s.selected){if((i=e.scene.systems.transition).isWorking())return[2];t.game.lib("audio").musics["rpg-battle"].stop(),i.callScene(t.game.get("rpg").lastmap)}return[2]}})},e}();t.PlotMenu=s}),System.registerDynamic("scenes/battle1/sprites/plot-select-enemy.js",[],!0,function(e,t,n){"use strict";this||self;var o=t&&t.__generator||function(e,t){var n,o,s,i,r={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(s=2&i[0]?o.return:i[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,i[1])).done)return s;switch(o=0,s&&(i=[2&i[0],s.value]),i[0]){case 0:case 1:s=i;break;case 4:return r.label++,{value:i[1],done:!1};case 5:r.label++,o=i[1],i=[0];continue;case 7:i=r.ops.pop(),r.trys.pop();continue;default:if(!(s=(s=r.trys).length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){r=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){r.label=i[1];break}if(6===i[0]&&r.label<s[1]){r.label=s[1],s=i;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(i);break}s[2]&&r.ops.pop(),r.trys.pop();continue}i=t.call(e,r)}catch(e){i=[6,e],o=0}finally{n=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.PlotSelectEnemy=void 0;var s=function(){function e(){}return e.prototype.onUpdate=function(e){var t,n,s,i;return o(this,function(o){switch(o.label){case 0:t=e.scene,t.sys("tween"),t.sys("motion"),t.game.get("rpg"),n=t.get("rpg"),console.log("plot started - "+e.name),s=t.spr("list-box1").code,(i=[]).push.apply(i,n.enemyTeam),i.push("Go Back"),s.show(e,i),console.log("Please select an enemy"),o.label=1;case 1:return[4,e.plot.wait()];case 2:return o.sent(),console.log("Selected - "+s.selected),1==s.selected?(s.close(),n.fighter="fighter1",n.target="enemy1",t.spr("plot-fight").active=!0,[3,3]):s.selected==i.length?(s.cleanup(),t.spr(n.previous).active=!0,[3,3]):(console.log("Please select a correct enemy"),[3,1]);case 3:return e.active=!1,[2]}})},e}();t.PlotSelectEnemy=s}),System.registerDynamic("scenes/battle1/sprites/plot-win.js",[],!0,function(e,t,n){"use strict";this||self;var o=t&&t.__generator||function(e,t){var n,o,s,i,r={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(s=2&i[0]?o.return:i[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,i[1])).done)return s;switch(o=0,s&&(i=[2&i[0],s.value]),i[0]){case 0:case 1:s=i;break;case 4:return r.label++,{value:i[1],done:!1};case 5:r.label++,o=i[1],i=[0];continue;case 7:i=r.ops.pop(),r.trys.pop();continue;default:if(!(s=(s=r.trys).length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){r=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){r.label=i[1];break}if(6===i[0]&&r.label<s[1]){r.label=s[1],s=i;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(i);break}s[2]&&r.ops.pop(),r.trys.pop();continue}i=t.call(e,r)}catch(e){i=[6,e],o=0}finally{n=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.PlotWin=void 0;var s=function(){function e(){}return e.prototype.onUpdate=function(e){var t,n,s,i;return o(this,function(o){switch(o.label){case 0:return t=e.scene,t.sys("tween"),t.sys("motion"),t.game.get("rpg"),console.log("plot started - "+e.name),n=t.spr("fighter1"),n.get("display").object,(s=n.get("display").animation).reset("win",!0),s.onComplete=null,s.play(!0),t.game.lib("audio").musics["rpg-battle"].stop(),t.game.lib("audio").sounds["rpg-win2"].play(),[4,e.plot.wait(4500)];case 1:return o.sent(),console.log("plot ended - "+e.name),e.active=!1,(i=e.scene.systems.transition).isWorking()?[2]:(i.callScene("map1"),[2])}})},e}();t.PlotWin=s}),System.registerDynamic("scenes/dialog/sprites/answer-box1.js",[],!0,function(e,t,n){"use strict";this||self;Object.defineProperty(t,"__esModule",{value:!0}),t.SceneDialogSpriteAnswerBox1=void 0;var o=function(){function e(){this.selected=0,this.answering=!1,this.textRelativeX=50,this.textRelativeY=20,this.iconRelativeX=30,this.iconRelativeY=28}return e.prototype.show=function(e,t,n,o,s){void 0===n&&(n=150),void 0===o&&(o=40),void 0===s&&(s=80);var i=e.scene,r=i.sprites["dialog-msg1"];r&&r.custom&&(r.custom.more=!1,r.custom.history="");var a=e.scene.sprites["dialog-box1"];a&&a.custom&&(a.custom.status="wait");for(var l=0,c=n,p=o,u=0,g=t;u<g.length;u++){var f=g[u];l++;var y=i.getFreeSprite("answer-box1"),h=i.getFreeSprite("answer-msg1"),m=y.get("display").object,d=h.get("display").object;if(m.x=c,m.y=p,y.custom||(y.custom={}),y.custom.flag=l,y.active=!0,d.x=c+this.textRelativeX,d.y=p+this.textRelativeY,d.text=f,h.active=!0,1==l){var v=i.sprites["answer-icon1"];v.custom||(v.custom={}),v.custom.flag=l;var b=v.get("display").object;b.x=c+this.iconRelativeX,b.y=p+this.iconRelativeY,v.active=!0}p+=s}this.answering=!0},e.prototype.close=function(){for(var e=this.owner,t=0,n=e.scene.pools["answer-box1"];t<n.length;t++){(i=n[t]).active=!1,i.custom&&(i.custom.flag=0)}for(var o=0,s=e.scene.pools["answer-msg1"];o<s.length;o++){var i;(i=s[o]).active=!1}var r=e.scene.sprites["answer-icon1"];r.custom.flag=0,r.active=!1,this.answering=!1},e.prototype.getChoice=function(){return this.selected},e.prototype.isAnswering=function(){return this.answering},e.prototype.moveCursorTo=function(e){if(e&&e.active){var t=e.scene.sprites["answer-icon1"];if(t&&t.active){var n=t.get("display").object,o=e,s=o.get("display").object;n.x=s.x+this.iconRelativeX,n.y=s.y+this.iconRelativeY,t.custom.flag=o.custom.flag}}},e.prototype.moveCursor=function(e){void 0===e&&(e="down");var t=this.owner,n=t.scene.sprites["answer-icon1"];if(n&&n.active){var o=0;if("down"==e?o++:"up"==e&&o--,0!=o){for(var s=0,i=0,r=0,a=0,l=0,c=t.scene.pools["answer-box1"];l<c.length;l++){var p=c[l];if(p.active&&p.custom&&p.custom.flag>0){s++;var u=p.get("display").object;1==s&&(r=u.y+this.iconRelativeY),2==s&&(i=u.y-a),a=u.y}}a+=this.iconRelativeY;var g=n.get("display").object;if(o<0)(f=g.y-i)<r?(f=a,g.y=f,n.custom.flag=s):(g.y=f,n.custom.flag-=1);else if(o>0){var f;(f=g.y+i)>a?(f=r,g.y=f,n.custom.flag=1):(g.y=f,n.custom.flag+=1)}}}},e.prototype.selectAnswer=function(e){var t=e&&e.custom?e.custom.flag:0;this.selected=t,this.close();var n=e.scene.sprites["dialog-msg1"];n&&n.code.onDisplayDone(!1);var o=e.scene.sprites["dialog-box1"];o&&o.code.next()},e.prototype.onPointerdown=function(e,t){this.moveCursorTo(e)},e.prototype.onPointerup=function(e,t){this.selectAnswer(e)},e}();t.SceneDialogSpriteAnswerBox1=o}),System.registerDynamic("scenes/dialog/sprites/dialog-box1.js",[],!0,function(e,t,n){"use strict";this||self;Object.defineProperty(t,"__esModule",{value:!0}),t.SceneDialogSpriteDialogBox1=void 0;var o=function(){function e(){}return e.prototype.show=function(e,t,n,o){void 0===n&&(n=50),void 0===o&&(o=!1);var s=e.scene.sys("tween"),i=e.scene.sprites["dialog-box1"],r=e.scene.sprites["dialog-msg1"],a=e.scene.sprites["dialog-icon1"];if(i&&r&&a){var l=i.active,c=i.get("display").object;i.custom||(i.custom={},c&&(i.custom.posY=c.y,i.custom.maxH=c.height,i.custom.minH=60)),r.custom||(r.custom={}),i.custom.status="open",i.custom.plot=e.name;var p=r.custom.history?r.custom.history:"";r.custom.current=t.join("\n"),r.get("text").content=p+r.custom.current,r.get("display").object.text=p,r.custom.content=p+r.custom.current;var u=!l&&s&&c&&i.custom.posY&&i.custom.maxH&&i.custom.minH;u&&(c.y=i.custom.posY+(i.custom.maxH-i.custom.minH)/2,c.height=i.custom.minH),i.active=!0,r.active=!!r.custom.history,a.active=!1,u?s.get(c).to({y:i.custom.posY,height:i.custom.maxH},120).call(function(){r.active=!0,r.code.updateText(n,o)}):(r.active=!0,e.scene.timeout(150,function(){return r.code.updateText(n,o)}))}},e.prototype.next=function(){var e=this.owner,t=e.scene.sprites["dialog-box1"],n=t&&t.custom?t.custom.status:"";if("done"==n||"more"==n){var o=e.scene.sprites[t.custom.plot];o&&o.plot.signal()}else if("open"==n){var s=e.scene.sprites["dialog-msg1"];s&&s.custom&&s.custom.content&&(s.get("display").object.text=s.custom.content)}},e.prototype.close=function(e){void 0===e&&(e=!0);var t=this.owner,n=t.scene.sys("tween"),o=t.scene.sprites["dialog-box1"],s=t.scene.sprites["dialog-msg1"],i=t.scene.sprites["dialog-icon1"];if(o&&s&&i){s.active=!1,i.active=!1;var r=o.active,a=o.get("display").object;if(r&&n&&a&&o.custom.posY&&o.custom.maxH&&o.custom.minH&&e)n.get(a).to({y:o.custom.posY+(o.custom.maxH-o.custom.minH)/2,height:o.custom.minH},120).call(function(){o.active=!1,a.y=o.custom.posY,a.height=o.custom.maxH;var e=t.scene.sys("rpg-map");e&&e.stopNpcWaiting(t.scene)});else o.active=!1,(l=t.scene.sys("rpg-map"))&&l.stopNpcWaiting(t.scene)}else{var l;(l=t.scene.sys("rpg-map"))&&l.stopNpcWaiting(t.scene)}},e.prototype.isAnswering=function(){var e=this.owner.scene.spr("answer-box1").code;return e&&e.isAnswering()},e.prototype.getChoice=function(){var e=this.owner.scene.spr("answer-box1").code;return e?e.getChoice():0},e.prototype.moveCursor=function(e){var t=this.owner.scene.spr("answer-box1").code;t&&t.moveCursor(e)},e.prototype.selectAnswer=function(){var e=this.owner,t=e.scene.spr("answer-icon1"),n=e.scene.spr("answer-box1").code;n&&t&&n.selectAnswer(t)},e.prototype.list=function(e,t,n,o,s){void 0===n&&(n=150),void 0===o&&(o=40),void 0===s&&(s=80);var i=e.scene.spr("answer-box1").code;i&&i.show(e,t,n,o,s)},e.prototype.onPointerup=function(e,t){this.next()},e}();t.SceneDialogSpriteDialogBox1=o}),System.registerDynamic("scenes/dialog/sprites/dialog-icon1.js",[],!0,function(e,t,n){"use strict";this||self;Object.defineProperty(t,"__esModule",{value:!0}),t.SceneDialogSpriteDialogIcon1=void 0;var o=function(){function e(){}return e.prototype.onActivate=function(e){var t=e.scene.sprites["dialog-box1"];t&&t.active&&e.scene.timeout(500,function(){e.active=!1,e.scene.timeout(300,function(){e.active=t.active&&"done"==t.custom.status})})},e}();t.SceneDialogSpriteDialogIcon1=o}),System.registerDynamic("scenes/dialog/sprites/dialog-msg1.js",[],!0,function(e,t,n){"use strict";this||self;Object.defineProperty(t,"__esModule",{value:!0}),t.SceneDialogSpriteDialogMsg1=void 0;var o=function(){function e(){}return e.prototype.updateText=function(e,t){var n=this;void 0===e&&(e=50),void 0===t&&(t=!1);var o=e;(!o||o<1)&&(o=1),o>100&&(o=100);var s=this.owner;if(s.custom&&s.custom.content){var i=s.get("display").object.text.length;s.custom.content.length>i?(s.get("display").object.text=s.custom.content.substr(0,i+1),s.scene.timeout(100/o*10,function(){return n.updateText(o,t)})):s.custom.content.length==i&&(s.custom.more=t,s.custom.history=t?s.custom.history+s.custom.current:"",s.custom.content="",this.onDisplayDone())}},e.prototype.onDisplayDone=function(e){void 0===e&&(e=!0);var t=this.owner,n=t.scene.sprites["dialog-box1"],o=t.scene.sprites["dialog-icon1"];n&&o&&(t.custom&&t.custom.more?(n.custom.status="more",n.code.next()):(e&&(o.active=!0),n.custom.status="done"))},e}();t.SceneDialogSpriteDialogMsg1=o}),System.registerDynamic("scenes/info/sprites/fps1.js",[],!0,function(e,t,n){"use strict";this||self;Object.defineProperty(t,"__esModule",{value:!0}),t.SceneInfoSpriteFps1=void 0;var o=function(){function e(){}return e.prototype.onSceneActivate=function(e){var t=e.scene.get("display").bgcolor;console.log(t),e.get("display").object.style.fill="#ffffff"==t?"#000000":"#ffffff"},e}();t.SceneInfoSpriteFps1=o}),System.registerDynamic("scenes/list/sprites/list-box1.js",[],!0,function(e,t,n){"use strict";this||self;Object.defineProperty(t,"__esModule",{value:!0}),t.SceneListSpriteListBox1=void 0;var o=function(){function e(){this.plotName="",this.selected=0,this.listing=!1,this.textRelativeX=50,this.textRelativeY=10,this.iconRelativeX=30,this.iconRelativeY=18}return e.prototype.show=function(e,t,n,o,s,i){void 0===n&&(n=260),void 0===o&&(o=40),void 0===s&&(s=180),void 0===i&&(i=30);var r=e.scene,a=e.game.lib("audio"),l=0,c=n,p=o,u=e.scene.sprites["list-box1"];if(u){var g=u.get("display").object;g.x=c,g.y=p,g.width=s,t&&t.length>0&&(g.height=i*(t.length+2)-i/2),u.active||a.sounds["menu-popup"].play(),u.active=!0}p+=i/2;for(var f=0,y=t;f<y.length;f++){var h=y[f];l++;var m=r.getFreeSprite("list-item1"),d=r.getFreeSprite("list-label1"),v=m.get("display").object,b=d.get("display").object;if(v.x=c,v.y=p,m.custom||(m.custom={}),m.custom.flag=l,m.active=!0,b.x=c+this.textRelativeX,b.y=p+this.textRelativeY,b.text=h,d.active=!0,1==l){var w=r.sprites["list-cursor1"];w.custom||(w.custom={}),w.custom.flag=l;var x=w.get("display").object;x.x=c+this.iconRelativeX,x.y=p+this.iconRelativeY,w.active=!0}p+=i}this.plotName=e.name,this.listing=!0},e.prototype.cleanup=function(){for(var e=this.owner,t=0,n=e.scene.pools["list-item1"];t<n.length;t++){(i=n[t]).active=!1,i.custom&&(i.custom.flag=0)}for(var o=0,s=e.scene.pools["list-label1"];o<s.length;o++){var i;(i=s[o]).active=!1}var r=e.scene.sprites["list-cursor1"];r.custom&&(r.custom.flag=0),r.active=!1,this.plotName&&(this.plotName="")},e.prototype.close=function(){this.cleanup(),this.owner.scene.sprites["list-box1"].active=!1,this.listing=!1},e.prototype.getChoice=function(){return this.selected},e.prototype.isListing=function(){return this.listing},e.prototype.moveCursorTo=function(e){if(e&&e.active){var t=e.scene.sprites["list-cursor1"];if(t&&t.active){var n=t.get("display").object,o=e,s=o.get("display").object;n.x=s.x+this.iconRelativeX,n.y=s.y+this.iconRelativeY,t.custom.flag=o.custom.flag}}},e.prototype.moveCursor=function(e){void 0===e&&(e="down");var t=this.owner,n=t.scene.sprites["list-cursor1"];if(n&&n.active){var o=0;if("down"==e?o++:"up"==e&&o--,0!=o){for(var s=0,i=0,r=0,a=0,l=0,c=t.scene.pools["list-item1"];l<c.length;l++){var p=c[l];if(p.active&&p.custom&&p.custom.flag>0){s++;var u=p.get("display").object;1==s&&(r=u.y+this.iconRelativeY),2==s&&(i=u.y-a),a=u.y}}a+=this.iconRelativeY;var g=n.get("display").object;if(o<0)(f=g.y-i)<r?(f=a,g.y=f,n.custom.flag=s):(g.y=f,n.custom.flag-=1);else if(o>0){var f;(f=g.y+i)>a?(f=r,g.y=f,n.custom.flag=1):(g.y=f,n.custom.flag+=1)}t.game.lib("audio").sounds["move-cursor"].play()}}},e.prototype.selectItem=function(e){void 0===e&&(e=null);var t=e;t||(t=this.owner.scene.sprites["list-cursor1"]);var n=t&&t.custom?t.custom.flag:0;this.selected=n,t&&this.plotName&&t.scene.sprites[this.plotName].plot.signal(),t&&t.game.lib("audio").sounds["menu-select"].play(),console.log("ListBox1 - onPointerup",t.name,this.selected)},e.prototype.onPointerup=function(e,t){},e}();t.SceneListSpriteListBox1=o}),System.registerDynamic("scenes/list/sprites/list-item1.js",[],!0,function(e,t,n){"use strict";this||self;Object.defineProperty(t,"__esModule",{value:!0}),t.SceneListSpriteItem1=void 0;var o=function(){function e(){}return e.prototype.onPointerdown=function(e,t){var n=e.scene.sprites["list-box1"];n&&n.code.moveCursorTo(e)},e.prototype.onPointerup=function(e,t){var n=e.scene.sprites["list-box1"];n&&n.code.selectItem(e)},e}();t.SceneListSpriteItem1=o}),System.registerDynamic("scenes/map1/map1.js",[],!0,function(e,t,n){"use strict";this||self;Object.defineProperty(t,"__esModule",{value:!0}),t.Scene1=void 0;var o=function(){function e(){this.sceneName=null,this.path=[]}return e.prototype.onInit=function(e){console.log("on scene init: "+e.name)},e.prototype.onActivate=function(e){this.sceneName=e.name;var t=e.get("rpg");console.log("on scene activate: "+e.name+" ("+t.times+")");var n=e.game.lib("audio").musics[t.bgm];n.volume=1,n.play()},e.prototype.onUpdate=function(e){},e}();t.Scene1=o}),System.registerDynamic("scenes/map1/sprites/npc1.js",[],!0,function(e,t,n){"use strict";this||self;Object.defineProperty(t,"__esModule",{value:!0}),t.Map1Npc1=void 0;var o=function(){function e(){}return e.prototype.onUpdate=function(e){},e.prototype.onSceneActivate=function(e){console.log("Npc - onSceneActivate: "+e.name),e.base.onSceneActivate(e)},e}();t.Map1Npc1=o}),System.registerDynamic("scenes/map1/sprites/player1.js",[],!0,function(e,t,n){"use strict";this||self;Object.defineProperty(t,"__esModule",{value:!0}),t.Map1Player1=void 0;var o=function(){function e(){}return e.prototype.onUpdate=function(e){},e.prototype.onSceneActivate=function(e){console.log("Player - onSceneActivate: "+e.name),e.base.onSceneActivate(e)},e}();t.Map1Player1=o}),System.registerDynamic("scenes/map1/sprites/plot1.js",[],!0,function(e,t,n){"use strict";this||self;var o=t&&t.__generator||function(e,t){var n,o,s,i,r={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(s=2&i[0]?o.return:i[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,i[1])).done)return s;switch(o=0,s&&(i=[2&i[0],s.value]),i[0]){case 0:case 1:s=i;break;case 4:return r.label++,{value:i[1],done:!1};case 5:r.label++,o=i[1],i=[0];continue;case 7:i=r.ops.pop(),r.trys.pop();continue;default:if(!(s=(s=r.trys).length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){r=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){r.label=i[1];break}if(6===i[0]&&r.label<s[1]){r.label=s[1],s=i;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(i);break}s[2]&&r.ops.pop(),r.trys.pop();continue}i=t.call(e,r)}catch(e){i=[6,e],o=0}finally{n=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.Plot1=void 0;var s=function(){function e(){}return e.prototype.onUpdate=function(e){var t,n;return o(this,function(o){switch(o.label){case 0:return t=e.scene,t.sys("stage"),t.sys("tween"),t.sys("motion"),t.game.get("rpg"),console.log("plot started - "+e.name),[4,e.plot.wait(1e3)];case 1:return o.sent(),n=t.get("stage").follow,console.log("following - "+n),console.log("plot ended - "+e.name),e.active=!1,[2]}})},e}();t.Plot1=s}),System.registerDynamic("scenes/map1/sprites/plot2.js",[],!0,function(e,t,n){"use strict";this||self;var o=t&&t.__generator||function(e,t){var n,o,s,i,r={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(s=2&i[0]?o.return:i[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,i[1])).done)return s;switch(o=0,s&&(i=[2&i[0],s.value]),i[0]){case 0:case 1:s=i;break;case 4:return r.label++,{value:i[1],done:!1};case 5:r.label++,o=i[1],i=[0];continue;case 7:i=r.ops.pop(),r.trys.pop();continue;default:if(!(s=(s=r.trys).length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){r=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){r.label=i[1];break}if(6===i[0]&&r.label<s[1]){r.label=s[1],s=i;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(i);break}s[2]&&r.ops.pop(),r.trys.pop();continue}i=t.call(e,r)}catch(e){i=[6,e],o=0}finally{n=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.Plot2=void 0;var s=function(){function e(){}return e.prototype.onUpdate=function(e){var t,n;return o(this,function(o){switch(o.label){case 0:return t=e.scene,t.sys("stage"),t.sys("tween"),t.sys("motion"),t.game.get("rpg"),console.log("plot started - "+e.name),(n=t.spr("dialog-box1").code).show(e,["God:","","Welcome! My dear boy!","You will be the next new hero soon.","So please go and make yourself stronger."]),[4,e.plot.wait()];case 1:return o.sent(),n.show(e,["神之声：","","孩子，你是被命运选中的英雄 ——"],50,!0),[4,e.plot.wait()];case 2:return o.sent(),n.show(e,[" 天选之子！ "],2,!0),[4,e.plot.wait()];case 3:return o.sent(),n.show(e,["","没什么好害怕，神的意志和光辉将会与你同在。","只要无时无刻谨记神的教诲，神的力量会一直保护你。"]),[4,e.plot.wait()];case 4:return o.sent(),n.show(e,["評価項目:","","舞台となる惑星は、地球ではありません。","古風な雰囲気のある分かりやすい操作の見下ろし型アクション。","世界観が作りこまれているのに、肝心のメインストーリーがお粗末です。"]),[4,e.plot.wait()];case 5:return o.sent(),n.close(),console.log("plot ended - "+e.name),e.active=!1,[2]}})},e}();t.Plot2=s}),System.registerDynamic("scenes/map1/sprites/plot3.js",[],!0,function(e,t,n){"use strict";this||self;var o=t&&t.__generator||function(e,t){var n,o,s,i,r={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(s=2&i[0]?o.return:i[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,i[1])).done)return s;switch(o=0,s&&(i=[2&i[0],s.value]),i[0]){case 0:case 1:s=i;break;case 4:return r.label++,{value:i[1],done:!1};case 5:r.label++,o=i[1],i=[0];continue;case 7:i=r.ops.pop(),r.trys.pop();continue;default:if(!(s=(s=r.trys).length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){r=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){r.label=i[1];break}if(6===i[0]&&r.label<s[1]){r.label=s[1],s=i;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(i);break}s[2]&&r.ops.pop(),r.trys.pop();continue}i=t.call(e,r)}catch(e){i=[6,e],o=0}finally{n=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.Plot3=void 0;var s=function(){function e(){}return e.prototype.onUpdate=function(e){var t,n,s,i,r,a,l;return o(this,function(o){switch(o.label){case 0:return t=e.scene,t.sys("stage"),t.sys("tween"),t.sys("motion"),t.game.get("rpg"),console.log("plot started - "+e.name),n=e.get("rpg"),s=t.spr("dialog-box1").code,0!=n.times?[3,2]:(s.show(e,["Man:","","I am a farmer living in the forest.","Do you know what is Forest Farming?","That is what I am doing here to make a living."]),[4,e.plot.wait()]);case 1:return o.sent(),s.close(),n.times+=1,[3,6];case 2:return s.show(e,["Man:","","Do you like farmers?"],50,!0),[4,e.plot.wait()];case 3:return o.sent(),s.list(e,["Yes.","No.","I won't tell you."]),[4,e.plot.wait()];case 4:return o.sent(),i=["I am glad to hear that.","You should get to know more about them.","Okay..."],s.show(e,["Man:","",i[s.getChoice()-1]]),[4,e.plot.wait()];case 5:o.sent(),2!=s.getChoice()?s.close():(s.close(!1),(r=e.scene.systems["rpg-transition"]).isWorking()?s.close():(a=t.game.lib("audio").musics[t.get("rpg").bgm],l=t.game.lib("audio").musics["rpg-battle"],a.stop(),l.play(),t.game.get("rpg").lastmap=t.name,r.callScene("battle1",function(e){e.reset()},500,1e3))),o.label=6;case 6:return console.log("plot ended - "+e.name),e.active=!1,[2]}})},e}();t.Plot3=s}),System.registerDynamic("scenes/map1/sprites/plot4.js",[],!0,function(e,t,n){"use strict";this||self;var o=t&&t.__generator||function(e,t){var n,o,s,i,r={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(s=2&i[0]?o.return:i[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,i[1])).done)return s;switch(o=0,s&&(i=[2&i[0],s.value]),i[0]){case 0:case 1:s=i;break;case 4:return r.label++,{value:i[1],done:!1};case 5:r.label++,o=i[1],i=[0];continue;case 7:i=r.ops.pop(),r.trys.pop();continue;default:if(!(s=(s=r.trys).length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){r=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){r.label=i[1];break}if(6===i[0]&&r.label<s[1]){r.label=s[1],s=i;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(i);break}s[2]&&r.ops.pop(),r.trys.pop();continue}i=t.call(e,r)}catch(e){i=[6,e],o=0}finally{n=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.Plot3=void 0;var s=function(){function e(){}return e.prototype.onUpdate=function(e){var t,n;return o(this,function(o){switch(o.label){case 0:return t=e.scene,t.sys("stage"),t.sys("tween"),t.sys("motion"),t.game.get("rpg"),console.log("plot started - "+e.name),(n=t.spr("dialog-box1").code).show(e,["Old Man:","","I am looking for my grandson.","He is clever, but also a naughty kid.","If you see him please tell him to go home."]),[4,e.plot.wait()];case 1:return o.sent(),n.close(),console.log("plot ended - "+e.name),e.active=!1,[2]}})},e}();t.Plot3=s}),System.registerDynamic("scenes/map1/sprites/plot5.js",[],!0,function(e,t,n){"use strict";this||self;var o=t&&t.__generator||function(e,t){var n,o,s,i,r={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(s=2&i[0]?o.return:i[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,i[1])).done)return s;switch(o=0,s&&(i=[2&i[0],s.value]),i[0]){case 0:case 1:s=i;break;case 4:return r.label++,{value:i[1],done:!1};case 5:r.label++,o=i[1],i=[0];continue;case 7:i=r.ops.pop(),r.trys.pop();continue;default:if(!(s=(s=r.trys).length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){r=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){r.label=i[1];break}if(6===i[0]&&r.label<s[1]){r.label=s[1],s=i;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(i);break}s[2]&&r.ops.pop(),r.trys.pop();continue}i=t.call(e,r)}catch(e){i=[6,e],o=0}finally{n=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.Plot3=void 0;var s=function(){function e(){}return e.prototype.onUpdate=function(e){var t,n;return o(this,function(o){switch(o.label){case 0:return t=e.scene,t.sys("stage"),t.sys("tween"),t.sys("motion"),t.game.get("rpg"),console.log("plot started - "+e.name),(n=t.spr("dialog-box1").code).show(e,["Kid:","","Here is my secret garden.","I feel peaceful and calm everytime when I get here."]),[4,e.plot.wait()];case 1:return o.sent(),n.show(e,["Kid:","","You look not a bad guy.","Could you please come and play with me?"]),[4,e.plot.wait()];case 2:return o.sent(),n.close(),console.log("plot ended - "+e.name),e.active=!1,[2]}})},e}();t.Plot3=s}),System.registerDynamic("scenes/preload/preload.js",[],!0,function(e,t,n){"use strict";this||self;Object.defineProperty(t,"__esModule",{value:!0}),t.ScenePreload=void 0;var o=function(){function e(){this.nextSceneName="map1",this.preloadScenes=["info","dialog","list","map1","battle1"],this.preloadPackFiles=["pack2.pack","pack3.pack"],this.signs=[".","..","...","....",".....","......"],this.times=0,this.moveon=!1,this.progress=0,this.message="Loading"}return e.prototype.onInit=function(e){console.log("on scene init: "+e.name)},e.prototype.onActivate=function(e){var t=this;console.log("on scene activate: "+e.name),this.times=0,this.moveon=!1,this.progress=0,this.message="Loading";var n=e.spr("progress1");n.get("display").object.scale.x=10,e.game.lib("preload").loadPacks(this.preloadPackFiles,function(){console.log("finished loading packages"),e.game.loadScenes(t.preloadScenes,function(){console.log("finished loading scenes"),t.progress=100,t.message="Done";e.spr("label2").active=!0,e.spr("button1").active=!0,e.components.event.onPointerdown=function(){var n=e.systems.transition;n&&!n.isWorking()&&n.callScene(t.nextSceneName)}},function(e){var o=.5+e/200;n.get("display").object.scale.x=420*o,t.message="Loading scenes",t.progress=Math.round(100*o)})},function(e,o){if(e>0&&o>0){var s=e/o/2;n.get("display").object.scale.x=420*s,t.message="Loading packages",t.progress=Math.round(100*s)}}),this.moveon=!0},e.prototype.onUpdate=function(e){var t=this;if(this.moveon){this.times+=1,this.moveon=!1;var n=e.spr("label1"),o=e.spr("number1");if(this.message){var s=this.message;this.progress<100&&(s+=this.signs[this.times%this.signs.length]),n.get("display").object.text=s}else n.get("display").object.text="";o.get("display").object.text=this.progress+"%",e.timeout(100,function(){return t.moveon=!0})}},e}();t.ScenePreload=o}),System.registerDynamic("sprites/bar.js",[],!0,function(e,t,n){"use strict";this||self;Object.defineProperty(t,"__esModule",{value:!0}),t.SpriteBar=void 0;var o=function(){function e(){}return e.prototype.prepareTexture=function(e){var t=e.scene.name+"."+(e.origin?e.origin.name:e.name),n=e.game.lib("image").getTexture(t);if(n)return n;var o="#FFFFFF";e.components["custom-display"]&&e.components["custom-display"].color&&(o=e.components["custom-display"].color.toString()).length>1&&"#"==o.charAt(0)&&parseInt(o.substring(1),16);var s=document.createElement("canvas");s.width=s.height=1;var i=s.getContext("2d");return i.fillStyle=o,i.fillRect(0,0,1,1),n=PIXI.Texture.from(s),e.game.lib("image").setTexture(t,n),n},e}();t.SpriteBar=o}),System.registerDynamic("sprites/boy.js",[],!0,function(e,t,n){"use strict";this||self;Object.defineProperty(t,"__esModule",{value:!0}),t.SpriteBoy=void 0;var o=function(){function e(){}return e.prototype.prepareSpriteAsync=function(e,t){var n=e.components.spine;e.game.lib("image").loadImageByType(n.png,1,function(o){o||t(null),e.game.lib("json").loadString(n.atlas,function(s){s||t(null),e.game.lib("json").loadJson(n.json,function(e){e||t(null);var n=e,i=s,r=new PIXI.spine.core.TextureAtlas(i,function(e,t){t(o)}),a=new PIXI.spine.core.AtlasAttachmentLoader(r),l=new PIXI.spine.core.SkeletonJson(a).readSkeletonData(n),c=new PIXI.spine.Spine(l);c.state.hasAnimation("walk")&&c.state.setAnimation(0,"walk",!0),t(c)})})})},e}();t.SpriteBoy=o}),System.registerDynamic("sprites/enemy.js",[],!0,function(e,t,n){"use strict";this||self;Object.defineProperty(t,"__esModule",{value:!0}),t.SpriteEnemy=void 0;var o=function(){function e(){}return e.prototype.onActivate=function(e){},e}();t.SpriteEnemy=o}),System.registerDynamic("sprites/fighter.js",[],!0,function(e,t,n){"use strict";this||self;Object.defineProperty(t,"__esModule",{value:!0}),t.SpriteFighter=void 0;var o=function(){function e(){}return e.prototype.onSceneActivate=function(e){console.log("onSceneActivate - "+e.name)},e}();t.SpriteFighter=o}),System.registerDynamic("sprites/fps.js",[],!0,function(e,t,n){"use strict";this||self;Object.defineProperty(t,"__esModule",{value:!0}),t.SpriteFps=void 0;var o=function(){function e(){}return e.prototype.onUpdate=function(e){var t=e.components.display;t&&t.object&&(t.object.text=Math.round(e.game.fps).toString())},e}();t.SpriteFps=o}),System.registerDynamic("sprites/icon-triangle.js",[],!0,function(e,t,n){"use strict";this||self;Object.defineProperty(t,"__esModule",{value:!0}),t.SpriteTriangle=void 0;var o=function(){function e(){}return e.prototype.prepareTexture=function(e){var t=e.scene.name+"."+(e.origin?e.origin.name:e.name),n=e.game.lib("image").getTexture(t);if(n)return n;var o=document.createElement("canvas");o.width=20,o.height=20;var s=o.getContext("2d");return s.clearRect(0,0,20,20),s.beginPath(),s.moveTo(0,0),s.lineTo(20,0),s.lineTo(10,10),s.closePath(),s.fillStyle="#FFFFFF",s.fill(),n=PIXI.Texture.from(o),e.game.lib("image").setTexture(t,n),n},e}();t.SpriteTriangle=o}),System.registerDynamic("sprites/npc.js",[],!0,function(e,t,n){"use strict";this||self;Object.defineProperty(t,"__esModule",{value:!0}),t.SpriteNpc=void 0;var o=function(){function e(){}return e.prototype.walkOnTile=function(e,t,n,o){var s=this;void 0===n&&(n=2),void 0===o&&(o=null);var i=e.scene.sys("rpg-map"),r=e.get("movement"),a=e.get("display").animation,l=e.scene.systems.motion,c=e.scene.get("stage").gamemap;if(r&&a&&l&&c&&!0!==r.moving){var p=0,u=0;switch(t){case"up":a.set("run_up"),u=-32;break;case"down":a.set("run_down"),u=32;break;case"left":a.set("run_left"),p=-32;break;case"right":a.set("run_right"),p=32;break;default:return}var g=e.get("stage").x+p,f=e.get("stage").y+u,y=c.pixelToTile(g,f);i&&!i.isOccupiedTile(e.scene,null,y.x,y.y)&&0===c.getTileCost(y.x,y.y)?(r.moving=!0,r.next={x:g,y:f},i.occupyTile(e,y.x,y.y),l.moveTo(e,g,f,n,function(){r.moving=!1,r.next=null;var t=c.pixelToTile(g-p,f-u);i.leaveTile(e,t.x,t.y),s.walkOneStep(e,n,o)})):this.walkOneStep(e,n,o)}},e.prototype.walkOneStep=function(e,t,n){void 0===t&&(t=2),void 0===n&&(n=null);var o=e.scene.sys("rpg-map"),s=e.get("movement"),i=e.get("display").animation,r=e.scene.get("stage").gamemap;if(s&&i&&r&&!0!==s.moving){var a=e.get("stage").x,l=e.get("stage").y;if(s.path.length>0){var c=s.path.shift();if(0!==r.getTileCost(c.x,c.y)||o.isOccupiedTile(e.scene,null,c.x,c.y))this.stopWalking(e,"",n);else{var p=r.tileToPixel(c.x,c.y),u=o.getDirection({x:a,y:l},p);this.walkOnTile(e,u,t,n)}}else this.stopWalking(e,"",n)}},e.prototype.walkToTile=function(e,t,n,o,s){var i;void 0===o&&(o=2),void 0===s&&(s=null);var r=e.get("movement"),a=e.scene.get("stage").gamemap,l=r.next&&r.next.x>=0?r.next.x:e.get("stage").x,c=r.next&&r.next.y>=0?r.next.y:e.get("stage").y,p=a.pixelToTile(l,c),u={x:t,y:n},g=a.findPath(p.x,p.y,u.x,u.y,!1,function(t,n,o){return e.scene.sys("rpg-map").isOccupiedTile(e.scene,null,t,n)?-1:o});if(g&&g.length>0)r.path=[],(i=r.path).push.apply(i,g),r.target={x:u.x,y:u.y},r.moving||this.walkOneStep(e,o,s);else{var f=e.scene.sys("rpg-map").getDirection(p,u);f&&e.get("display").animation.set(f),s&&s()}},e.prototype.stopWalking=function(e,t,n){void 0===t&&(t=""),void 0===n&&(n=null);var o=e.scene.sys("rpg-map"),s=e.get("movement"),i=e.get("display").animation,r=e.scene.get("stage").gamemap,a=e.get("stage").x,l=e.get("stage").y;if(s){s.path=[],s.moving=!1;var c="";if(s.target){var p=r.pixelToTile(a,l);c=o.getDirection(p,s.target)}if(i)if(t)i.set(t);else if(c)i.set(c);else{var u=i.current.split("_");u&&u.length>=2&&i.set(u[1])}s.target&&(s.target=null),n&&n()}},e.prototype.walkOnMap=function(e){var t=this,n=e.scene.sys("rpg-map"),o=e.get("movement"),s=e.scene.get("stage").gamemap;n&&o&&s&&!o.waiting&&!0===o.auto?e.scene.timeout(1e3*(Math.floor(3*Math.random())+1),function(){if(!0!==o.waiting){var n=e.get("stage").x,i=e.get("stage").y,r=s.pixelToTile(n,i),a=Math.floor(2*Math.random())+1,l=s.findRange(r.x,r.y,a,!1,function(t,n,s){return t<o.start.x-2||t>o.start.x+2?-1:n<o.start.y-2||n>o.start.y+2?-1:e.scene.sys("rpg-map").isOccupiedTile(e.scene,null,t,n)?-1:s>=0?1:-1});if(l&&l.length>0){var c=Math.floor(Math.random()*l.length);t.walkToTile(e,l[c].x,l[c].y,2,function(){return t.walkOnMap(e)})}else t.walkOnMap(e)}else t.walkOnMap(e)}):e.scene.timeout(1e3*(Math.floor(3*Math.random())+1),function(){return t.walkOnMap(e)})},e.prototype.wait=function(e,t){void 0===t&&(t=!0);var n=e.get("movement");n&&(n.waiting=t)},e.prototype.onUpdate=function(e){},e.prototype.onSceneActivate=function(e){var t=e.scene.get("rpg");if(t&&1==t.times){var n=e.scene.sys("rpg-map"),o=e.scene.get("stage").gamemap,s=e.get("tile");if(s&&o){var i=o.tileToPixel(s.x,s.y);e.get("stage").x=i.x,e.get("stage").y=i.y}if(n&&(n.alignToTile(e),n.occupyCurrentTile(e)),(c=e.get("movement"))&&(c.waiting=!1),o&&c&&!0===c.auto){var r=e.get("stage").x,a=e.get("stage").y,l=o.pixelToTile(r,a);c.start={x:l.x,y:l.y},this.walkOnMap(e)}}else{var c;(n=e.scene.sys("rpg-map"))&&n.occupyCurrentTile(e),(c=e.get("movement"))&&(c.waiting=!1),c&&!0===c.auto&&this.walkOnMap(e)}},e}();t.SpriteNpc=o}),System.registerDynamic("sprites/panel.js",[],!0,function(e,t,n){"use strict";this||self;Object.defineProperty(t,"__esModule",{value:!0}),t.SpritePanel=void 0;var o=function(){function e(){}return e.prototype.onPointerdown=function(e,t){console.log("[base] sprite onPointerdown: "+e.name)},e}();t.SpritePanel=o}),System.registerDynamic("sprites/player.js",[],!0,function(e,t,n){"use strict";this||self;Object.defineProperty(t,"__esModule",{value:!0}),t.SpritePlayer=void 0;var o=function(){function e(){}return e.prototype.walkOnTile=function(e,t,n){var o=this;void 0===n&&(n=2);var s=e.scene.sys("rpg-map"),i=e.get("movement"),r=e.get("display").animation,a=e.scene.systems.motion,l=e.scene.get("stage").gamemap;if(i&&r&&a&&l&&!0!==i.moving){var c=0,p=0;switch(t){case"up":r.set("run_up"),p=-32;break;case"down":r.set("run_down"),p=32;break;case"left":r.set("run_left"),c=-32;break;case"right":r.set("run_right"),c=32;break;default:return}var u=e.get("stage").x+c,g=e.get("stage").y+p,f=l.pixelToTile(u,g);s&&!s.isOccupiedTile(e.scene,[e.name],f.x,f.y)&&0===l.getTileCost(f.x,f.y)?(i.moving=!0,i.next={x:u,y:g},s.occupyTile(e,f.x,f.y),a.moveTo(e,u,g,n,function(){i.moving=!1,i.next=null;var t=l.pixelToTile(u-c,g-p);s.leaveTile(e,t.x,t.y),s.checkMovementControl()?(i.path=[],i.target=null):o.walkOneStep(e,n)})):this.walkOneStep(e,n)}},e.prototype.walkOneStep=function(e,t){void 0===t&&(t=2);var n=e.scene.sys("rpg-map"),o=e.get("movement"),s=e.get("display").animation,i=e.scene.get("stage").gamemap;if(o&&s&&i&&!0!==o.moving){var r=e.get("stage").x,a=e.get("stage").y;if(o.path.length>0){var l=o.path.shift();if(0!==i.getTileCost(l.x,l.y)||n.isOccupiedTile(e.scene,[e.name],l.x,l.y))if(o.path.length>0&&o.target){var c=i.tileToPixel(o.target.x,o.target.y);this.walkTo(e,c.x,c.y,t)}else this.stopWalking(e);else{var p=i.tileToPixel(l.x,l.y),u=n.getDirection({x:r,y:a},p);this.walkOnTile(e,u,t)}}else this.stopWalking(e)}},e.prototype.walkToTile=function(e,t,n,o){var s;void 0===o&&(o=2);var i=e.get("movement"),r=e.scene.get("stage").gamemap,a=i.next&&i.next.x>=0?i.next.x:e.get("stage").x,l=i.next&&i.next.y>=0?i.next.y:e.get("stage").y,c=r.pixelToTile(a,l),p={x:t,y:n},u=r.findPath(c.x,c.y,p.x,p.y,!1,function(t,n,o){return e.scene.sys("rpg-map").isOccupiedTile(e.scene,[e.name],t,n)?-1:o});u&&u.length>0?(i.path=[],(s=i.path).push.apply(s,u),i.target={x:p.x,y:p.y},i.moving||this.walkOneStep(e,o)):(i.path=[],i.target={x:p.x,y:p.y},this.stopWalking(e))},e.prototype.walkTo=function(e,t,n,o){void 0===o&&(o=2);var s=e.scene.sys("rpg-map");if(!s||!s.isTalking()){e.get("movement");var i=e.scene.get("stage").gamemap,r=e.scene.game.get("rpg");if(!r||!1!==r.controllable){var a=i.pixelToTile(t,n);this.walkToTile(e,a.x,a.y,o)}}},e.prototype.stopWalking=function(e,t){void 0===t&&(t="");var n=e.scene.sys("rpg-map"),o=e.get("movement"),s=e.get("display").animation,i=e.scene.get("stage").gamemap,r=e.get("stage").x,a=e.get("stage").y,l=null;if(o){o.path=[],o.moving=!1;var c="",p=null;if(o.target){var u=i.pixelToTile(r,a);c=n.getDirection(u,o.target)}if(s)if(t)s.set(t);else if(c)s.set(c);else{var g=s.current.split("_");g&&g.length>=2&&s.set(g[1])}if(o.target&&((p=n.getNextTile(e))&&p.x==o.target.x&&p.y==o.target.y&&(l=n.getPlotOnTile(e.scene,p.x,p.y)),o.target=null),l){var f=n.getPlotNpc(l),y=f&&n.isNpcWalking(f);if(f&&p&&!n.isNpcWalking(f)){n.startNpcWaiting(f);var h=f.get("display").animation,m=n.getCurrentTile(f),d=n.getCurrentTile(e),v=m?n.getDirection(m,d):null;v&&h&&h.set(v)}(!f||f&&!y)&&(l.active=!0)}}},e.prototype.onUpdate=function(e){},e.prototype.onSceneActivate=function(e){var t=e.scene.get("rpg");if(t&&1==t.times){var n=e.scene.sys("rpg-map"),o=e.scene.get("stage").gamemap,s=e.get("tile");if(s&&o){var i=o.tileToPixel(s.x,s.y);e.get("stage").x=i.x,e.get("stage").y=i.y}n&&(n.alignToTile(e),n.occupyCurrentTile(e));var r=e.get("movement");r&&(r.moving=!1,r.next=null)}else{(n=e.scene.sys("rpg-map"))&&n.occupyCurrentTile(e)}},e}();t.SpritePlayer=o}),System.registerDynamic("sprites/text.js",[],!0,function(e,t,n){"use strict";this||self;Object.defineProperty(t,"__esModule",{value:!0}),t.SpriteText=void 0;var o=function(){function e(){}return e.prototype.onActivate=function(e){},e}();t.SpriteText=o}),System.registerDynamic("systems/rpg-battle.js",[],!0,function(e,t,n){"use strict";this||self;Object.defineProperty(t,"__esModule",{value:!0}),t.RpgBattle=void 0;var o=function(){function e(){this.name="rpg-battle",this.entry=null,this.listbox=null,this.profile=null,this.keyboard=null,this.holdon=!1}return e.prototype.init=function(e){return this.profile=e.components.rpg,console.log("rpg-battle system is loaded successfully"),!0},e.prototype.activate=function(e){var t=this;this.listbox=null,this.holdon=!1,this.keyboard=e.systems.keyboard;var n=e.components.rpg;n&&(n.listbox&&(this.listbox=e.sprites[n.listbox]),n.entry&&(this.entry=e.sprites[n.entry])),this.entry&&e.timeout(500,function(){return t.entry.active=!0})},e.prototype.update=function(e,t){this.handleKeyboard(e)},e.prototype.checkMovementControl=function(){return this.keyboard?this.keyboard.states.ArrowUp?"up":this.keyboard.states.ArrowDown?"down":this.keyboard.states.ArrowLeft?"left":this.keyboard.states.ArrowRight?"right":"":null},e.prototype.checkActionControl=function(){return this.keyboard?this.keyboard.states[" "]?"check":"":null},e.prototype.cleanup=function(e){e.components.rpg},e.prototype.isListing=function(){return this.listbox&&this.listbox.active&&this.listbox.code&&this.listbox.code.isListing()},e.prototype.selectItem=function(){this.listbox&&this.listbox.active&&this.listbox.code&&this.listbox.code.selectItem()},e.prototype.onSceneBattleClick=function(e,t){var n=t.data.getLocalPosition(e.components.display.object);console.log("scene onPointerdown: "+e.name+" - x="+n.x+" , y="+n.y)},e.prototype.handleKeyboard=function(e){var t=this;if(!e.paused&&null!=this.keyboard&&null!=this.keyboard&&null!=this.profile&&null!=this.profile&&!0===this.profile.controllable){var n=window.vbuttons;if(n){var o=n.up,s=n.down,i=n.left,r=n.right;o||s||i||r?(this.keyboard.states.ArrowUp=o,this.keyboard.states.ArrowDown=s,this.keyboard.states.ArrowLeft=i,this.keyboard.states.ArrowRight=r):(this.keyboard.states.ArrowUp=!1,this.keyboard.states.ArrowDown=!1,this.keyboard.states.ArrowLeft=!1,this.keyboard.states.ArrowRight=!1),this.keyboard.states[" "]=!0===n.b1,this.keyboard.states.Escape=!0===n.b2}if(e.game.get("rpg")){var a=this.checkMovementControl(),l=this.checkActionControl();!a&&!l||this.holdon||this.isListing()&&(!a||"up"!=a&&"down"!=a||(this.listbox.code.moveCursor(a),this.holdon=!0,this.listbox.scene.timeout(200,function(){return t.holdon=!1})),l&&!this.holdon&&(this.selectItem(),this.holdon=!0,this.listbox.scene.timeout(200,function(){return t.holdon=!1})))}}},e}();t.RpgBattle=o}),System.registerDynamic("systems/rpg-map.js",[],!0,function(e,t,n){"use strict";this||self;Object.defineProperty(t,"__esModule",{value:!0}),t.RpgMap=void 0;var o=function(){function e(){this.name="rpg-map",this.stage=null,this.player=null,this.dialog=null,this.profile=null,this.keyboard=null,this.holdon=!1}return e.prototype.init=function(e){return this.profile=e.components.rpg,console.log("rpg-map system is loaded successfully"),!0},e.prototype.activate=function(e){this.player=null,this.dialog=null,this.holdon=!1,this.stage=e.systems.stage,this.keyboard=e.systems.keyboard;var t=e.components.rpg;if(t){if(this.cleanupMap(e),t.player&&(this.player=e.sprites[t.player]),this.stage&&this.player){var n=e.game.get("rpg");n&&(n.controllable=!0),this.stage.follow(e,this.player.name)}t.dialog&&(this.dialog=e.sprites[t.dialog]),t.times?t.times+=1:t.times=1}},e.prototype.update=function(e,t){this.handleKeyboard(e)},e.prototype.checkMovementControl=function(){return this.keyboard?this.keyboard.states.ArrowUp?"up":this.keyboard.states.ArrowDown?"down":this.keyboard.states.ArrowLeft?"left":this.keyboard.states.ArrowRight?"right":"":null},e.prototype.checkActionControl=function(){return this.keyboard?this.keyboard.states[" "]?"check":"":null},e.prototype.cleanupMap=function(e){var t=e.components.rpg;t&&(t.tempMarks?t.tempMarks.forEach(function(e,t,n){return e.length=0}):t.tempMarks=new Map)},e.prototype.occupyTile=function(e,t,n){var o=e.scene.components.rpg;if(e.scene.get("stage").gamemap&&o&&o.tempMarks){var s=t+"_"+n;if(o.tempMarks.has(s)){(i=o.tempMarks.get(s)).indexOf(e.name)<0&&i.push(e.name)}else{var i=[e.name];o.tempMarks.set(s,i)}}},e.prototype.leaveTile=function(e,t,n){var o=e.scene.components.rpg;if(e.scene.get("stage").gamemap&&o&&o.tempMarks){var s=t+"_"+n;if(o.tempMarks.has(s)){var i=o.tempMarks.get(s),r=i?i.indexOf(e.name):-1;r>=0&&i.splice(r,1)}}},e.prototype.occupyCurrentTile=function(e){var t=e.scene.components.rpg,n=e.scene.get("stage").gamemap;if(n&&t&&t.tempMarks){var o=e.get("stage"),s=n.pixelToTile(o.x,o.y);this.occupyTile(e,s.x,s.y)}},e.prototype.isOccupiedTile=function(e,t,n,o){var s=e.components.rpg;if(e.get("stage").gamemap&&s&&s.tempMarks){var i=n+"_"+o;if(s.tempMarks.has(i)){var r=s.tempMarks.get(i);if(!r||0==r.length)return!1;if(!t||0==t.length)return!0;for(var a=0,l=r;a<l.length;a++){var c=l[a];if(t.indexOf(c)<0)return!0}return!1}}return!1},e.prototype.alignToTile=function(e){var t=e.scene.get("stage").gamemap;if(t){var n=e.get("stage").x,o=e.get("stage").y,s=t.align(n,o);s&&(e.get("stage").x=s.x,e.get("stage").y=s.y)}},e.prototype.getDirection=function(e,t){if(e.x==t.x){if(e.y>t.y)return"up";if(e.y<t.y)return"down"}else if(e.y==t.y){if(e.x>t.x)return"left";if(e.x<t.x)return"right"}return null},e.prototype.getCurrentTile=function(e){var t=e.scene.get("stage").gamemap;if(t){var n=e.get("stage").x,o=e.get("stage").y;return t.pixelToTile(n,o)}return null},e.prototype.getNextTile=function(e){var t=e.get("display").animation,n=e.scene.get("stage").gamemap;if(t&&n){var o=0,s=0,i=t.current;if(i.indexOf("_")>=0){var r=t.current.split("_");r&&r.length>=2&&(i=r[1])}switch(i){case"up":s=-32;break;case"down":s=32;break;case"left":o=-32;break;case"right":o=32;break;default:return null}var a=e.get("stage").x+o,l=e.get("stage").y+s;return n.pixelToTile(a,l)}return null},e.prototype.getPlotOnTile=function(e,t,n){for(var o in e.sprites){var s=e.sprites[o];if(s&&"plot"==s.template){var i=s.get("rpg");if(i){var r=null;if(i.tile)r=i.tile;else if(i.npc){var a=e.sprites[i.npc],l=e.get("stage").gamemap;if(a&&l){var c=a.get("stage").x,p=a.get("stage").y;r=l.pixelToTile(c,p)}}if(r&&r.x==t&&r.y==n)return s}}}return null},e.prototype.getPlotNpc=function(e){var t=e.get("rpg");if(t&&t.npc){var n=e.scene.sprites[t.npc];if(n)return n}return null},e.prototype.startNpcWaiting=function(e){var t=e.get("movement");t&&(t.waiting=!0)},e.prototype.stopNpcWaiting=function(e){if(!e.get("stage").gamemap)return null;for(var t in e.sprites){var n=e.sprites[t];if(n&&"npc"==n.template){var o=n.get("movement");o&&(o.waiting=!1)}}return null},e.prototype.isNpcWalking=function(e){var t=e.get("movement");return t&&(t.moving||t.walking)},e.prototype.isTalking=function(){return this.dialog&&this.dialog.active},e.prototype.isAnswering=function(){return this.dialog&&this.dialog.active&&this.dialog.code&&this.dialog.code.isAnswering()},e.prototype.selectAnswer=function(){this.dialog&&this.dialog.active&&this.dialog.code&&this.dialog.code.selectAnswer()},e.prototype.onSceneMapClick=function(e,t){var n=t.data.getLocalPosition(e.components.display.object),o=e.systems.stage.transform(n),s=e.components.rpg,i=e.sprites[s.player];i&&i.code.walkTo(i,o.x,o.y)},e.prototype.handleKeyboard=function(e){var t=this;if(!e.paused&&null!=this.keyboard&&null!=this.keyboard&&null!=this.profile&&null!=this.profile&&!0===this.profile.controllable){var n=window.vbuttons;if(n){var o=n.up,s=n.down,i=n.left,r=n.right;o||s||i||r?(this.keyboard.states.ArrowUp=o,this.keyboard.states.ArrowDown=s,this.keyboard.states.ArrowLeft=i,this.keyboard.states.ArrowRight=r):(this.keyboard.states.ArrowUp=!1,this.keyboard.states.ArrowDown=!1,this.keyboard.states.ArrowLeft=!1,this.keyboard.states.ArrowRight=!1),this.keyboard.states[" "]=!0===n.b1,this.keyboard.states.Escape=!0===n.b2}var a=e.game.get("rpg"),l=this.player&&this.player.active?this.player.code:null;if(l){var c=a?a.movespeed:1,p=this.checkMovementControl(),u=this.checkActionControl(),g=!1,f=this.isTalking();if(p&&!f){var y=this.player.get("movement");y&&(y.path=[],y.target=null),l.walkOnTile(this.player,p,c),g=!0}if(f&&!this.holdon&&this.isAnswering()&&(!p||"up"!=p&&"down"!=p||(this.dialog.code.moveCursor(p),this.holdon=!0,this.player.scene.timeout(200,function(){return t.holdon=!1})),u&&!this.holdon&&(this.selectAnswer(),this.holdon=!0,this.player.scene.timeout(200,function(){return t.holdon=!1}))),u&&!this.holdon)if(f)this.dialog.code.next(),this.holdon=!0,this.player.scene.timeout(500,function(){return t.holdon=!1});else if(!g){var h=this.getNextTile(this.player),m=h?this.getPlotOnTile(this.player.scene,h.x,h.y):null;if(m){var d=this.getPlotNpc(m),v=d&&this.isNpcWalking(d);if(d&&!v){this.startNpcWaiting(d);var b=d.get("display").animation,w=this.getCurrentTile(d),x=this.getCurrentTile(this.player),k=this.getDirection(w,x);k&&b&&b.set(k)}(!d||d&&!v)&&(m.active=!0,this.holdon=!0,this.player.scene.timeout(500,function(){return t.holdon=!1}))}}}}},e}();t.RpgMap=o}),System.registerDynamic("systems/rpg-transition.js",[],!0,function(e,t,n){"use strict";this||self;Object.defineProperty(t,"__esModule",{value:!0}),t.RpgTransition=void 0;var o=function(){function e(){this.name="rpg-transition",this._game=null,this._player=null,this._stage=null,this._bright=null,this._target=""}return e.prototype.init=function(e){this._game=e,this._stage=e.components.display.object;var t=document.createElement("canvas");t.width=t.height=1;var n=t.getContext("2d");n.fillStyle="rgba(255, 255, 255, 1)",n.fillRect(0,0,1,1),this._bright=new PIXI.Sprite(PIXI.Texture.from(t)),this._bright.scale.set(e.width,e.height);var o=e.components.display.layers,s=o?Object.keys(o):[];return s.length>0&&(this._bright.parentGroup=new PIXI.display.Group(s.length+1,!1),this._stage.addChild(new PIXI.display.Layer(this._bright.parentGroup))),!0},e.prototype.activate=function(e){this._player=null;var t=e.components.rpg;t&&t.player&&(this._player=e.sprites[t.player]);var n=e.sys("stage");n&&n.zoom(e,!1)},e.prototype.isWorking=function(){return this._target&&this._target.length>0},e.prototype.callScene=function(e,t,n,o){var s=this,i=n||1e3,r=o||1e3;if(!(this._target&&this._target.length>0)){var a=this._game.scene.systems.tween;if(a&&e&&this._game.scene.name!=e){if(this._target=e,this._bright.alpha=0,this._stage.addChild(this._bright),this._player){var l={x:this._player.get("stage").x,y:this._player.get("stage").y},c=this._game.scene.sys("stage");l=c.transform(l,!1),c.zoomTo(this._game.scene,2,2,l.x,l.y,i,function(){console.log("done")})}a.get(this._bright).to({alpha:1},i).call(function(){s._target&&s._target==e&&s._game.loadScene(e,function(e){if(e){t&&t(e),s._stage.removeChild(s._bright),s._game.scene=e;var n=s._game.scene.systems.tween;n&&(s._bright.alpha=1,s._stage.addChild(s._bright),n.get(s._bright).to({alpha:0},r).call(function(){s._stage.removeChild(s._bright)}))}s._target=""})})}}},e}();t.RpgTransition=o});