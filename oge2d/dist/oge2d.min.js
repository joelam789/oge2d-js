System.registerDynamic("oge2d/core/scene.js",["./sprite"],!0,function(a,b,c){"use strict";this||self;Object.defineProperty(b,"__esModule",{value:!0});var d=a("./sprite"),e=function(){function a(a,b){this.game=null,this.name="",this.ticks=0,this.paused=!1,this.script=null,this._systems=[],this._sprites=[],this._timers=[],this._presettingSystems=[],this._preparingSystems=[],this._loadingSprites=[],this._pendingSpriteClones=[],this._preloadItemCount=0,this._spritesToLoad=0,this.pools={},this.sprites={},this.systems={},this.components={},this.game=a,this.name=b}return Object.defineProperty(a.prototype,"systemList",{get:function(){return this._systems},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"spriteList",{get:function(){return this._sprites},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"active",{get:function(){return this.game&&this.game.scene==this},enumerable:!0,configurable:!0}),a.prototype.init=function(a,b,c){var d=this,e=[],f=[],g=null,h=null;if(this.game.basics&&e.push.apply(e,this.game.basics),a.systems)for(var i=0,j=a.systems;i<j.length;i++){var k=j[i];e.indexOf(k)<0&&e.push(k)}for(var l=0,m=Object.keys(this.game.systems);l<m.length;l++){var k=m[l];if(e.indexOf(k)>=0){var n=this.game.systems[k];n&&("display"==k?g=n:"event"==k?h=n:f.push(n),this.systems[k]=n)}}g&&this._systems.push(g),h&&this._systems.push(h);for(var o=0,p=f;o<p.length;o++){var n=p[o];this._systems.push(n)}if(a.components&&(this.components=a.components),this._loadingSprites=[],a.sprites)for(var q=0,r=a.sprites;q<r.length;q++){var s=r[q];this._loadingSprites.push(s)}this._spritesToLoad=this._loadingSprites.length,this._presettingSystems=[];for(var t=0,u=this._systems;t<u.length;t++){var n=u[t];this._presettingSystems.push(n.name)}this.preload(a.preload,function(){return d.presetSystems(function(){var e=d.game.libraries.script;e&&!0===a.script?e.loadSceneScript(d.game.libraries.systemjs,d.name,function(a){d.script=a,d.script.owner=d;var e=d.systems.event;e&&e.callEvent(d,"onInit"),d.loadSprites(function(){for(var a=0,c=d._systems;a<c.length;a++){var e=c[a];e.setup&&e.setup(d)}b(d)},function(a,b){c&&c(Math.round(1e4*(a+d._preloadItemCount)/(b+d._preloadItemCount))/100)})}):d.loadSprites(function(){for(var a=0,c=d._systems;a<c.length;a++){var e=c[a];e.setup&&e.setup(d)}b(d)},function(a,b){c&&c(Math.round(1e4*(a+d._preloadItemCount)/(b+d._preloadItemCount))/100)})})},function(a,b){c&&c(Math.round(1e4*a/(b+d._spritesToLoad))/100)})},a.prototype.preload=function(a,b,c){var d=this.game.libraries.preload;if(void 0==a||null==a||void 0==d||null==d)return void b();this._preloadItemCount=d.prepare(a),this._preloadItemCount<=0?b():d.load(this.game.libraries,b,c)},a.prototype.presetSystems=function(a){var b=this;if(this._presettingSystems.length>0){var c=this._presettingSystems.shift(),d=this.systems[c];d&&d.preset?d.preset(this,function(){return b.presetSystems(a)}):this.presetSystems(a)}else a()},a.prototype.prepareSprite=function(a,b){var c=this;if(this._preparingSystems.length>0){var d=this._preparingSystems.shift(),e=this.systems[d];e&&e.prepare?e.prepare(a,function(){return c.prepareSprite(a,b)}):this.prepareSprite(a,b)}else b()},a.prototype.addSprite=function(a){if(void 0!=a&&null!=a&&!this.sprites[a.name]){this._sprites.push(a),this.sprites[a.name]=a;var b=a.origin?a.origin.name:a.name,c=b?this.pools[b]:null;c&&c.indexOf(a)<0&&c.push(a);for(var d=0,e=this._systems;d<e.length;d++){var f=e[d];f.include&&f.include(a)}}},a.prototype.removeSprite=function(a){if(void 0!=a&&null!=a){var b=a.origin?a.origin.name:a.name,c=b?this.pools[b]:null;if(c&&c.length>0){var d=c.indexOf(a);d>=0&&c.splice(d,1)}this.sprites[a.name]&&(this.sprites[a.name]=void 0);var e=this._sprites.indexOf(a);if(e>=0){this._sprites.splice(e,1);for(var f=0,g=this._systems;f<g.length;f++){var h=g[f];h.exclude&&h.exclude(a)}}}},a.prototype.loadSprites=function(a,b){var c=this;if(this._loadingSprites.length>0){var d=this._loadingSprites.shift();this.sprites[d]?(b&&b(this._spritesToLoad-this._loadingSprites.length,this._spritesToLoad),this.loadSprites(a,b)):this.loadSprite(d,function(d){b&&b(c._spritesToLoad-c._loadingSprites.length,c._spritesToLoad),c.loadSprites(a,b)})}else a()},a.prototype.addNewSprite=function(a,b,c){var d=this;this._preparingSystems=[];for(var e=0,f=this._systems;e<f.length;e++){var g=f[e];this._preparingSystems.push(g.name)}this.prepareSprite(a,function(){d.sprites[a.name]||d.addSprite(a),b&&(a.active=!0),c&&c(a)})},a.prototype.addNewSpriteWithClones=function(a,b,c,e){var f=this;if(void 0==c||isNaN(c)||c<=1)return void this.addNewSprite(a,b,e);var g=[a];this._pendingSpriteClones=[];for(var h=0;h<c-1;h++){var i=new d.Sprite(a.scene,a.name+"_"+(h+1));i.origin=a,i.script=a.script,i.template=a.template,i.components=JSON.parse(JSON.stringify(a.components)),this._pendingSpriteClones.push(i),g.push(i)}this.pools[a.name]=g,this.addNewSprite(a,b,function(c){f.addNewSpriteClones(a,b,function(){e(a)})})},a.prototype.addNewSpriteClones=function(a,b,c){var d=this;if(this._pendingSpriteClones.length>0){var e=this._pendingSpriteClones.shift();e?this.addNewSprite(e,b,function(e){d.addNewSpriteClones(a,b,c)}):this.addNewSpriteClones(a,b,c)}else c()},a.prototype.loadSprite=function(a,b){var c=this,e=this.game.libraries.json;if(void 0==e||null==e)return void b(null);var f=this.game.libraries.script;if(void 0==f||null==f)return void b(null);e.loadJson("json/scenes/"+this.name+"/sprites/"+a+".json",function(e){if(void 0==e||null==e)return void b(null);var g=new d.Sprite(c,a);if(!0===e.script)f.loadSceneSpriteScript(c.game.libraries.systemjs,c.name,a,function(a){if(g.script=a,g.script.owner=g,e.template){var d=[],f=[];c.loadSpriteTemplate(e.template,d,f,function(a,d){if(a?(e.components&&c.mergeComponents(a,e.components),g.components=a):e.components&&(g.components=e.components),d&&(g.script?g.script.base=d:g.script={base:d,helper:d.helper}),g.script){var f=c.systems.event;f&&f.callEvent(g,"onInit")}c.addNewSpriteWithClones(g,e.active,e.count,b)})}else{if(g.script){var h=c.systems.event;h&&h.callEvent(g,"onInit")}c.addNewSpriteWithClones(g,e.active,e.count,b)}});else if(e.template){var h=[],i=[];c.loadSpriteTemplate(e.template,h,i,function(a,d){if(a?(e.components&&c.mergeComponents(a,e.components),g.components=a):e.components&&(g.components=e.components),d&&(g.script?g.script.base=d:g.script={base:d,helper:d.helper}),g.script){var f=c.systems.event;f&&f.callEvent(g,"onInit")}c.addNewSpriteWithClones(g,e.active,e.count,b)})}else c.addNewSpriteWithClones(g,e.active,e.count,b)})},a.prototype.mergeComponents=function(a,b){if(a&&b)for(var c=0,d=Object.keys(b);c<d.length;c++){var e=d[c];a[e]&&"object"==typeof a[e]&&"object"==typeof b[e]?this.mergeComponents(a[e],b[e]):a[e]=b[e]}},a.prototype.reset=function(){this.ticks=0,this._timers=[];var a=this.game.libraries.json;if(void 0!=a&&null!=a){var b=a.getJson("json/scenes/"+this.name+"/"+this.name+".json");if(void 0!=b&&null!=b){this.mergeComponents(this.components,b.components);for(var c=new Map,d=0,e=this._sprites;d<e.length;d++){var f=e[d];if(!f.origin){var g=a.getJson("json/scenes/"+this.name+"/sprites/"+f.name+".json");if(void 0!=g&&null!=g){var h=null,i=null,j=null;f.template&&(j=this.reloadSpriteTemplate(f.template)),j?(g.components&&this.mergeComponents(h.components,g.components),i=h.components):g.components&&(i=g.components),i&&(this.mergeComponents(f.components,i),c.set(f.name,i)),void 0!=g.active&&(f.active=g.active)}}}for(var k=0,l=this._sprites;k<l.length;k++){var f=l[k];void 0!=f.origin&&null!=f.origin&&(this.mergeComponents(f.components,c.get(f.origin.name)),f.active=f.origin.active)}for(var m=0,n=this._systems;m<n.length;m++){var o=n[m];o.refresh&&o.refresh(this)}}}},a.prototype.extractSpriteTemplate=function(a,b){var c={component:null,script:null};if(a)for(;a.length>0;){var d=a.pop();c.component?this.mergeComponents(c.component,d):c.component=d}if(b&&b.length>0){for(var e=0;e<b.length-1;e++)b[e].base=b[e+1];b[b.length-1].base=void 0,c.script=b[0]}return c},a.prototype.loadSpriteTemplate=function(a,b,c,d){var e=this,f=this.game.libraries.json,g=this.game.libraries.script;f.loadJson("json/sprites/"+a+".json",function(f){if(f)if(f.components&&b.push(f.components),!0===f.script)g.loadSpriteScript(e.game.libraries.systemjs,a,function(a){if(a&&c.push(a),f.template)e.loadSpriteTemplate(f.template,b,c,d);else{var g=e.extractSpriteTemplate(b,c);d(g.component,g.script)}});else if(f.template)e.loadSpriteTemplate(f.template,b,c,d);else{var h=e.extractSpriteTemplate(b,c);d(h.component,h.script)}else{var h=e.extractSpriteTemplate(b,c);d(h.component,h.script)}})},a.prototype.reloadSpriteTemplate=function(a){var b=this.game.libraries.json,c=b.getJson("json/sprites/"+a+".json");if(c.template){var d=this.reloadSpriteTemplate(c.template);return d?(c.components&&this.mergeComponents(d,c.components),d):c.components}return c.components},a.prototype.getFreeSprite=function(a){if(a&&a.length>0){var b=this.pools[a];if(b&&b.length>0)for(var c=0,d=b;c<d.length;c++){var e=d[c];if(0==e.active)return e}}else for(var f=0,g=this._sprites;f<g.length;f++){var e=g[f];if(0==e.active)return e}return null},a.prototype.getFreeSpriteCount=function(a){var b=0;if(a&&a.length>0){var c=this.pools[a];if(c&&c.length>0)for(var d=0,e=c;d<e.length;d++){var f=e[d];0==f.active&&b++}}else for(var g=0,h=this._sprites;g<h.length;g++){var f=h[g];0==f.active&&b++}return b},a.prototype.get=function(a){return this.components[a]},a.prototype.sys=function(a){return this.systems[a]},a.prototype.spr=function(a){return this.sprites[a]},a.prototype.call=function(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];if(this.script&&this.script[a])return(d=this.script)[a].apply(d,b);return;var d},a.prototype.timeout=function(a,b,c){var d=new f;d.start=this.ticks,d.timeout=a,d.target=c,d.callback=b,this._timers.push(d)},a.prototype.update=function(a){if(0==this.paused){this.ticks+=a;for(var b=[],c=0,d=this._timers;c<d.length;c++){var e=d[c];this.ticks-e.start>=e.timeout?e.callback&&e.callback(e.target):b.push(e)}b.length!=this._timers.length&&(this._timers=[],b.length>0&&(i=this._timers).push.apply(i,b))}for(var f=0,g=this._systems;f<g.length;f++){var h=g[f];h.update&&h.update(this,a)}var i},a}();b.Scene=e;var f=function(){function a(){this.start=-1,this.timeout=0,this.target=null,this.callback=null}return a}();b.Timer=f}),System.registerDynamic("oge2d/core/game.js",["./scene"],!0,function(a,b,c){"use strict";this||self;Object.defineProperty(b,"__esModule",{value:!0});var d=a("./scene"),e=function(){function a(a){this.name="",this.container=null,this.width=0,this.height=0,this.fps=0,this.ticks=0,this.deltaTime=0,this.script=null,this.scenes={},this.systems={},this.libraries={},this.components={},this.basics=[],this._currentScene=null,this._loadingScenes=[],this._scenesToLoad=0,this.name=a}return Object.defineProperty(a.prototype,"scene",{get:function(){return this._currentScene},set:function(a){if(a){if(this._currentScene){for(var b=0,c=this._currentScene.systemList;b<c.length;b++){var d=c[b];d.deactivate&&d.deactivate(this._currentScene)}var e=this.systems.event;e&&e.callEvent(this._currentScene,"onDeactivate")}if(this._currentScene=a,this._currentScene){for(var f=0,g=this._currentScene.systemList;f<g.length;f++){var d=g[f];d.activate&&d.activate(this._currentScene)}var e=this.systems.event;e&&e.callEvent(this._currentScene,"onActivate")}}},enumerable:!0,configurable:!0}),a.prototype.init=function(a,b,c,d){var e=this;a.components&&(this.components=a.components),c.forEach(function(a,b){return e.libraries[b]=a});var f=[],g=[],h=null;b.forEach(function(a,b){e.systems[b]=a,"event"==b&&(h=a),e.components.hasOwnProperty(b)?f.push(a):g.push(a)}),a.basics&&(i=this.basics).push.apply(i,a.basics),this.preloadPacks(a.packs,function(){var b=e.libraries.script;if(b&&!0===a.script)b.loadGameScript(e.libraries.systemjs,e.name,function(b){e.script=b,e.script.owner=e;for(var c=0,i=f;c<i.length;c++){var j=i[c];j.init&&j.init(e)}for(var k=0,l=g;k<l.length;k++){var j=l[k];j.init&&j.init(e)}h&&h.callEvent(e,"onInit"),e.loadScenes(a.scenes,function(){a.scenes&&a.scenes.length>0&&(e.scene=e.scenes[a.scenes[0]]),d(e)})});else{for(var c=0,i=f;c<i.length;c++){var j=i[c];j.init&&j.init(e)}for(var k=0,l=g;k<l.length;k++){var j=l[k];j.init&&j.init(e)}e.loadScenes(a.scenes,function(){a.scenes&&a.scenes.length>0&&(e.scene=e.scenes[a.scenes[0]]),d(e)})}});var i},a.prototype.preloadPacks=function(a,b){if(a&&a.length>0){for(var c=[],d=0,e=a;d<e.length;d++){var f=e[d],g=f.indexOf(".")<0?f+".pack":f;c.push(g)}console.log("preloading pack file(s) ... ");this.libraries.preload.loadPacks(c,b,function(a,b,c){console.log("preloaded "+c+" ("+a+"/"+b+")")})}else b()},a.prototype.loadScenesOneByOne=function(a,b){var c=this;if(this._loadingScenes.length>0){var d=this._loadingScenes.shift();this.loadScene(d,function(d){c.loadScenesOneByOne(a,b)},function(a){var d=100/c._scenesToLoad*(c._scenesToLoad-(c._loadingScenes.length+1)+a/100);d=Math.round(100*d)/100,d>100&&(d=100),b&&b(d)})}else a()},a.prototype.loadScenes=function(a,b,c){if(void 0==a||null==a||a.length<=0)return c&&c(100),void b();if(this._loadingScenes=[],a)for(var d=0,e=a;d<e.length;d++){var f=e[d];this._loadingScenes.push(f)}this._scenesToLoad=this._loadingScenes.length,this.loadScenesOneByOne(b,c)},a.prototype.loadScene=function(a,b,c){var e=this,f=this.libraries.json;if(void 0==f||null==f)return void b(null);var g=this.scenes[a];if(g)return c&&c(100),void b(g);f.loadJson("json/scenes/"+a+"/"+a+".json",function(f){if(void 0==f||null==f)return void b(null);new d.Scene(e,a).init(f,function(a){a&&(e.scenes[a.name]=a),b(a)},c)})},a.prototype.get=function(a){return this.components[a]},a.prototype.sys=function(a){return this.systems[a]},a.prototype.lib=function(a){return this.libraries[a]},a.prototype.call=function(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];if(this.script&&this.script[a])return(d=this.script)[a].apply(d,b);return;var d},a.prototype.update=function(a){this.deltaTime=a,this.ticks+=a,null!=this.scene&&this.scene.update(a);var b=this.components.event;if(this.script){if(b&&b.queue)for(var c=0,d=b.queue;c<d.length;c++){var e=d[c],f=b[e.name];f&&this.script[f]&&this.script[f](this,e.data)}var g=b?b.onUpdate:void 0;g&&this.script[g]&&this.script[g](this)}b&&(void 0==b.queue||null==b.queue?b.queue=[]:b.queue.length>0&&(b.queue=[]))},a}();b.Game=e}),System.registerDynamic("oge2d/core/app.js",["./game"],!0,function(a,b,c){"use strict";this||self;Object.defineProperty(b,"__esModule",{value:!0});var d=a("./game"),e=function(){function a(a){if(this.game=null,this.systems=new Map,this.libraries=new Map,a&&a.systems)for(var b=0,c=Object.keys(a.systems);b<c.length;b++){var d=c[b];this.systems.set(d,a.systems[d])}if(a&&a.libraries)for(var e=0,f=Object.keys(a.libraries);e<f.length;e++){var d=f[e];this.libraries.set(d,a.libraries[d])}if(a){var g=window;g.SystemJS?this.libraries.set("systemjs",g.SystemJS):g.System&&this.libraries.set("systemjs",g.System)}}return a.prototype.load=function(a,b){var c=this,d=window,e=d.SystemJS||d.System;this.loadModules(e,a,function(){c.loadGame(a.game,a.container,function(a){b(a)})})},a.prototype.loadGame=function(a,b,c){var e=this,f=a&&a.length>0?a:"game",g=this.libraries.get("json");if(void 0==g||null==g)return void(c&&c(null));g.loadJson("json/games/"+f+".json",function(a){if(void 0==a||null==a)return void(c&&c(null));var g=new d.Game(f),h=b&&b.length>0?document.getElementById(b):document.body;g.container=h||document.body,g.init(a,e.systems,e.libraries,function(a){c&&c(a)})})},a.prototype.loadModules=function(a,b,c){var d=this,e=[];this.loadSystems(a,b,function(f){f.forEach(function(a,b){return e.push(a)}),d.loadLibraries(a,b,function(a){a.forEach(function(a,b){return e.push(a)}),c(e)})})},a.prototype.loadSystems=function(a,b,c){var d=this;if(void 0==b||null==b||void 0==b.systems||null==b.systems)return void c(this.systems);for(var e=[],f=new Map,g=0,h=Object.keys(b.systems);g<h.length;g++){for(var i=h[g],j="",k=b.systems[i],l=k.split("/"),m=l[l.length-1],n="?",o="",p=0;p<m.length;p++)o=m.charAt(p),0==/[^a-zA-Z0-9]/.test(o)&&(0==/[^a-zA-Z0-9]/.test(n)?j+=o:j+=o.toUpperCase()),n=o;f.set(i,j),e.push(a.import(k))}Promise.all(e).then(function(a){f.forEach(function(b,c){for(var e=0,f=a;e<f.length;e++){var g=f[e];if(g.hasOwnProperty(b)){var h=Object.create(g[b].prototype);h.constructor.apply(h,[]),d.systems.set(c,h);break}}}),c(d.systems)})},a.prototype.loadLibraries=function(a,b,c){var d=this;if(a&&this.libraries.set("systemjs",a),void 0==b||null==b||void 0==b.libraries||null==b.libraries)return void c(this.libraries);for(var e=[],f=new Map,g=0,h=Object.keys(b.libraries);g<h.length;g++){for(var i=h[g],j="",k=b.libraries[i],l=k.split("/"),m=l[l.length-1],n="?",o="",p=0;p<m.length;p++)o=m.charAt(p),0==/[^a-zA-Z0-9]/.test(o)&&(0==/[^a-zA-Z0-9]/.test(n)?j+=o:j+=o.toUpperCase()),n=o;f.set(i,j),e.push(a.import(k))}Promise.all(e).then(function(a){f.forEach(function(b,c){for(var e=0,f=a;e<f.length;e++){var g=f[e];if(g.hasOwnProperty(b)){var h=Object.create(g[b].prototype);h.constructor.apply(h,[]),d.libraries.set(c,h);break}}}),c(d.libraries)})},a}();b.App=e}),System.registerDynamic("oge2d/system/display.js",[],!0,function(a,b,c){"use strict";this||self;Object.defineProperty(b,"__esModule",{value:!0});var d=function(){function a(){this.name="display",this._pauses={},this._game=null,this._event=null,this._pixi=null,this._ticker=null}return a.prototype.init=function(a){var b=this;this._game=a,this._event=a.systems.event;var c=a.components.display;if(PIXI.settings.SCALE_MODE=PIXI.SCALE_MODES.NEAREST,this._pixi=new PIXI.Application(c.width,c.height),this._pixi.renderer.roundPixels=!0,this._game.width=this._pixi.screen.width,this._game.height=this._pixi.screen.height,a.container?a.container.appendChild(this._pixi.view):document.body.appendChild(this._pixi.view),c.object=this._pixi.stage,c.plugins=this._pixi.renderer.plugins,c.layers){var d=0,e={};this._pixi.stage.displayList=new PIXI.DisplayList;for(var f=0,g=Object.keys(c.layers);f<g.length;f++){var h=g[f];h.length>0&&(d++,"default"==c.layers[h]?e[h]=new PIXI.DisplayGroup(d,function(a){a.zOrder=1e4*-a.y-a.x}):c.layers[h]&&a.script&&a.script[c.layers[h]]?(e[h]=new PIXI.DisplayGroup(d,!0),e[h].on("add",a.script[c.layers[h]])):e[h]=new PIXI.DisplayGroup(d,!1))}c.layers=e}return this._ticker=this._pixi.ticker.add(function(a){b._game.fps=b._ticker.FPS,b._game.update(b._ticker.elapsedMS)}),c.ticker=this._ticker,a.components.display=c,!0},a.prototype.preset=function(a,b){if(a){var c=a.components.display;void 0!=c&&null!=c||(a.components.display={},c=a.components.display),!c||void 0!=c.object&&null!=c.object||(c.object=new PIXI.Container),this._pauses[a.name]=!1}b&&b()},a.prototype.prepare=function(a,b){var c=this,d=a.components.display;if(d&&d.object)return void(b&&b());var f=null;if(d=a.scene.components.display,d&&d.object&&(f=d.object),f&&(d=a.components.display),f&&d&&(void 0==d.object||null==d.object)){var g=a.components.text,h=a.components.graphic,i=a.components.animation;if(g){var j=g.content&&g.content.length>0?Array.isArray(g.content)?g.content.join("\n"):g.content.toString():"";g.content=j;var k=new PIXI.Text(j,g.style?g.style:void 0);return this.applySpriteProperties(k,d),d.object=k,void(b&&b())}if(h&&h.image&&h.area){var l=h.image.toString();l.indexOf(".")<0&&(l+=".png");var m=a.game.libraries.image;if(m)return void m.loadTexture("img/"+l,h.area,function(a){if(a){var e=h.slice&&h.slice.length>=4?new PIXI.mesh.NineSlicePlane(a,h.slice[0],h.slice[1],h.slice[2],h.slice[3]):new PIXI.Sprite(a);c.applySpriteProperties(e,d),d.object=e}b&&b()})}else if(i&&i.image&&i.sheets){var l=i.image.toString();l.indexOf(".")<0&&(l+=".png");var m=a.game.libraries.image;if(m){for(var n=[],o=new Map,p=new Map,q=i.sheets,r=new e,s=Object.keys(q),t=0,u=s;t<u.length;t++){for(var v=u[t],w=q[v],x=Math.floor(w.length/4),y=[],z=[],A=0;A<x;A++)y.push("img/"+l),z.push({x:w[4*A],y:w[4*A+1],width:w[4*A+2],height:w[4*A+3]});n.push(v),o.set(v,y),p.set(v,z)}return void m.loadSheets(n,o,p,function(e){if(e&&e.size>0){e.forEach(function(a,b){return r.items.set(b,a)}),i.current&&r.items.has(i.current.toString())?r.current=i.current.toString():r.current=s[0];var f=new PIXI.extras.AnimatedSprite(r.items.get(r.current),!0);c.applySpriteProperties(f,d),i.hasOwnProperty("loop")&&(f.loop=i.loop),i.hasOwnProperty("speed")&&(f.animationSpeed=i.speed),r.owner=a,r.sprite=f,r.events=c._event,d.object=f,d.animation=r,f.onComplete=r.done.bind(r),f.play()}b&&b()})}}else if(a.script){var B=this.getScriptFunction(a.script,"prepareTexture"),C=B?B(a):null;if(C){var k=new PIXI.Sprite(C);this.applySpriteProperties(k,d),d.object=k}return void(b&&b())}}b&&b()},a.prototype.setup=function(a){this.updateDisplayParentNode(a),this.updateAnimationState(a)},a.prototype.activate=function(a){var b=a.components.display;if(b&&(void 0!=b.object&&null!=b.object||(b.object=new PIXI.Container),b.object&&this._pixi.stage.addChild(b.object),b.bgcolor)){var c=b.bgcolor.toString();c.length>1&&"#"==c.charAt(0)&&(this._pixi.renderer.backgroundColor=parseInt(c.substring(1),16))}},a.prototype.deactivate=function(a){var b=a.components.display;b&&b.object&&b.object instanceof PIXI.Container&&this._pixi.stage.removeChild(b.object)},a.prototype.include=function(a){var b=null,c=a.scene.components.display;c&&c.object&&(b=c.object),this.updateSpriteParentNode(a,b)},a.prototype.exclude=function(a){var b=a.components.display;if(b&&b.object){var c=null;b=a.scene.components.display,b&&b.object&&(c=b.object),c&&(b=a.components.display),c&&b&&b.object&&c==b.object.parent&&c.removeChild(b.object)}},a.prototype.enable=function(a){var b=a.components.display;b&&b.object&&(b.object.visible=!0)},a.prototype.disable=function(a){var b=a.components.display;b&&b.object&&(b.object.visible=!1)},a.prototype.refresh=function(a){if(a.components.display){for(var b=a.spriteList,c=0,d=b;c<d.length;c++){var e=d[c],f=e.components.display;if(f&&f.object){var g=e.components.text,h=e.components.animation;if(this.applySpriteProperties(f.object,f),g){var i=g.content&&g.content.length>0?Array.isArray(g.content)?g.content.join("\n"):g.content.toString():"";g.content=i,i!=f.object.text&&(f.object.text=i)}else if(h)if(h.hasOwnProperty("loop")&&(f.object.loop=h.loop),h.hasOwnProperty("speed")&&(f.object.animationSpeed=h.speed),h.current&&f.animation)f.animation.set(h.current.toString());else if(h.sheets&&f.animation){var j=Object.keys(h.sheets);j.length>0&&f.animation.set(j[0])}}}this.updateDisplayParentNode(a),this.updateAnimationState(a)}},a.prototype.update=function(a,b){this.updateAnimationState(a)},a.prototype.applySpriteProperties=function(a,b){for(var c=0,d=Object.keys(b);c<d.length;c++){var e=d[c];if("object"!=e&&("animation"!=e&&"parent"!=e))if("angle"!=e)if("tint"!=e||"string"!=typeof b[e])if("layer"!=e){if(void 0!=a[e])if("object"==typeof b[e])for(var f=0,g=Object.keys(b[e]);f<g.length;f++){var h=g[f];if(void 0!=a[e][h])if("object"==typeof b[e][h])for(var i=0,j=Object.keys(b[e][h]);i<j.length;i++){var k=j[i];a[e][h][k]=b[e][h][k]}else a[e][h]=b[e][h]}else a[e]=b[e]}else this._game.components.display.layers&&this._game.components.display.layers[b[e].toString()]&&(a.displayGroup=this._game.components.display.layers[b[e].toString()]);else{var l=b[e].toString();l.length>1&&"#"==l.charAt(0)&&(a.tint=parseInt(l.substring(1),16))}else a.rotation=b[e]*Math.PI/180}},a.prototype.updateAnimationState=function(a){if(this._pauses[a.name]!=a.paused){for(var b=a.spriteList,c=0,d=b;c<d.length;c++){var e=d[c];if(e.active){var f=e.components.display;f&&f.object&&f.animation&&(a.paused?f.object.stop():f.object.play())}}this._pauses[a.name]=a.paused}},a.prototype.updateSpriteParentNode=function(a,b){var c=a.components.display;if(c&&c.object){var d=null,e=null,f=null;c.parent&&(e=c.parent),e&&e.length>0&&(f=a.scene.sprites[e]),f&&f.components.display&&(d=f.components.display.object),void 0!=d&&null!=d||(d=b),d&&d!=c.object.parent&&d.addChild(c.object),c.object.visible=a.active}},a.prototype.updateDisplayParentNode=function(a){var b=a.spriteList,c=a.components.stage,d=a.components.display,e=null,f=null;c&&c.display&&(f=c.display),d&&d.object&&(e=d.object);for(var g=0,h=b;g<h.length;g++){var i=h[g];this.updateSpriteParentNode(i,i.components.stage&&f?f:e)}},a.prototype.getScriptFunction=function(a,b){return a?a[b]?a[b]:this.getScriptFunction(a.base,b):null},a}();b.Display=d;var e=function(){function a(){this.owner=null,this.events=null,this.current="",this.sprite=null,this.items=new Map,this.onComplete=null}return a.prototype.set=function(a,b){!0!==b&&this.current==a||this.sprite&&this.items.get(a)&&(this.sprite.textures=this.items.get(a),this.current=a,this.sprite.play())},a.prototype.reset=function(a,b){if(this.sprite&&(this.sprite.gotoAndStop(0),a)){if(!0!==b&&this.current==a)return;this.items.get(a)&&(this.sprite.textures=this.items.get(a),this.sprite.texture=this.sprite.textures[0],this.current=a)}},a.prototype.play=function(a){void 0===a&&(a=!0),this.sprite&&(this.sprite.loop=a,this.sprite.play())},a.prototype.done=function(){this.sprite&&!this.sprite.loop&&this.events&&this.owner&&(this.onComplete?this.onComplete(this.owner):this.events.addEvent(this.owner,"onAnimationComplete"))},a}();b.AnimationContainerPixi=e}),System.registerDynamic("oge2d/system/stage.js",[],!0,function(a,b,c){"use strict";this||self;Object.defineProperty(b,"__esModule",{value:!0});var d=function(){function a(){this.name="stage",this._game=null,this._loadingTilesets=[],this._loadedTilesets=[],this._tilesets={},this._tilemaps={},this._gamemaps={}}return a.prototype.init=function(a){return this._game=a,!0},a.prototype.preset=function(a,b){var c=this,d=a.components.stage;if(void 0==d||null==d)return void(b&&b());d.maxX=d.maxY=0;var e=null,f=a.components.display;if(f&&f.object&&(e=f.object),void 0==e||null==e)return void(b&&b());var g=a.game.libraries.image;if(void 0==g||null==g)return void(b&&b());var h=e;e=new PIXI.Container;var i=d.map?d.map.toString():"",j=0,k=0,l=0;if(d.pics&&d.pics.length>0){for(var m=[],n=[],o=0,p=d.pics;o<p.length;o++){var q=p[o];q.indexOf(".")<0&&(q+=".png"),m.push("img/"+q);var r={x:0,y:0,width:0,height:0},s=d.areas[j++],t=d.areas[j++];r.width=d.areas[j++],r.height=d.areas[j++],s=s+r.width-this._game.width,t=t+r.height-this._game.height,s>k&&(k=s),t>l&&(l=t),n.push(r)}k>d.maxX&&(d.maxX=k),l>d.maxY&&(d.maxY=l),j=0,g.loadTextures(m,n,function(a){if(a&&a.length>0){d.blocks=[];for(var f=0,g=a;f<g.length;f++){var m=g[f],n=new PIXI.Sprite(m);n.x=d.areas[j++],n.y=d.areas[j++],e.addChild(n),d.blocks.push(n),j+=2}}i&&i.length>0?c.loadTilemap(i,function(a){k=0,l=0,a&&a.columnCount>0&&a.tileWidth>0&&(k=a.columnCount*a.tileWidth-c._game.width),a&&a.rowCount>0&&a.tileHeight>0&&(l=a.rowCount*a.tileHeight-c._game.height),k>d.maxX&&(d.maxX=k),l>d.maxY&&(d.maxY=l),d.tilemap=a,a&&(d.gamemap=c._gamemaps[i],e.addChild(d.tilemap.display)),e.children&&e.children.length>0&&(d.display=e,h.addChild(e)),b&&b()}):(e.children&&e.children.length>0&&(d.display=e,h.addChild(e)),b&&b())})}else i&&i.length>0?this.loadTilemap(i,function(a){k=0,l=0,a&&a.columnCount>0&&a.tileWidth>0&&(k=a.columnCount*a.tileWidth-c._game.width),a&&a.rowCount>0&&a.tileHeight>0&&(l=a.rowCount*a.tileHeight-c._game.height),k>d.maxX&&(d.maxX=k),l>d.maxY&&(d.maxY=l),d.tilemap=a,a&&(d.gamemap=c._gamemaps[i],e.addChild(d.tilemap.display)),e.children&&e.children.length>0&&(d.display=e,h.addChild(e)),b&&b()}):(e.children&&e.children.length>0&&(d.display=e,h.addChild(e)),b&&b())},a.prototype.setup=function(a){var b=a.components.stage;b&&(isNaN(b.x)||(b.x<0&&(b.x=0),b.x>b.maxX&&(b.x=b.maxX)),isNaN(b.y)||(b.y<0&&(b.y=0),b.y>b.maxY&&(b.y=b.maxY)),b.waiting=!1,b.looping=!1,b.scrolling=!1,b.shake=null,b.callback=null)},a.prototype.activate=function(a){var b=a.components.stage;if(b){if(b.follow){var c=a.sprites[b.follow],d=c?c.components.stage:null;d&&(b.x=Math.round(d.x-a.game.width/2),b.y=Math.round(d.y-a.game.height/2))}isNaN(b.x)||(b.x<0&&(b.x=0),b.x>b.maxX&&(b.x=b.maxX)),isNaN(b.y)||(b.y<0&&(b.y=0),b.y>b.maxY&&(b.y=b.maxY))}},a.prototype.enable=function(a){var b=a.scene.components.stage;if(b){var c=a.components.display;if(c&&c.object)if(a.active){var d=a.components.stage;d&&(c.object.x=Math.round(d.x-b.x),c.object.y=Math.round(d.y-b.y)),0==c.object.visible&&(c.object.visible=!0)}else 1==c.object.visible&&(c.object.visible=!1)}},a.prototype.update=function(a,b){var c=a.components.stage;if(c){if(!0===c.waiting&&c.x==c.targetX&&c.y==c.targetY&&(c.waiting=!1,c.callback))return c.callback(a),void(c.callback=null);if(!0===c.looping&&c.x==c.endX&&c.y==c.endY&&(c.x=c.beginX,c.y=c.beginY),!0===c.scrolling){var d=c.x+c.speedX,e=c.y+c.speedY;d>=0&&d<=c.maxX&&(c.x=d),e>=0&&e<=c.maxY&&(c.y=e)}else if(c.follow){var f=a.sprites[c.follow],g=f?f.components.stage:null;if(g){var d=Math.round(g.x-a.game.width/2),e=Math.round(g.y-a.game.height/2);d>c.maxX?c.x=c.maxX:c.x=d<0?0:d,e>c.maxY?c.y=c.maxY:c.y=e<0?0:e}}if(c.blocks)for(var h=0,i=0,j=c.blocks;i<j.length;i++){var k=j[i];k.x=0-c.x+c.areas[h++],k.y=0-c.y+c.areas[h++],h+=2}c.tilemap&&this.updateTilemapView(a);for(var l=a.spriteList,m=0,n=l;m<n.length;m++){var o=n[m],p=o.components.display;if(p&&p.object)if(o.active){var q=o.components.stage;q&&(p.object.x=Math.round(q.x-c.x),p.object.y=Math.round(q.y-c.y)),0==p.object.visible&&(p.object.visible=!0)}else 1==p.object.visible&&(p.object.visible=!1)}if(c.shake){c.shake.total++;var r=c?c.display:null;r&&c.shake.speed>0&&c.shake.total%(11-c.shake.speed)==0&&(r.position.x!=r.pivot.x?r.position.x=r.pivot.x:(c.shake.minX||c.shake.maxX)&&(r.position.x=r.pivot.x+this.getRandomInt(c.shake.minX,c.shake.maxX)),r.position.y!=r.pivot.y?r.position.y=r.pivot.y:(c.shake.minY||c.shake.maxY)&&(r.position.y=r.pivot.y+this.getRandomInt(c.shake.minY,c.shake.maxY)),c.shake.count++,c.shake.times>0&&c.shake.times==c.shake.count&&(c.shake.callback&&c.shake.callback(),this.shake(a,!1)))}}},a.prototype.getRandomInt=function(a,b){return Math.floor(Math.random()*(b-a+1)+a)},a.prototype.shake=function(a,b,c,d,e,f,g,h){void 0===c&&(c=0),void 0===d&&(d=0),void 0===e&&(e=0),void 0===f&&(f=0),void 0===g&&(g=0),void 0===h&&(h=null);var i=a.components.stage;if(i)if("boolean"==typeof b)if(!1===b){i.shake=null;var j=i?i.display:null;j&&(j.position.x=j.pivot.x,j.position.y=j.pivot.y)}else!0===b&&this.shake(a,9,1,10,1,10);else i.shake={count:0,total:0,times:g,callback:h,speed:b>10?10:b,minX:e,minY:c,maxX:f>e?f:e,maxY:d>c?d:c}},a.prototype.transform=function(a,b){void 0===b&&(b=!0);var c=this._game.scene.components.stage;return c?{x:b?a.x+c.x:a.x-c.x,y:b?a.y+c.y:a.y-c.y}:a},a.prototype.follow=function(a,b){var c=a.components.stage;if(c)if(null==b||0==b.length)c.follow=null;else{var d=a.sprites[b];if(d&&(c.follow=b),d&&c.follow){c.scrolling=!1;var e=d?d.components.stage:null;e&&(c.x=Math.round(e.x-a.game.width/2),c.y=Math.round(e.y-a.game.height/2),c.x<0&&(c.x=0),c.x>c.maxX&&(c.x=c.maxX),c.y<0&&(c.y=0),c.y>c.maxY&&(c.y=c.maxY))}}},a.prototype.zoom=function(a,b,c,d,e){var f=a.get("stage"),g=f?f.display:null;if(void 0!=g&&null!=g)if("boolean"==typeof b)!1===b&&(g.scale.x=1,g.scale.y=1);else if(b>0){var h=b,i=c&&c>0?c:b,j=void 0==d?this._game.width/2:d,k=void 0==e?this._game.height/2:e;g.scale.x=h,g.scale.y=i,g.pivot.x=j,g.pivot.y=k,g.position.x=g.pivot.x,g.position.y=g.pivot.y}},a.prototype.zoomTo=function(a,b,c,d,e,f,g){var h=a.get("stage"),i=a.sys("tween"),j=h&&i?h.display:null;void 0!=j&&null!=j&&(j.pivot.x=d,j.pivot.y=e,j.position.x=j.pivot.x,j.position.y=j.pivot.y,i.get(j.scale).to({x:b,y:c},f).call(function(){g&&g()}))},a.prototype.setPivot=function(a,b,c){var d=a.get("stage"),e=d?d.display:null;e&&(e.pivot.x=b,e.pivot.y=c,e.position.x=e.pivot.x,e.position.y=e.pivot.y)},a.prototype.setPos=function(a,b,c){var d=c?c.components:this._game.scene.components,e=d?d.stage:null;e&&(e.x=a,e.y=b)},a.prototype.setSpritePos=function(a,b,c){this.setPos(b,c,a)},a.prototype.getViewRect=function(){var a=this._game.scene,b=new PIXI.Rectangle(0,0,a.game.width,a.game.height),c=a.components.stage;return c&&(b.x+=c.x,b.y+=c.y),c},a.prototype.wait=function(a,b,c){var d=this._game.scene,e=d.components.stage;e&&(e.waiting=!0,e.targetX=a,e.targetY=b,e.callback=c)},a.prototype.scroll=function(a,b){var c=this._game.scene,d=c.components.stage;d&&("number"==typeof a?(d.scrolling=!0,d.speedX=a,d.speedY=b||0):d.scrolling=!0===a,!0===d.scrolling&&(d.follow=null))},a.prototype.loop=function(a,b,c,d){var e=this._game.scene,f=e.components.stage;f&&(f.looping=!0,f.beginX=a,f.beginY=b,f.endX=c,f.endY=d)},a.prototype.loadTileset=function(a,b){var c=this;if(this._tilesets[a])return void(b&&b(this._tilesets[a]));var d=this._game.libraries.json;if(void 0==d||null==d)return void(b&&b(null));var e=this._game.libraries.image;if(void 0==e||null==e)return void(b&&b(null));d.loadJson("json/tilesets/"+a+".json",function(d){if(void 0==d||null==d)return console.error("Failed to load tileset: "+a),void(b&&b(null));var f=d.image.toString();f.indexOf(".")<0&&(f+=".png");var g="img/"+f;e.loadImage(g,function(h){if(void 0==h||null==h)return console.error("Failed to load tileset image: img/"+f),void(b&&b(null));d.texture=h;for(var i={x:0,y:0,width:d.tileWidth,height:d.tileHeight},j=0,k=d.tiles;j<k.length;j++){var l=k[j];l.textures=[];for(var m=0;m<l.offsets.length;m+=2){i.x=l.offsets[m],i.y=l.offsets[m+1];var n=e.getTexture(g,i);n&&l.textures.push(n)}}c._tilesets[a]=d,b&&b(d)})})},a.prototype.loadTilesetsOneByOne=function(a){var b=this;if(this._loadingTilesets.length<=0){for(var c=[],d=0,e=this._loadedTilesets;d<e.length;d++){var f=e[d];c.push(f)}return this._loadedTilesets=[],void a(c)}var g=this._loadingTilesets.shift();this.loadTileset(g,function(c){c&&b._loadedTilesets.push(c),b.loadTilesetsOneByOne(a)})},a.prototype.loadTilesets=function(a,b){this._loadingTilesets=[],this._loadedTilesets=[];for(var c=0,d=a;c<d.length;c++){var e=d[c];this._loadingTilesets.push(e)}this.loadTilesetsOneByOne(function(a){b(a)})},a.prototype.loadTilemap=function(a,b){var c=this;if(this._tilemaps[a])return void(b&&b(this._tilemaps[a]));var d=this._game.libraries.json;if(void 0==d||null==d)return void(b&&b(null));d.loadJson("json/tilemaps/"+a+".json",function(d){if(void 0==d||null==d)return console.error("Failed to load tilemap: "+a),void(b&&b(null));d.width=d.tileWidth*d.columnCount,d.height=d.tileHeight*d.rowCount,d.viewWidth=d.width<=c._game.width?c._game.width:d.width,d.viewHeight=d.height<=c._game.height?c._game.height:d.height;var e=d.tileWidth,f=d.tileHeight,g=0;if(d.bgcolor){var h=d.bgcolor.toString();h.length>=7&&"#"==h.charAt(0)&&(g=parseInt(h.substr(1,6),16)),h.length>=9&&"#"==h.charAt(0)&&(d.bgcolorOpacity=Math.round(parseInt(h.substr(7,2),16)/255*100)/100)}var i=new PIXI.Graphics;i.beginFill(g),i.drawRect(0,0,e,e),i.endFill(),d.defaultTileTexture=i.generateCanvasTexture(),d.defaultTileTextures=[d.defaultTileTexture];var k=d.viewWidth%e;k=0==k?Math.floor(d.viewWidth/e)+1:Math.floor((d.viewWidth-k)/e)+2;var l=d.viewHeight%f;l=0==l?Math.floor(d.viewHeight/f)+1:Math.floor((d.viewHeight-l)/f)+2,d.display=new PIXI.Container,d.sprites=[],d.spriteCount=k*l*2;for(var m=0;m<d.spriteCount;m++){var n=new PIXI.extras.AnimatedSprite(d.defaultTileTextures,!0);n.visible=!1,void 0!=d.bgcolorOpacity&&(n.alpha=d.bgcolorOpacity),d.display.addChild(n),d.sprites.push(n)}d.tilecosts=[],c.loadTilesets(d.tilesetNames,function(e){d.tilesets=[];for(var f=0,g=d.tilesetNames;f<g.length;f++){var h=g[f];d.tilesets.push(c._tilesets[h])}for(var i=0;i<d.cells.length;i++){var k=0,l=d.cells[i];if(void 0!=l.cost)k=l.cost;else for(var m=0;m<l.ids.length;m+=2){var n=l.ids[m],o=l.ids[m+1];if(n>=0&&o>=0){var p=d.tilesets[n].tiles[o];if(void 0!=p.cost){k=p.cost;break}}}d.tilecosts.push(k)}c._tilemaps[a]=d,c._gamemaps[a]=new j(d),b&&b(d)})})},a.prototype.updateTilemapView=function(a){var b=a.components.stage,c=b?b.tilemap:null;if(void 0!=c&&null!=c){var d=b.x%c.tileWidth,e=b.y%c.tileHeight,f=Math.round((b.x-d)/c.tileWidth),g=Math.round((b.y-e)/c.tileHeight),h=f*c.tileWidth,i=g*c.tileHeight,j=b.x+c.viewWidth,k=b.y+c.viewHeight;j>c.width&&(j=c.width),k>c.height&&(k=c.height);for(var l=0,m=g,n=f;i<k;){n=f;for(var o=h;o<j;){var p=m*c.columnCount+n;if(p>=0&&p<c.cells.length)for(var q=c.cells[p],r=c.tileWidth*n-b.x,s=c.tileHeight*m-b.y,t=0;t<q.ids.length;t+=2){var u=c.sprites[l++];u.x=r,u.y=s;var v=q.ids[t],w=q.ids[t+1];if(v>=0&&w>=0){var x=c.tilesets[v].tiles[w],y=u.textures!==x.textures;if(y&&(u.gotoAndStop(0),u.textures=x.textures,u.texture=u.textures[0],u.alpha=1),u.textures.length>1){var z=x.speed&&x.speed>0?x.speed:1;u.animationSpeed!=z&&(u.animationSpeed=z)}y?u.textures.length>1&&!a.paused&&u.gotoAndPlay(0):u.textures.length>1&&u.playing===a.paused&&(u.playing?u.stop():u.play())}else{var y=u.textures!==c.defaultTileTextures;y&&(u.gotoAndStop(0),u.textures=c.defaultTileTextures,u.texture=u.textures[0],u.alpha=c.bgcolorOpacity)}0==u.visible&&(u.visible=!0)}o+=c.tileWidth,n++}i+=c.tileHeight,m++}for(var A=l;A<c.sprites.length;A++){var u=c.sprites[A];if(!u.visible)break;u.visible=!1}}},a}();b.Stage=d;var e=function(){function a(){this.idx=-1,this.col=-1,this.row=-1,this.prior=null}return a}();b.StepNode=e;var f=function(){function a(){this.idx=-1,this.dist=-1,this.step=null,this.next=null}return a}();b.ResultNode=f;var g=function(){function a(a){this.tilemap=null,this.eight=!1,this.steps=null,this.footprints=null,this.openQueue=null,this.closedQueue=null,this.travelCosts=null,this.tilemap=a,this.travelCosts=new Array(a.tilecosts.length)}return a.prototype.clear=function(){this.steps=[],this.footprints=[],this.openQueue=null,this.closedQueue=null,this.travelCosts.fill(0)},a.prototype.dist=function(a,b,c,d){return Math.abs(c-a)+Math.abs(d-b)},a.prototype.add=function(a){if(a){for(var b=null,c=this.openQueue;null!=c&&a.idx+a.dist>c.idx+c.dist;)b=c,c=c.next;b?b.next=a:this.openQueue=a,a.next=c}},a.prototype.archive=function(a){if(a){for(var b=null,c=this.closedQueue;null!=c;){if(!(a.dist==c.dist?a.idx>c.idx:a.dist>c.dist))break;b=c,c=c.next}b?b.next=a:this.closedQueue=a,a.next=c}},a.prototype.pop=function(){var a=this.openQueue;return this.openQueue&&(this.openQueue=this.openQueue.next),a&&(a.next=null),a},a.prototype.createStep=function(a,b,c){var d=new e;return d.idx=a?a.idx+1:1,d.col=b,d.row=c,d.prior=a,this.steps.push(d),d},a.prototype.createFootprint=function(a,b){var c=new f;return c.idx=a?a.idx:0,c.step=a,c.dist=b,c.next=null,this.footprints.push(c),c},a.prototype.test=function(a,b,c,d,e,f){if(a<0||b<0||a>=this.tilemap.columnCount||b>=this.tilemap.rowCount)return!1;var g=this.tilemap.columnCount*b+a;if((f?f(a,b,this.tilemap.tilecosts[g]):this.tilemap.tilecosts[g])<0)return!1;var h=1;if(e&&(h=e.idx+1),this.travelCosts[g]>0&&h>=this.travelCosts[g])return!1;this.travelCosts[g]=h;var i=this.createStep(e,a,b),j=this.createFootprint(i,this.dist(a,b,c,d));return this.add(j),!0},a.prototype.getFootprint=function(a,b,c,d,e){if(!this.test(a,b,c,d,null,function(a,b,c){return 0}))return null;for(var f=this.pop();f;){var g=f.step;if(g){var h=g.col,i=g.row;if(h==c&&i==d){this.archive(f);break}var j=this.test(h,i-1,c,d,g,e),k=this.test(h+1,i,c,d,g,e),l=this.test(h,i+1,c,d,g,e),m=this.test(h-1,i,c,d,g,e),n=j&&k&&l&&m;if(this.eight){var o=!1,p=!1,q=!1,r=!1;(j||k)&&(o=this.test(h+1,i-1,c,d,g,e)),(l||k)&&(p=this.test(h+1,i+1,c,d,g,e)),(l||m)&&(q=this.test(h-1,i+1,c,d,g,e)),(j||m)&&(r=this.test(h-1,i-1,c,d,g,e));var s=!n;s||!j&&!k||(s=s||!o),s||!l&&!k||(s=s||!p),s||!l&&!m||(s=s||!q),s||!j&&!m||(s=s||!r),s&&this.archive(f)}else n||this.archive(f)}f=this.pop()}return this.closedQueue},a.prototype.find=function(a,b,c,d,e,f){void 0===e&&(e=!0),this.clear();for(var g=this.getFootprint(a,b,c,d,f),h=g?g.step:null,i=h?new Array(h.idx):null,j=h?h.idx:-1;h;)j--,j>=0&&(i[j]={x:h.col,y:h.row}),h=h.prior;return!e&&i&&i.length>0&&i.shift(),i},a}();b.PathFinder=g;var h=function(){function a(){this.mp=-1,this.col=-1,this.row=-1,this.next=null}return a}();b.VisitNode=h;var i=function(){function a(a){this.tilemap=null,this.nodes=null,this.current=null,this.next=null,this.history=null,this.tilemap=a,this.history=new Array(a.tilecosts.length)}return a.prototype.clear=function(){this.nodes=[],this.current=null,this.next=null,this.history.fill(-1)},a.prototype.add=function(a,b,c){var d=new h;return d.mp=c,d.col=a,d.row=b,d.next=this.next,this.next=d,this.next},a.prototype.test=function(a,b,c,d){if(a<0||b<0||a>=this.tilemap.columnCount||b>=this.tilemap.rowCount)return!1;var e=this.tilemap.columnCount*b+a,f=d?d(a,b,this.tilemap.tilecosts[e]):this.tilemap.tilecosts[e];if(f<0||f>c)return!1;var g=c-f;return!(this.history[e]>=g)&&(this.history[e]=g,this.add(a,b,g),!0)},a.prototype.travel=function(a,b,c,d){if(this.test(a,b,c,function(a,b,c){return 0}))for(;this.next;)for(this.current=this.next,this.next=null;this.current;){var e=this.current.col,f=this.current.row,g=this.current.mp;this.test(e,f-1,g,d),this.test(e+1,f,g,d),this.test(e,f+1,g,d),this.test(e-1,f,g,d),this.current=this.current.next}},a.prototype.find=function(a,b,c,d,e){void 0===d&&(d=!0),this.clear(),this.travel(a,b,c,e);for(var f=new Array,g=0;g<this.tilemap.columnCount;g++)for(var h=0;h<this.tilemap.rowCount;h++)(d||g!=a||h!=b)&&this.history[this.tilemap.columnCount*h+g]>=0&&f.push({x:g,y:h});return f},a}();b.RangeFinder=i;var j=function(){function a(a){this.tilemap=null,this.pathFinder=null,this.rangeFinder=null,this.tilemap=a,this.pathFinder=new g(a),this.rangeFinder=new i(a)}return a.prototype.pixelToTile=function(a,b){return this.tilemap?{x:Math.floor(a/this.tilemap.tileWidth),y:Math.floor(b/this.tilemap.tileHeight)}:null},a.prototype.tileToPixel=function(a,b){return this.tilemap?{x:a*this.tilemap.tileWidth+Math.floor(this.tilemap.tileWidth/2),y:b*this.tilemap.tileHeight+Math.floor(this.tilemap.tileHeight/2)}:null},a.prototype.align=function(a,b){var c=this.pixelToTile(a,b);return c?this.tileToPixel(c.x,c.y):null},a.prototype.findPath=function(a,b,c,d,e,f){return void 0===e&&(e=!0),this.pathFinder.find(a,b,c,d,e,f)},a.prototype.findRange=function(a,b,c,d,e){return void 0===d&&(d=!0),this.rangeFinder.find(a,b,c,d,e)},a}();b.GameMap=j}),System.registerDynamic("oge2d/system/tween.js",[],!0,function(a,b,c){"use strict";this||self;Object.defineProperty(b,"__esModule",{value:!0});var d=function(){function a(){this.name="tween",this._game=null,this._ticker=null}return a.prototype.init=function(a){return this._game=a,a.components.display&&(this._ticker=a.components.display.ticker),!0},a.prototype.activate=function(a){createjs.Tween.removeAllTweens()},a.prototype.deactivate=function(a){createjs.Tween.removeAllTweens()},a.prototype.update=function(a,b){var c=createjs.Ticker;c?c.paused!=a.paused&&(c.paused=a.paused):createjs.Tween.tick(this._ticker?this._ticker.deltaTime:1,a.paused)},a.prototype.get=function(a,b,c){return void 0===b&&(b=void 0),void 0===c&&(c=!0),createjs.Tween.get(a,b,void 0,c)},a.prototype.blink=function(a,b,c){createjs.Tween.get(a,{loop:!0}).to({alpha:1}).wait(50).to({alpha:0}).wait(50),!isNaN(b)&&b>0&&this._game.scene.timeout(b,function(a){createjs.Tween.removeTweens(a),a.alpha=1,c&&c(a)},a)},a.prototype.clear=function(a){a?createjs.Tween.removeTweens(a):createjs.Tween.removeAllTweens()},a.prototype.moveTo=function(a,b,c,d){var e=Math.sqrt((a.x-b)*(a.x-b)+(a.y-c)*(a.y-c)),f=e/(d<=0?1:d)*1e3;return createjs.Tween.get(a,{override:!0}).to({x:b,y:c},f)},a}();b.Tween=d}),System.registerDynamic("oge2d/system/transition.js",[],!0,function(a,b,c){"use strict";this||self;Object.defineProperty(b,"__esModule",{value:!0});var d=function(){function a(){this.name="transition",this._game=null,this._stage=null,this._dark=null,this._target=""}return a.prototype.init=function(a){this._game=a,this._stage=a.components.display.object;var b=new PIXI.Graphics;b.beginFill(0),b.drawRect(0,0,1,1),b.endFill(),this._dark=new PIXI.Sprite(b.generateCanvasTexture()),this._dark.scale.set(a.width,a.height);var c=a.components.display.layers,d=c?Object.keys(c):[];return d.length>0&&(this._dark.displayGroup=new PIXI.DisplayGroup(d.length+1,!1)),!0},a.prototype.isWorking=function(){return this._target&&this._target.length>0},a.prototype.callScene=function(a,b,c){var d=this,e=c?c/2:1e3;if(!(this._target&&this._target.length>0)){var f=this._game.scene.systems.tween;f&&a&&this._game.scene.name!=a&&(this._target=a,this._dark.alpha=0,this._stage.addChild(this._dark),f.get(this._dark).to({alpha:1},e).call(function(){d._target&&d._target==a&&d._game.loadScene(a,function(a){if(a){b&&b(a),d._stage.removeChild(d._dark),d._game.scene=a;var c=d._game.scene.systems.tween;c&&(d._dark.alpha=1,d._stage.addChild(d._dark),c.get(d._dark).to({alpha:0},e).call(function(){d._stage.removeChild(d._dark)}))}d._target=""})}))}},a}();b.Transition=d}),System.registerDynamic("oge2d/system/motion.js",[],!0,function(a,b,c){"use strict";this||self;Object.defineProperty(b,"__esModule",{value:!0});var d=function(){function a(){this.name="motion",this._game=null,this._event=null}return a.prototype.init=function(a){return this._game=a,this._event=a.systems.event,!0},a.prototype.update=function(a,b){if(!a.paused)for(var c=a.spriteList,d=0;d<=c.length;d++){var e=d==c.length?a:c[d],f=d==c.length||e.active?e.components.motion:null;if(void 0!=f&&null!=f&&0!=f.state){if(1==f.state&&f.speed>0){var g=this.getTargetPos(e);if(void 0==g||null==g)continue;if(0==f.style){var h=g.x,i=g.y,j=[],k=[];this.generateBeeline(h,i,f.targetX,f.targetY,j,k),f.dataX=j,f.dataY=k,j.length>0?f.state=2:f.state=0,2==f.state&&(f.current=0)}else f.state=0}if(2==f.state&&f.speed>0){var g=this.getTargetPos(e);if(void 0==g||null==g)continue;var j=f.dataX,k=f.dataY,l=f.current;l<j.length?(g.x=j[l],g.y=k[l],f.onStep&&f.onStep(e,l,j.length),f.current+=f.speed):(g.x=j[j.length-1],g.y=k[k.length-1],f.state=3)}if(3==f.state){f.state=0;var m=f.onEnd;m?m(e):this._event&&this._event.addEvent(e,"onMotionDone"),0==f.state&&(f.callback=null)}}}},a.prototype.createMotionData=function(){return{state:0,style:0,speed:0,current:0,segment:0,middleX:0,middleY:0,targetX:0,targetY:0,dataX:[],dataY:[],onStep:null,onEnd:null}},a.prototype.createPathData=function(){return{state:0,speed:0,current:0,offsetX:0,offsetY:0,listX:[],listY:[],nodes:[]}},a.prototype.getTargetPos=function(a){var b=a.components.stage;return b||(b=a.components.display,b?b.object:null)},a.prototype.moveTo=function(a,b,c,d,e,f){var g=this.getTargetPos(a);return void 0==g||null==g||g.x==b&&g.y==c?void(e&&e(a)):this.pathTo(a,b,c,d,null,null,e,f)},a.prototype.pathTo=function(a,b,c,d,e,f,g,h){var i=a.components.motion;void 0!=i&&null!=i||(i=this.createMotionData()),i.targetX=b,i.targetY=c,i.speed=d,i.state=1,i.onStep=h,i.onEnd=g,e&&(i.dataX=e),f&&(i.dataY=f),e&&(i.state=e.length>0?2:0,2==i.state&&(i.current=0)),a.components.motion=i},a.prototype.moveToNode=function(a,b,c,d){var e=this,f=a.components.path;if(!f)return void(c&&c(a));if(f.state<=0||2*b>=f.nodes.length)return f.state=0,void(c&&c(a));var g=f.nodes[2*b]+f.offsetX,h=f.nodes[2*b+1]+f.offsetY;d&&d(a,b-1,g,h),this.pathTo(a,g,h,f.speed,f.listX[b],f.listY[b],function(a){e.moveToNode(a,b+1,c,d)})},a.prototype.applyPath=function(a,b,c,d,e,f,g){var h=a.components.path;if(void 0!=h&&null!=h||(h=this.createPathData()),a.components.path=h,h.state=0,h.offsetX=b,h.offsetY=c,!(null==e||e.length<=1)){var i=e;if(d<0){i=[];for(var j=0,k=e.length;j<k;)i[j]=e[k-j-2],i[j+1]=e[k-j-1],j+=2}h.nodes=i,h.speed=d>0?d:0-d;var l=this.getTargetPos(a);if(void 0!=l&&null!=l){if(l.x=b+i[0],l.y=c+i[1],i.length<=2)return void(f&&f(a));var m=b+i[0],n=c+i[1],o=Math.floor(i.length/2),p=new Array,q=new Array;p.push([]),q.push([]);for(var r=1;r<o;r++){var s=new Array,t=new Array;this.generateBeeline(m,n,b+i[2*r],c+i[2*r+1],s,t),p.push(s),q.push(t),m=b+i[2*r],n=c+i[2*r+1]}h.listX=p,h.listY=q,h.state=1,this.moveToNode(a,1,f,g)}}},a.prototype.getMotionAngle=function(a,b,c,d){var e=Math.abs(c-a),f=Math.abs(d-b),g=0==e?90:180*Math.atan(f/e)/Math.PI;return c<=a&&d<=b?g=180-g:c<=a&&d>=b?g=180+g:c>=a&&d>=b&&(g=0-g),g<0&&(g+=360),g>360&&(g-=360),g},a.prototype.moveOutside=function(a,b,c,d,e,f,g,h,i){var j=this.getTargetPos(a);if(void 0!=j&&null!=j){var k=j.x,l=j.y,m=0,n=0;c>=0&&c<=45||c>315&&c<=360?(m=f,n=l-Math.abs(m-k)*Math.tan(c*Math.PI/180)):c>45&&c<=135?(n=e,m=k+Math.abs(l-n)/Math.tan(c*Math.PI/180)):c>135&&c<=225?(m=d,n=l+Math.abs(m-k)*Math.tan(c*Math.PI/180)):c>225&&c<=315&&(n=g,m=k-Math.abs(l-n)/Math.tan(c*Math.PI/180)),this.moveTo(a,m,n,b,h,i)}},a.prototype.generateBeeline=function(a,b,c,d,e,f){var g,h,i,j,k,l,m,n,o=(Math.floor(Math.max(Math.min(a,c),0)),Math.floor(Math.max(Math.min(b,d),0)),Math.floor(Math.abs(c-a))),p=Math.floor(Math.abs(d-b));o>=p?(h=o+1,g=2*p-o,i=2*p,j=2*(p-o),k=1,l=1,m=0,n=1):(h=p+1,g=2*o-p,i=2*o,j=2*(o-p),k=0,l=1,m=1,n=1),a>c&&(k=0-k,l=0-l),b>d&&(m=0-m,n=0-n);var q=Math.floor(a)+(g<0?k:l),r=Math.floor(b)+(g<0?m:n);g+=g<0?i:j;for(var s=2;s<h-1;s++)g<0?(g+=i,q+=k,r+=m):(g+=j,q+=l,r+=n),e.push(q),f.push(r);a==c&&b==d||(e.push(c),f.push(d))},a}();b.Motion=d}),System.registerDynamic("oge2d/system/collision.js",[],!0,function(a,b,c){"use strict";this||self;Object.defineProperty(b,"__esModule",{value:!0});var d=function(){function a(){this.name="collision",this._game=null,this._event=null,this.onCollision=null}return a.prototype.init=function(a){return this._game=a,this._event=a.systems.event,!0},a.prototype.update=function(a,b){if(!a.paused){for(var c=a.spriteList,d=[],e=[],f=0,g=c;f<g.length;f++){var h=g[f];if(h.active&&h.components.collision&&!0===h.components.collision.enabled&&h.components.display&&h.components.display.object){d.push(h);var i=h.components.display.object.getBounds(!1),j=h.components.collision.hitbox;if(j){var k=h.components.display.object.anchor;e.push({x:i.x+i.width*k.x+j.x,y:i.y+i.height*k.y+j.y,width:j.width,height:j.height})}else e.push(i)}}for(var l=0;l<d.length;l++)for(var m=l+1;m<d.length;m++)this.hitTestRect(e[l],e[m])&&(this.onCollision?this.onCollision(d[l],d[m]):this._event&&(this._event.addEvent(d[l],"onCollision",d[m]),this._event.addEvent(d[m],"onCollision",d[l])))}},a.prototype.hitTestRect=function(a,b){var c=a.width/2,d=a.height/2,e=b.width/2,f=b.height/2,g=a.x+c-(b.x+e),h=a.y+d-(b.y+f),i=c+e,j=d+f;return Math.abs(g)<i&&Math.abs(h)<j},a}();b.Collision=d}),System.registerDynamic("oge2d/system/mouse.js",[],!0,function(a,b,c){"use strict";this||self;Object.defineProperty(b,"__esModule",{value:!0});var d=function(){function a(){this.name="mouse",this._game=null,this._stage=null,this._interaction=null,this._sceneMouseContexts=new Map,this._sceneSpriteMouseContexts=new Map}return a.prototype.getSceneMouseContext=function(a,b){var c=a.name+"-"+b,d=this._sceneMouseContexts.get(c);return void 0!=d&&null!=d||(this._sceneMouseContexts.set(c,new e),d=this._sceneMouseContexts.get(c),d.emit=d.emit.bind(d)),d.target=a,d.event=b,d},a.prototype.getSceneSpriteMouseContext=function(a,b,c){var d=a.scene.name+"-"+a.name+"-"+b,f=this._sceneSpriteMouseContexts.get(d);return void 0!=f&&null!=f||(this._sceneSpriteMouseContexts.set(d,new e),f=this._sceneSpriteMouseContexts.get(d),f.emit=f.emit.bind(f)),f.target=a,f.event=b,f.shareable=c,f},a.prototype.init=function(a){var b=this;(this._game=a,this._stage=a.components.display.object,this._interaction=a.components.display.plugins.interaction,navigator.userAgent.indexOf("Mobile")>=0&&(navigator.userAgent.indexOf("iPad")>=0||navigator.userAgent.indexOf("iPhone")>=0))&&(this._game.libraries.audio&&(window.addEventListener("touchend",function(){0==b._game.libraries.audio.isPlayingDummy&&b._game.libraries.audio.playDummy()}),window.addEventListener("mousedown",function(){0==b._game.libraries.audio.isPlayingDummy&&b._game.libraries.audio.playDummy()})));return!0},a.prototype.preset=function(a,b){var c=a.components.display,d=a.components.mouse;d&&c&&c.object&&c.object instanceof PIXI.Container&&d.enabled&&(c.object.hitArea=new PIXI.Rectangle(0,0,this._game.components.display.width,this._game.components.display.height)),b&&b()},a.prototype.prepare=function(a,b){if(a&&a.components.mouse){a.active?this.enable(a):this.disable(a);var c=a.components.mouse.hitbox;if(c){var d=a.components.display;d&&d.object&&(d.object.hitArea=new PIXI.Rectangle(c.x,c.y,c.width,c.height))}}b&&b()},a.prototype.setup=function(a){},a.prototype.activate=function(a){var b=a.components.display,c=a.components.mouse,d=b?b.object:null;if(c&&b&&b.object&&d)if(c.enabled){if(d.interactive=!0,c.actions&&c.actions.length>0)for(var e=0,f=c.actions;e<f.length;e++){var g=f[e],h=g.toString();if(h.length>0){h="on"+h.charAt(0).toUpperCase()+h.substr(1);var i=this.getSceneMouseContext(a,h);!1===i.active&&(d.on(g,i.emit),i.active=!0)}}}else d.interactive=!1},a.prototype.deactivate=function(a){var b=a.components.display,c=a.components.mouse,d=b?b.object:null;if(c&&b&&b.object&&d&&(d.interactive=!1,c.actions&&c.actions.length>0))for(var e=0,f=c.actions;e<f.length;e++){var g=f[e],h=g.toString();if(h.length>0){h="on"+h.charAt(0).toUpperCase()+h.substr(1);var i=this.getSceneMouseContext(a,h);!0===i.active&&(d.off(g,i.emit),i.active=!1)}}},a.prototype.include=function(a){this.enable(a)},a.prototype.exclude=function(a){this.disable(a)},a.prototype.enable=function(a){var b=a.components.display,c=a.components.mouse,d=b?b.object:null;if(c&&b&&b.object&&d)if(c.enabled){if(d.interactive=!0,c.actions&&c.actions.length>0)for(var e=0,f=c.actions;e<f.length;e++){var g=f[e],h=g.toString();if(h.length>0){h="on"+h.charAt(0).toUpperCase()+h.substr(1);var i=this.getSceneSpriteMouseContext(a,h,!0===c.shareable);!1===i.active&&(d.on(g,i.emit),i.active=!0)}}}else d.interactive=!1},a.prototype.disable=function(a){var b=a.components.display,c=a.components.mouse,d=b?b.object:null;if(c&&b&&b.object&&d&&(d.interactive=!1,c.actions&&c.actions.length>0))for(var e=0,f=c.actions;e<f.length;e++){var g=f[e],h=g.toString();if(h.length>0){h="on"+h.charAt(0).toUpperCase()+h.substr(1);var i=this.getSceneSpriteMouseContext(a,h,!0===c.shareable);!0===i.active&&(d.off(g,i.emit),i.active=!1)}}},a.prototype.update=function(a,b){},a.prototype.getPos=function(a){var b={x:this._interaction.mouse.global.x,y:this._interaction.mouse.global.y},c=this._game.scene,d=c&&c.components.display?c.components.display.object:null;a&&d&&(b=a.getLocalPosition(d));var e=c?c.systems.stage:null;return e&&e.transform&&(b=e.transform(b)),b},a}();b.Mouse=d;var e=function(){function a(){this.event="",this.target=null,this.active=!1,this.shareable=!1}return a.prototype.emit=function(a){if(a.stopped=0==this.shareable,this.target){var b=this.target.systems?this.target.systems.event:this.target.scene?this.target.scene.systems.event:null;b&&b.addEvent(this.target,this.event,a)}},a}();b.MouseContext=e}),System.registerDynamic("oge2d/system/keyboard.js",[],!0,function(a,b,c){"use strict";this||self;Object.defineProperty(b,"__esModule",{value:!0});var d=function(){function a(){this.name="keyboard",this._game=null,this._event=null,this.states={},this.ticks={}}return a.prototype.init=function(a){var b=this;return this._game=a,document.body.addEventListener("keydown",function(a){b.states[a.key]=!0}),document.body.addEventListener("keyup",function(a){b.states[a.key]=!1,b._game.scene&&b._event&&b._event.addEvent(b._game.scene,"onKeyPress",a.key)}),!0},a.prototype.activate=function(a){this._event=a.systems.event,this.reset()},a.prototype.deactivate=function(a){this.reset()},a.prototype.update=function(a,b){},a.prototype.reset=function(){for(var a=Object.keys(this.states),b=0,c=a;b<c.length;b++){var d=c[b];this.states[d]=!1,this.ticks[d]=0}},a}();b.Keyboard=d}),System.registerDynamic("oge2d/core/sprite.js",[],!0,function(a,b,c){"use strict";this||self;Object.defineProperty(b,"__esModule",{value:!0});var d=function(){function a(a,b){this.name="",this.game=null,this.scene=null,this.origin=null,this.script=null,this.plot=null,this.template="",this.components={},this._active=!1,this.game=a.game,this.scene=a,this.name=b}return Object.defineProperty(a.prototype,"active",{get:function(){return this._active},set:function(a){if(a!=this._active){var b=this.scene.systemList;if(this._active=a,this._active){for(var c=0,d=b;c<d.length;c++){var e=d[c];e.enable&&e.enable(this)}var f=this.scene.systems.event;f&&f.callEvent(this,"onActivate")}else{for(var g=0,h=b;g<h.length;g++){var e=h[g];e.disable&&e.disable(this)}var f=this.scene.systems.event;f&&f.callEvent(this,"onDeactivate")}}},enumerable:!0,configurable:!0}),a.prototype.get=function(a){return this.components[a]},a.prototype.call=function(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];if(this.script&&this.script.helper)return this.script.helper.caller=this.name,(d=this.script.helper).call.apply(d,[this.script,a].concat(b));var d},a}();b.Sprite=d;var e=function(){function a(a,b){this.done=!1,this._spr=null,this._gen=null,this._wait=[],this._func=null,this._spr=a,this._func=b,this.reset()}return Object.defineProperty(a.prototype,"available",{get:function(){return void 0!=this._gen&&null!=this._gen},enumerable:!0,configurable:!0}),a.prototype.reset=function(){this._gen=this._func?this._func(this._spr):null,this.done=!1,this._wait=[]},a.prototype.pause=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];if(a){for(var c=0,d=0,e=a;d<e.length;d++){var f=e[d];this._wait.indexOf(f)<0&&(this._wait.push(f),c++)}return c}return 0},a.prototype.resume=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];if(a){for(var c=0,d=0,e=a;d<e.length;d++){var f=e[d],g=this._wait.indexOf(f);g>=0&&(this._wait.splice(g,1),c++)}return c}return 0},a.prototype.wait=function(a){var b=this;if(void 0==a)return this.pause("::::");if("string"==typeof a)return this.pause(a);if(!(a<=0))return this._spr.scene.timeout(a,function(){return b.resume("::timer::")}),this.pause("::timer::")},a.prototype.signal=function(a){return a?this.resume(a):this.resume("::::")},a.prototype.next=function(){if(this._wait.length>0)return null;var a=this._gen?this._gen.next():null;return a?(this.done=a.done,a.value):null},a}();b.Plot=e}),System.registerDynamic("oge2d/system/event-loop.js",["../core/sprite"],!0,function(a,b,c){"use strict";this||self;Object.defineProperty(b,"__esModule",{value:!0});var d=a("../core/sprite"),e=function(){function a(){this.name="event",this._game=null}return a.prototype.init=function(a){var b=a.components.event;return b&&(b.queue=[]),this._game=a,!0},a.prototype.preset=function(a,b){var c=a.components.event;c&&(c.queue=[]),b&&b()},a.prototype.prepare=function(a,b){b&&b()},a.prototype.setup=function(a){},a.prototype.activate=function(a){var b=a.components.event;b&&(b.queue=[])},a.prototype.deactivate=function(a){var b=a.components.event;b&&(b.queue=[])},a.prototype.include=function(a){var b=a.components.event;b&&(void 0==b.queue||null==b.queue?b.queue=[]:b.queue.length>0&&(b.queue=[]))},a.prototype.exclude=function(a){var b=a.components.event;b&&(void 0==b.queue||null==b.queue?b.queue=[]:b.queue.length>0&&(b.queue=[]))},a.prototype.enable=function(a){var b=a.components.event;if(b&&(void 0==b.queue||null==b.queue?b.queue=[]:b.queue.length>0&&(b.queue=[])),void 0!=a.components.plot&&!0===a.components.plot&&a.active&&b)if(a.plot)a.plot.reset();else{var c=b.onUpdate,e=c?typeof c:null;if("string"==e&&a.script){var f=this.getScriptFunction(a.script,c);if(f){var g=f,h=g?new d.Plot(a,g):null;h&&h.available&&(a.plot=h)}}}},a.prototype.disable=function(a){var b=a.components.event;b&&(void 0==b.queue||null==b.queue?b.queue=[]:b.queue.length>0&&(b.queue=[]))},a.prototype.update=function(a,b){for(var c=a.spriteList,d=0,e=c;d<e.length;d++){var f=e[d],g=f.components.event;if(f.active&&g){if(g.queue&&g.queue.length>0)for(var h=0,i=g.queue;h<i.length;h++){var j=i[h];if(j.data&&"function"==typeof j.data)j.data(f);else{var k=g[j.name],l=k?typeof k:null;"string"==l&&f.script?this.callScript(f,f.script,k,j.data):"function"==l&&k(f,j.data)}}if(g)if(f.plot)0==f.plot.done&&f.plot.next();else{var k=g.onUpdate,l=k?typeof k:null;"string"==l&&f.script?this.callScript(f,f.script,k):"function"==l&&k(f)}}g&&(void 0==g.queue||null==g.queue?g.queue=[]:g.queue.length>0&&(g.queue=[]))}var m=a.components.event;if(m&&m.queue)for(var n=0,o=m.queue;n<o.length;n++){var j=o[n];if(j.data&&"function"==typeof j.data)j.data(a);else{var k=m[j.name],l=k?typeof k:null;"string"==l&&a.script?a.script[k]&&a.script[k](a,j.data):"function"==l&&k(a,j.data)}}if(m){var k=m.onUpdate,l=k?typeof k:null;"string"==l&&a.script?a.script[k]&&a.script[k](a):"function"==l&&k(a)}m&&(void 0==m.queue||null==m.queue?m.queue=[]:m.queue.length>0&&(m.queue=[]))},a.prototype.addEvent=function(a,b,c){if(a&&a.components){var d=a.components.event;d&&(void 0!=d.queue&&null!=d.queue||(d.queue=[]),d.queue.push({name:b,data:c}))}},a.prototype.callEvent=function(a,b,c){if(a&&a.components){var d=a.components.event;if(d){var e=d[b],f=e?typeof e:null;"string"==f&&a.script?this.callScript(a,a.script,e,c):"function"==f&&e(a,c)}}},a.prototype.callScript=function(a,b,c,d){b&&(b[c]?b[c](a,d):this.callScript(a,b.base,c,d))},a.prototype.getScriptFunction=function(a,b){return a?a[b]?a[b]:this.getScriptFunction(a.base,b):null},a}();b.EventLoop=e}),System.registerDynamic("oge2d/library/json.js",["./loader"],!0,function(a,b,c){"use strict";this||self;Object.defineProperty(b,"__esModule",{value:!0});var d=a("./loader"),e=function(){function a(){this.name="json",this._objectsToLoad=0,this._loadedObjects=[],this._loadingObjectUrls=[],this._texts=new Map}return a.prototype.loadString=function(a,b){var c=this,e=this._texts.get(a);if(void 0!=e&&null!=e)return void b(e);d.Loader.loadText(a,function(d){c._texts.get(a)||(void 0!=d&&null!=d?(d.length>0&&c._texts.set(a,d),b(d)):b(""))})},a.prototype.loadJsons=function(a,b,c){this._loadedObjects=[],this._loadingObjectUrls=[],(d=this._loadingObjectUrls).push.apply(d,a),this._objectsToLoad=this._loadingObjectUrls.length,this.loadJsonsOneByOne(b,c);var d},a.prototype.loadJsonsOneByOne=function(a,b){var c=this;if(this._loadingObjectUrls.length<=0){var d=[];d.push.apply(d,this._loadedObjects),this._loadedObjects=[],a(d)}else{var e=this._loadingObjectUrls.shift();this.loadJson(e,function(d){b&&b(c._objectsToLoad-c._loadingObjectUrls.length,c._objectsToLoad),d&&c._loadedObjects.push(d),c.loadJsonsOneByOne(a,b)})}},a.prototype.loadJson=function(a,b){this.loadString(a,function(c){var d=null;if(void 0!=c&&null!=c&&c.length>0)try{d=JSON.parse(c)}catch(b){d=null,console.error("Failed to parse json string from "+a),console.error(b)}void 0==d&&(d=null),b(d)})},a.prototype.getJson=function(a){var b=null,c=this._texts.get(a);if(void 0!=c&&null!=c&&c.length>0){try{b=JSON.parse(c)}catch(c){b=null,console.error("Failed to parse json string from "+a),console.error(c)}void 0==b&&(b=null)}return b},a}();b.Json=e}),System.registerDynamic("oge2d/library/audio.js",["./loader"],!0,function(a,b,c){"use strict";this||self;Object.defineProperty(b,"__esModule",{value:!0});var d=a("./loader"),e=function(){function a(){this.name="audio",this._context=null,this._isPlayingDummy=!1,this._dummyAudioSource=null,this._dummyAudioBuffer=null,this._dummyGain=null,this._musicsToLoad=0,this._loadedMusics=[],this._loadingMusicUrls=[],this._soundsToLoad=0,this._loadedSounds=[],this._loadingSoundUrls=[],this.musics={},this.sounds={};var a=window;if(a.Oge2dGlobal&&a.Oge2dGlobal.audioContext&&(this._context=a.Oge2dGlobal.audioContext),void 0==this._context||null==this._context){var b=a.AudioContext||a.webkitAudioContext||a.mozAudioContext||a.oAudioContext||a.msAudioContext;b&&(this._context=new b)}void 0!=this._context&&null!=this._context||console.error("No Web Audio API Supported")}return a.prototype.playDummy=function(){this._isPlayingDummy=!0,null==this._dummyAudioSource&&(this._dummyAudioBuffer=this._context.createBuffer(2,1,this._context.sampleRate),this._dummyAudioSource=this._context.createBufferSource(),this._dummyAudioSource.buffer=this._dummyAudioBuffer,this._dummyGain=this._context.createGain(),this._dummyAudioSource.connect(this._dummyGain),this._dummyGain.connect(this._context.destination),this._dummyGain.gain.value=0,this._dummyAudioSource&&this._dummyAudioSource.start())},a.prototype.stopDummy=function(){this._dummyAudioSource&&(this._dummyAudioSource.stop(),this._dummyAudioSource.disconnect(),this._dummyGain.disconnect(),this._dummyAudioBuffer=null,this._dummyAudioSource=null,this._dummyGain=null),this._isPlayingDummy=!1},Object.defineProperty(a.prototype,"isPlayingDummy",{get:function(){return this._isPlayingDummy},enumerable:!0,configurable:!0}),a.prototype.getNameFromUrl=function(a){var b="",c=a.lastIndexOf("/"),d=a.lastIndexOf(".");return d>c&&d>0&&(c<0&&(c=-1),b=a.substring(c+1,d)),b},a.prototype.loadMusics=function(a,b,c){this._context&&a&&a.length>0?(this._loadedMusics=[],this._loadingMusicUrls=[],(d=this._loadingMusicUrls).push.apply(d,a),this._musicsToLoad=this._loadingMusicUrls.length,this.loadMusicsOneByOne(b,c)):b([]);var d},a.prototype.loadMusicsOneByOne=function(a,b){var c=this;if(this._loadingMusicUrls.length<=0){var d=[];d.push.apply(d,this._loadedMusics),this._loadedMusics=[],a(d)}else{var e=this._loadingMusicUrls.shift();this.loadMusic(e,function(d){b&&b(c._musicsToLoad-c._loadingMusicUrls.length,c._musicsToLoad),d&&c._loadedMusics.push(d),c.loadMusicsOneByOne(a,b)})}},a.prototype.loadMusic=function(a,b){var c=this;if(void 0==this._context||null==this._context)return void b(null);var e=this.getNameFromUrl(a);if(e.length<=0)return void b(null);var g=this.musics[e];if(g)return void b(g);d.Loader.loadBuffer(a,function(a){if(!c.musics[e])if(a){var d=new f(c._context);d.loadBuffer(a,function(){if(d.isReady())return c.musics[e]=d,void b(d);b(null)})}else b(null)})},a.prototype.loadSounds=function(a,b,c){this._context&&a&&a.length>0?(this._loadedSounds=[],this._loadingSoundUrls=[],(d=this._loadingSoundUrls).push.apply(d,a),this._soundsToLoad=this._loadingSoundUrls.length,this.loadSoundsOneByOne(b,c)):b([]);var d},a.prototype.loadSoundsOneByOne=function(a,b){var c=this;if(this._loadingSoundUrls.length<=0){var d=[];d.push.apply(d,this._loadedSounds),this._loadedSounds=[],a(d)}else{var e=this._loadingSoundUrls.shift();this.loadSound(e,function(d){b&&b(c._soundsToLoad-c._loadingSoundUrls.length,c._soundsToLoad),d&&c._loadedSounds.push(d),c.loadSoundsOneByOne(a,b)})}},a.prototype.loadSound=function(a,b){var c=this;if(void 0==this._context||null==this._context)return void b(null);var e=this.getNameFromUrl(a);if(e.length<=0)return void b(null);var f=this.sounds[e];if(f)return void b(f);d.Loader.loadBuffer(a,function(a){if(!c.sounds[e])if(a){var d=new g(c._context);d.loadBuffer(a,function(){if(d.isReady())return c.sounds[e]=d,void b(d);b(null)})}else b(null)})},a.STATE_UNPLAYABLE=0,a.STATE_READY=1,a.STATE_PLAYING=2,a.STATE_PAUSED=3,a.STATE_ENDED=4,a}();b.Audio=e;var f=function(){function a(a){this._context=null,this._state=0,this._volume=1,this._times=1,this._buffer=null,this._channel=null,this._gain=null,this._startTime=0,this._pauseTime=0,this._context=a,this._state=e.STATE_UNPLAYABLE}return a.prototype.isReady=function(){return this._state==e.STATE_READY},a.prototype.isCompleted=function(){return this._state==e.STATE_ENDED},a.prototype.isPlaying=function(){return this._state==e.STATE_PLAYING},a.prototype.isPaused=function(){return this._state==e.STATE_PAUSED},a.prototype.resume=function(){this._state==e.STATE_PAUSED&&this.play(this._times)},Object.defineProperty(a.prototype,"volume",{get:function(){return this._volume},set:function(a){var b=a<0?0:a>1?1:a;this._volume!=b&&(this._gain&&(this._gain.gain.value=b),this._volume=b)},enumerable:!0,configurable:!0}),a.prototype.loadBuffer=function(a,b){var c=this;if(void 0==this._context||null==this._context)return void(b&&b());this._context.decodeAudioData(a,function(a){c._buffer=a,c._buffer&&c._buffer.length>0&&(c._state=e.STATE_READY),b&&b()},function(){console.error("Failed to decode Web Audio Data"),b&&b()})},a.prototype.turnoff=function(){this._channel&&(this._channel.disconnect(),this._channel=null),this._gain&&(this._gain.disconnect(),this._gain=null)},a.prototype.turnon=function(){var a=this;void 0!=this._context&&null!=this._context&&void 0!=this._buffer&&null!=this._buffer&&(this.turnoff(),this._channel=this._context.createBufferSource(),void 0!=this._channel&&null!=this._channel&&(this._channel.buffer=this._buffer,this._channel.onended=function(){a._state==e.STATE_PLAYING&&(a._times>=0?(a._times>0&&a._times--,0==a._times?(a.turnoff(),a._state=e.STATE_ENDED):(a._pauseTime=0,a._startTime=a._context.currentTime,a.turnon())):(a._pauseTime=0,a._startTime=a._context.currentTime,a.turnon()))},this._gain=this._context.createGain(),void 0!=this._gain&&null!=this._gain&&(this._channel.connect(this._gain),this._gain.connect(this._context.destination),this._gain.gain.value=this._volume,this._pauseTime>0?(this._startTime=this._context.currentTime-this._pauseTime,this._channel.start(0,this._pauseTime)):(this._startTime=this._context.currentTime,this._channel.start(0)))))},a.prototype.play=function(a){void 0!=this._context&&null!=this._context&&void 0!=this._buffer&&null!=this._buffer&&this._state!=e.STATE_UNPLAYABLE&&this._state!=e.STATE_PLAYING&&(this._state!=e.STATE_READY&&this._state!=e.STATE_PAUSED&&this._state!=e.STATE_ENDED||(a?this._times=a<=0?-1:a:this._state==e.STATE_READY&&(this._times=-1),this._state=e.STATE_PLAYING,this.turnon()))},a.prototype.stop=function(){this._state!=e.STATE_UNPLAYABLE&&this._context&&this._channel&&(this._channel.stop(0),this.turnoff(),this._pauseTime=0,this._startTime=0,this._state=e.STATE_READY)},a.prototype.pause=function(){this._state==e.STATE_PLAYING&&this._context&&this._channel&&(this._pauseTime=this._context.currentTime-this._startTime,this._channel.stop(0),this.turnoff(),this._state=e.STATE_PAUSED)},a.prototype.reset=function(){this._state==e.STATE_ENDED?(this._pauseTime=0,this._startTime=0,this._state=e.STATE_READY):stop()},a.prototype.dispose=function(){stop(),this._state=e.STATE_UNPLAYABLE,this._buffer&&(this._buffer=null)},a}();b.Music=f;var g=function(){function a(a){this._context=null,this._state=0,this._volume=1,this._buffer=null,this._channels=[],this._gains=new Map,this._context=a,this._state=e.STATE_UNPLAYABLE}return a.prototype.isReady=function(){return this._state==e.STATE_READY},Object.defineProperty(a.prototype,"volume",{get:function(){return this._volume},set:function(a){var b=a<0?0:a>1?1:a;this._volume!=b&&(this._gains.forEach(function(a,c){return a.gain.value=b}),this._volume=b)},enumerable:!0,configurable:!0}),a.prototype.loadBuffer=function(a,b){var c=this;if(void 0==this._context||null==this._context)return void(b&&b());this._context.decodeAudioData(a,function(a){c._buffer=a,c._buffer&&c._buffer.length>0&&(c._state=e.STATE_READY),b&&b()},function(){console.error("Failed to decode Web Audio Data"),b&&b()})},a.prototype.turnoff=function(a){var b=null;a&&(b=this._gains.get(a),a.disconnect()),b&&b.disconnect(),a&&this._gains.delete(a)},a.prototype.turnon=function(){var a=this;if(void 0!=this._context&&null!=this._context&&void 0!=this._buffer&&null!=this._buffer){var b=this._context.createBufferSource();if(void 0!=b&&null!=b){b.buffer=this._buffer,b.onended=function(b){a.turnoff(b.target)};var c=this._context.createGain();void 0!=c&&null!=c&&(b.connect(c),c.connect(this._context.destination),c.gain.value=this._volume,this._gains.set(b,c),b.start(0))}}},a.prototype.play=function(){this._state!=e.STATE_UNPLAYABLE&&this._buffer&&this.turnon()},a.prototype.stop=function(){if(this._state!=e.STATE_UNPLAYABLE&&void 0!=this._buffer&&null!=this._buffer){var a=new Array;for(this._gains.forEach(function(b,c){return a.push(c)});a.length>0;){var b=a.pop();b&&(b.stop(0),this.turnoff(b))}}},a.prototype.dispose=function(){this.stop(),this._state=e.STATE_UNPLAYABLE,this._buffer&&(this._buffer=null),this._gains.clear(),this._channels=[]},a}();b.Sound=g}),System.registerDynamic("oge2d/library/texture.js",["./loader"],!0,function(a,b,c){"use strict";this||self;Object.defineProperty(b,"__esModule",{value:!0});var d=a("./loader"),e=function(){function a(){this.name="image",this._images=new Map,this._textures=new Map,this._imagesToLoad=0,this._loadedImages=[],this._loadingImageUrls=[],this._loadingUrls=[],this._loadingAreas=[],this._loadedTextures=[],this._loadingSheetNames=[],this._loadedSheetUrls=new Map,this._loadedSheetAreas=new Map,this._loadedSheets=new Map}return a.prototype.loadSheets=function(a,b,c,d){var e=this;if(b.size!=c.size)return void d(null);this._loadingSheetNames=[],this._loadedSheets.clear(),this._loadedSheetUrls.clear(),this._loadedSheetAreas.clear();for(var f=0,g=a;f<g.length;f++){var h=g[f];this._loadingSheetNames.push(h)}b.forEach(function(a,b){e._loadedSheetUrls.set(b,a)}),c.forEach(function(a,b){e._loadedSheetAreas.set(b,a)}),this.loadSheetsOneByOne(d)},a.prototype.loadSheetsOneByOne=function(a){var b=this;if(this._loadedSheetUrls.size!=this._loadedSheetAreas.size)return void a(null);if(this._loadingSheetNames.length<=0){var c=new Map;return this._loadedSheets.forEach(function(a,b){c.set(b,a)}),this._loadedSheets.clear(),this._loadedSheetUrls.clear(),this._loadedSheetAreas.clear(),void a(c)}var d=this._loadingSheetNames.shift(),e=this._loadedSheetUrls.get(d),f=this._loadedSheetAreas.get(d);d&&e&&f?this.loadTextures(e,f,function(c){b._loadedSheets.set(d,c),b._loadedSheetUrls.delete(d),b._loadedSheetAreas.delete(d),b.loadSheetsOneByOne(a)}):a(null)},a.prototype.loadTextures=function(a,b,c){if(a.length!=b.length)return void c([]);this._loadingUrls=[],this._loadingAreas=[],this._loadedTextures=[];for(var d=0,e=a;d<e.length;d++){var f=e[d];this._loadingUrls.push(f)}for(var g=0,h=b;g<h.length;g++){var f=h[g];this._loadingAreas.push(f)}this.loadTexturesOneByOne(c)},a.prototype.loadTexturesOneByOne=function(a){var b=this;if(this._loadingUrls.length!=this._loadingAreas.length)return void a([]);if(this._loadingUrls.length<=0){for(var c=[],d=0,e=this._loadedTextures;d<e.length;d++){var f=e[d];c.push(f)}return this._loadedTextures=[],void a(c)}var g=this._loadingUrls.shift(),h=this._loadingAreas.shift();this.loadTexture(g,h,function(c){c&&b._loadedTextures.push(c),b.loadTexturesOneByOne(a)})},a.prototype.getTexture=function(a,b){var c=b?a+","+b.x+","+b.y+","+b.width+","+b.height:a,d=this._textures.get(c);if(d)return d;var e=b?this._images.get(a):null;if(e&&b){var f=new PIXI.Texture(e,new PIXI.Rectangle(b.x,b.y,b.width,b.height));if(f&&this._textures.set(c,f),f)return f}return null},a.prototype.setTexture=function(a,b){if(void 0!=b&&null!=b){var c=this._textures.get(a);c&&c!=b&&c.destroy(!1),this._textures.set(a,b)}},a.prototype.loadTexture=function(a,b,c){var d=this,e=a+","+b.x+","+b.y+","+b.width+","+b.height,f=this._textures.get(e);if(void 0!=f&&null!=f)return void c(f);this.loadImage(a,function(a){if(a){a.update();var f=new PIXI.Texture(a,new PIXI.Rectangle(b.x,b.y,b.width,b.height));f&&d._textures.set(e,f),c(f)}else c(null)})},a.prototype.loadImages=function(a,b,c){a&&a.length>0?(this._loadedImages=[],this._loadingImageUrls=[],(d=this._loadingImageUrls).push.apply(d,a),this._imagesToLoad=this._loadingImageUrls.length,this.loadImagesOneByOne(b,c)):b([]);var d},a.prototype.loadImagesOneByOne=function(a,b){var c=this;if(this._loadingImageUrls.length<=0){var d=[];d.push.apply(d,this._loadedImages),this._loadedImages=[],a(d)}else{var e=this._loadingImageUrls.shift();this.loadImage(e,function(d){b&&b(c._imagesToLoad-c._loadingImageUrls.length,c._imagesToLoad),d&&c._loadedImages.push(d),c.loadImagesOneByOne(a,b)})}},a.prototype.loadImage=function(a,b){var c=this,e=this._images.get(a);if(void 0!=e&&null!=e)return void b(e);var f="",g=a.lastIndexOf(".");g>0&&(f=a.substring(g+1)),f.length<=0&&(f="png"),d.Loader.loadBytes(a,function(d){if(!c._images.get(a))if(void 0!=d&&null!=d&&d.length>0){var e=new Image;e.addEventListener("load",function(d){if(!c._images.get(a)){var f=new PIXI.Texture(new PIXI.BaseTexture(e));f&&c._images.set(a,f),b(f)}}),e.src="data:image/"+f.toLowerCase()+";base64,"+c.bytesToBase64(d)}else b(null)})},a.prototype.bytesToBase64=function(a){for(var b,c,d,e,f,g,h,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",j="",k=0;k<a.length;)b=a[k++],c=k<a.length?a[k++]:Number.NaN,d=k<a.length?a[k++]:Number.NaN,e=b>>2,f=(3&b)<<4|c>>4,g=(15&c)<<2|d>>6,h=63&d,isNaN(c)?g=h=64:isNaN(d)&&(h=64),j+=i.charAt(e)+i.charAt(f)+i.charAt(g)+i.charAt(h);return j},a}();b.Texture=e}),System.registerDynamic("oge2d/library/script.js",[],!0,function(a,b,c){"use strict";this||self;Object.defineProperty(b,"__esModule",{value:!0});var d=function(){function a(){this.name="script",this._games=new Map,this._scenes=new Map,this._sprites=new Map}return a.prototype.getClassName=function(a){for(var b="",c=a,d="?",e="",f=0;f<c.length;f++)e=c.charAt(f),0==/[^a-zA-Z0-9]/.test(e)&&(0==/[^a-zA-Z0-9]/.test(d)?b+=e:b+=e.toUpperCase()),d=e;return b},a.prototype.loadGameScript=function(a,b,c){var d=this,e="games/"+b+".js",f=this._games.get(e);if(void 0!=f&&null!=f)return void c(f);var g="Game"+this.getClassName(b);a.import(e).then(function(a){if(a.hasOwnProperty(g)){var b=Object.create(a[g].prototype);b.constructor.apply(b,[]),b.helper=d,d._games.set(e,b),c(b)}else c(null)}).catch(function(a){c(null)})},a.prototype.loadSceneScript=function(a,b,c){var d=this,e="scenes/"+b+"/"+b+".js",f=this._scenes.get(e);if(void 0!=f&&null!=f)return void c(f);var g="Scene"+this.getClassName(b);a.import(e).then(function(a){if(a.hasOwnProperty(g)){var b=Object.create(a[g].prototype);b.constructor.apply(b,[]),b.helper=d,d._scenes.set(e,b),c(b)}else c(null)}).catch(function(a){c(null)})},a.prototype.loadSpriteScript=function(a,b,c){var d=this,e="sprites/"+b+".js",f=this._sprites.get(e);if(void 0!=f&&null!=f)return void c(f);var g="Sprite"+this.getClassName(b);a.import(e).then(function(a){if(a.hasOwnProperty(g)){var b=Object.create(a[g].prototype);b.constructor.apply(b,[]),b.helper=d,d._sprites.set(e,b),c(b)}else c(null)}).catch(function(a){c(null)})},a.prototype.loadSceneSpriteScript=function(a,b,c,d){var e=this,f="scenes/"+b+"/sprites/"+c+".js",g=this._sprites.get(f);if(void 0!=g&&null!=g)return void d(g);var h="Scene"+this.getClassName(b)+"Sprite"+this.getClassName(c);a.import(f).then(function(a){if(a.hasOwnProperty(h)){var b=Object.create(a[h].prototype);b.constructor.apply(b,[]),b.helper=e,e._sprites.set(f,b),d(b)}else d(null)}).catch(function(a){d(null)})},a.prototype.get=function(a,b){return a?a[b]?a[b]:this.get(a.base,b):null},a.prototype.call=function(a,b){for(var c=[],d=2;d<arguments.length;d++)c[d-2]=arguments[d];if(a)return a[b]?a[b].apply(a,c):this.call.apply(this,[a.base,b].concat(c))},a}();b.Script=d}),System.registerDynamic("oge2d/library/loader.js",[],!0,function(a,b,c){"use strict";this||self;Object.defineProperty(b,"__esModule",{value:!0});var d=function(){function a(){}return a.loadText=function(b,c){var d=a._cache.get(b);if(d&&d.text)return void c(d.text);var e=new XMLHttpRequest;e.open("GET",b,!0),e.onload=function(a){var b=(e.status+"")[0];if("0"!==b&&"2"!==b&&"3"!==b)c("");else{var d=e.responseText;c(void 0!=d&&null!=d?d:"")}},e.onerror=function(){c("")},e.send()},a.loadBuffer=function(b,c){var d=a._cache.get(b);if(d&&d.buffer)return void c(d.buffer);var e=new XMLHttpRequest;e.open("GET",b,!0),e.responseType="arraybuffer",e.onload=function(a){var b=(e.status+"")[0];c("0"!==b&&"2"!==b&&"3"!==b?null:e.response)},e.onerror=function(){c(null)},e.send()},a.loadBytes=function(b,c){var d=a._cache.get(b);if(d&&d.u8array)return void c(d.u8array);var e=new XMLHttpRequest;e.open("GET",b,!0),e.responseType="arraybuffer",e.onload=function(a){var b=(e.status+"")[0];c("0"!==b&&"2"!==b&&"3"!==b?null:new Uint8Array(e.response))},e.onerror=function(){c(null)},e.send()},a.loadPackContent=function(b,c,d){var f=a._loadingPacks.get(b),g=f&&f.length>0?f.shift():null;g?g.getData(new zip.BlobWriter("application/octet-binary"),function(f){var h=new e;h.blob=f,a._cache.set(g.filename,h),c.set(g.filename,h);var i="",j=g.filename.indexOf(".");j>0&&(i=g.filename.substr(j).toLowerCase()),".png"==i||".jpg"==i||".jpeg"==i||".gif"==i||".bmp"==i?a.blobToBytes(h.blob,function(e){h.blob=null,h.u8array=e,a.loadPackContent(b,c,d)}):".mp3"==i||".m4a"==i||".ogg"==i||".aac"==i||".wav"==i?a.blobToBuffer(h.blob,function(e){h.blob=null,h.buffer=e,a.loadPackContent(b,c,d)}):".json"==i||".js"==i||".html"==i||".css"==i||".txt"==i?a.blobToText(h.blob,function(e){h.blob=null,h.text=e,a.loadPackContent(b,c,d)}):a.loadPackContent(b,c,d)},function(a,b){}):d(c)},a.loadPack=function(b,c){var d=new Map,e=new XMLHttpRequest;e.open("GET",b,!0),e.responseType="arraybuffer",e.onload=function(f){var g=(e.status+"")[0];if("0"!==g&&"2"!==g&&"3"!==g)c(null);else{var h=new Uint8Array(e.response);if(b.indexOf(".data")>0)for(var i=[111,103,101,50,100],j=0;j<h.length;j++)h[j]=h[j]^i[j%i.length];zip.createReader(new zip.BlobReader(new Blob([h])),function(e){e.getEntries(function(f){if(void 0==f||null==f||f.length<=0)return e.close(),void c(null);a._loadingPacks.set(b,[]);for(var g=0,h=f;g<h.length;g++){var i=h[g];a._loadingPacks.get(b).push(i)}a.loadPackContent(b,d,function(a){e.close(),c(a)})})},function(a){console.error(a),c(null)})}},e.onerror=function(){c(null)},e.send()},a.stringToUtf8ByteArray=function(a){for(var b=[],c=0,d=0;d<a.length;d++){var e=a.charCodeAt(d);e<128?b[c++]=e:e<2048?(b[c++]=e>>6|192,b[c++]=63&e|128):55296==(64512&e)&&d+1<a.length&&56320==(64512&a.charCodeAt(d+1))?(e=65536+((1023&e)<<10)+(1023&a.charCodeAt(++d)),b[c++]=e>>18|240,b[c++]=e>>12&63|128,b[c++]=e>>6&63|128,b[c++]=63&e|128):(b[c++]=e>>12|224,b[c++]=e>>6&63|128,b[c++]=63&e|128)}return b},a.utf8ByteArrayToString=function(a){for(var b=[],c=0,d=0;c<a.length;){var e=a[c++];if(e<128)b[d++]=String.fromCharCode(e);else if(e>191&&e<224){var f=a[c++];b[d++]=String.fromCharCode((31&e)<<6|63&f)}else if(e>239&&e<365){var f=a[c++],g=a[c++],h=a[c++],i=((7&e)<<18|(63&f)<<12|(63&g)<<6|63&h)-65536;b[d++]=String.fromCharCode(55296+(i>>10)),b[d++]=String.fromCharCode(56320+(1023&i))}else{var f=a[c++],g=a[c++];b[d++]=String.fromCharCode((15&e)<<12|(63&f)<<6|63&g)}}return b.join("")},a.blobToBuffer=function(a,b){var c=new FileReader;c.onload=function(){return b(c.result)},c.readAsArrayBuffer(a)},a.blobToBytes=function(b,c){return a.blobToBuffer(b,function(a){return c(new Uint8Array(a))})},a.blobToText=function(b,c){return a.blobToBytes(b,function(b){return c(a.utf8ByteArrayToString(b))})},a._cache=new Map,a._loadingPacks=new Map,a}();b.Loader=d;var e=function(){function a(){this.blob=null,this.text=null,this.u8array=null,this.buffer=null}return a}();b.Block=e}),System.registerDynamic("oge2d/library/preload.js",["./loader"],!0,function(a,b,c){"use strict";this||self;Object.defineProperty(b,"__esModule",{value:!0});var d=a("./loader"),e=function(){function a(){this._setting=null,this._contents=[],this._loadingPacks=[],this._libraries={}}return a.prototype.preload=function(a,b,c,d){this.prepare(a)>0?this.load(b,c,d):c()},a.prototype.prepare=function(a){if(void 0==a||null==a)return 0;this._setting=a,this._contents=Object.keys(a),this.total=0,this.current=0;for(var b=0,c=this._contents;b<c.length;b++){var d=c[b];"musics"==d?this.total+=this._setting.musics.length:"sounds"==d?this.total+=this._setting.sounds.length:"images"==d&&(this.total+=this._setting.images.length)}return this.total},a.prototype.load=function(a,b,c){if(void 0==this._setting||null==this._setting||void 0==a||null==a)return void b();this._libraries=a,this.loadOneByOne(b,c)},a.prototype.loadOneByOne=function(a,b){var c=this;if(this._contents.length<=0)a();else{var d=this._contents.shift();if("musics"==d){for(var e=this._setting.musics,f=[],g=0,h=e;g<h.length;g++){var i=h[g];f.push("audio/musics/"+i+(i.indexOf(".")>=0?"":".mp3"))}this._libraries.audio.loadMusics(f,function(d){return c.loadOneByOne(a,b)},function(a,d){c.current++,b&&b(c.current,c.total)})}else if("sounds"==d){for(var j=this._setting.sounds,f=[],k=0,l=j;k<l.length;k++){var m=l[k];f.push("audio/sounds/"+m+(m.indexOf(".")>=0?"":".mp3"))}this._libraries.audio.loadSounds(f,function(d){return c.loadOneByOne(a,b)},function(a,d){c.current++,b&&b(c.current,c.total)})}else if("images"==d){for(var n=this._setting.images,f=[],o=0,p=n;o<p.length;o++){var q=p[o];f.push("img/"+q+(q.indexOf(".")>=0?"":".png"))}this._libraries.image.loadImages(f,function(d){return c.loadOneByOne(a,b)},function(a,d){c.current++,b&&b(c.current,c.total)})}else if("jsons"==d){for(var r=this._setting.jsons,f=[],s=0,t=r;s<t.length;s++){var u=t[s];f.push("json/"+u+(u.indexOf(".")>=0?"":".json"))}this._libraries.json.loadJsons(f,function(d){return c.loadOneByOne(a,b)},function(a,d){c.current++,b&&b(c.current,c.total)})}else this.loadOneByOne(a,b)}},a.prototype.loadPack=function(a,b){d.Loader.loadPack(a,b)},a.prototype.loadPacks=function(a,b,c){this._loadingPacks=[],(d=this._loadingPacks).push.apply(d,a),this.totalPackCount=this._loadingPacks.length,this.loadedPackCount=0,this.loadPacksOneByOne(b,c);var d},a.prototype.loadPacksOneByOne=function(a,b){var c=this;if(this._loadingPacks.length<=0)a();else{var d=this._loadingPacks.shift();this.loadPack(d,function(e){c.loadedPackCount++,b(c.loadedPackCount,c.totalPackCount,d),c.loadPacksOneByOne(a,b)})}},a}();b.Preload=e}),System.registerDynamic("oge2d-main.js",["./oge2d/core/app","./oge2d/system/display","./oge2d/system/stage","./oge2d/system/tween","./oge2d/system/transition","./oge2d/system/motion","./oge2d/system/collision","./oge2d/system/mouse","./oge2d/system/keyboard","./oge2d/system/event-loop","./oge2d/library/json","./oge2d/library/audio","./oge2d/library/texture","./oge2d/library/script","./oge2d/library/preload"],!0,function(a,b,c){"use strict";this||self;Object.defineProperty(b,"__esModule",{value:!0});var d=a("./oge2d/core/app"),e=a("./oge2d/system/display"),f=a("./oge2d/system/stage"),g=a("./oge2d/system/tween"),h=a("./oge2d/system/transition"),i=a("./oge2d/system/motion"),j=a("./oge2d/system/collision"),k=a("./oge2d/system/mouse"),l=a("./oge2d/system/keyboard"),m=a("./oge2d/system/event-loop"),n=a("./oge2d/library/json"),o=a("./oge2d/library/audio"),p=a("./oge2d/library/texture"),q=a("./oge2d/library/script"),r=a("./oge2d/library/preload");b.app=new d.App({systems:{display:new e.Display,stage:new f.Stage,tween:new g.Tween,transition:new h.Transition,motion:new i.Motion,collision:new j.Collision,mouse:new k.Mouse,keyboard:new l.Keyboard,event:new m.EventLoop},libraries:{json:new n.Json,audio:new o.Audio,image:new p.Texture,script:new q.Script,preload:new r.Preload}})});