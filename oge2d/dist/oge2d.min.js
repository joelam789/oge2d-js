System.registerDynamic("oge2d/core/scene.js",["./sprite"],!0,function(t,e,i){"use strict";this||self;Object.defineProperty(e,"__esModule",{value:!0}),e.Timer=e.Scene=void 0;var n=t("./sprite"),s=function(){function t(t,e){this.game=null,this.name="",this.ticks=0,this.paused=!1,this.script=null,this.code=null,this._systems=[],this._sprites=[],this._timers=[],this._presettingSystems=[],this._preparingSystems=[],this._loadingSprites=[],this._pendingSpriteClones=[],this._preloadItemCount=0,this._spritesToLoad=0,this._localSpriteNames=[],this._spriteSceneNames={},this.pools={},this.sprites={},this.systems={},this.components={},this.game=t,this.name=e}return Object.defineProperty(t.prototype,"systemList",{get:function(){return this._systems},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"spriteList",{get:function(){return this._sprites},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"active",{get:function(){return this.game&&this.game.scene==this},enumerable:!1,configurable:!0}),t.prototype.init=function(t,e,i){var n=this,s=[],o=[],r=null,a=null;if(this.game.basics&&s.push.apply(s,this.game.basics),t.systems)for(var l=0,u=t.systems;l<u.length;l++){var h=u[l];s.indexOf(h)<0&&s.push(h)}for(var p=0,c=Object.keys(this.game.systems);p<c.length;p++){h=c[p];if(s.indexOf(h)>=0)(m=this.game.systems[h])&&("display"==h?r=m:"event"==h?a=m:o.push(m),this.systems[h]=m)}r&&this._systems.push(r),a&&this._systems.push(a);for(var d=0,f=o;d<f.length;d++){var m=f[d];this._systems.push(m)}if(t.components&&(this.components=t.components),this._localSpriteNames=[],t.sprites)for(var g=0,y=t.sprites;g<y.length;g++){var v=y[g];this._localSpriteNames.push(v)}this._spriteSceneNames={};for(var _=0,b=this._localSpriteNames;_<b.length;_++){v=b[_];this._spriteSceneNames[v]=this.name}if(t.scenes)for(var x=0,S=t.scenes;x<S.length;x++){var w=S[x],T=this.game.scenes[w];if(T)for(var j=0,P=T.getLocalSpriteNames();j<P.length;j++){v=P[j];this._spriteSceneNames[v]=T.name}}this._loadingSprites=[];for(var A=0,O=Object.keys(this._spriteSceneNames);A<O.length;A++){v=O[A];this._loadingSprites.push(v)}this._spritesToLoad=this._loadingSprites.length,this._presettingSystems=[];for(var M=0,C=this._systems;M<C.length;M++){m=C[M];this._presettingSystems.push(m.name)}this.preload(t.preload,function(){return n.presetSystems(function(){var s=n.game.libraries.script;s&&!0===t.script?s.loadSceneScript(n.game.libraries.systemjs,n.name,function(t){n.script=t,n.script.owner=n,n.code=s.proxy(n.script);var o=n.systems.event;o&&o.callEvent(n,"onInit"),n.loadSprites(function(){for(var t=0,i=n._systems;t<i.length;t++){var s=i[t];s.setup&&s.setup(n)}e(n)},function(t,e){i&&i(Math.round(1e4*(t+n._preloadItemCount)/(e+n._preloadItemCount))/100)})}):n.loadSprites(function(){for(var t=0,i=n._systems;t<i.length;t++){var s=i[t];s.setup&&s.setup(n)}e(n)},function(t,e){i&&i(Math.round(1e4*(t+n._preloadItemCount)/(e+n._preloadItemCount))/100)})})},function(t,e){i&&i(Math.round(1e4*t/(e+n._spritesToLoad))/100)})},t.prototype.preload=function(t,e,i){var n=this.game.libraries.preload;null!=t&&null!=t&&null!=n&&null!=n?(this._preloadItemCount=n.prepare(t),this._preloadItemCount<=0?e():n.load(this.game.libraries,e,i)):e()},t.prototype.presetSystems=function(t){var e=this;if(this._presettingSystems.length>0){var i=this._presettingSystems.shift(),n=this.systems[i];n&&n.preset?n.preset(this,function(){return e.presetSystems(t)}):this.presetSystems(t)}else t()},t.prototype.prepareSprite=function(t,e){var i=this;if(this._preparingSystems.length>0){var n=this._preparingSystems.shift(),s=this.systems[n];s&&s.prepare?s.prepare(t,function(){return i.prepareSprite(t,e)}):this.prepareSprite(t,e)}else e()},t.prototype.addSprite=function(t){if(null!=t&&null!=t&&!this.sprites[t.name]){this._sprites.push(t),this.sprites[t.name]=t;var e=t.origin?t.origin.name:t.name,i=e?this.pools[e]:null;i&&i.indexOf(t)<0&&i.push(t);for(var n=0,s=this._systems;n<s.length;n++){var o=s[n];o.include&&o.include(t)}}},t.prototype.removeSprite=function(t){if(null!=t&&null!=t){var e=t.origin?t.origin.name:t.name,i=e?this.pools[e]:null;if(i&&i.length>0){var n=i.indexOf(t);n>=0&&i.splice(n,1)}this.sprites[t.name]&&(this.sprites[t.name]=void 0);var s=this._sprites.indexOf(t);if(s>=0){this._sprites.splice(s,1);for(var o=0,r=this._systems;o<r.length;o++){var a=r[o];a.exclude&&a.exclude(t)}}}},t.prototype.loadSprites=function(t,e){var i=this;if(this._loadingSprites.length>0){var n=this._loadingSprites.shift();this.sprites[n]?(e&&e(this._spritesToLoad-this._loadingSprites.length,this._spritesToLoad),this.loadSprites(t,e)):this.loadSprite(n,function(n){e&&e(i._spritesToLoad-i._loadingSprites.length,i._spritesToLoad),i.loadSprites(t,e)})}else t()},t.prototype.addNewSprite=function(t,e,i){var n=this;this._preparingSystems=[];for(var s=0,o=this._systems;s<o.length;s++){var r=o[s];this._preparingSystems.push(r.name)}this.prepareSprite(t,function(){n.sprites[t.name]||n.addSprite(t),e&&(t.active=!0),i&&i(t)})},t.prototype.addNewSpriteWithClones=function(t,e,i,s){var o=this;if(null==i||isNaN(i)||i<=1)this.addNewSprite(t,e,s);else{var r=[t];this._pendingSpriteClones=[];for(var a=0;a<i-1;a++){var l=new n.Sprite(t.scene,t.name+"_"+(a+1));l.origin=t,l.script=t.script,l.code=t.code,l.base=t.base,l.template=t.template,l.components=JSON.parse(JSON.stringify(t.components)),this._pendingSpriteClones.push(l),r.push(l)}this.pools[t.name]=r,this.addNewSprite(t,e,function(i){o.addNewSpriteClones(t,e,function(){s(t)})})}},t.prototype.addNewSpriteClones=function(t,e,i){var n=this;if(this._pendingSpriteClones.length>0){var s=this._pendingSpriteClones.shift();s?this.addNewSprite(s,e,function(s){n.addNewSpriteClones(t,e,i)}):this.addNewSpriteClones(t,e,i)}else i()},t.prototype.loadSprite=function(t,e){var i=this,s=this.game.libraries.json;if(null!=s&&null!=s){var o=this.game.libraries.script;null!=o&&null!=o?s.loadJson("json/scenes/"+this._spriteSceneNames[t]+"/sprites/"+t+".json",function(s){if(null!=s&&null!=s){var r=new n.Sprite(i,t);if(!0===s.script)o.loadSceneSpriteScript(i.game.libraries.systemjs,i._spriteSceneNames[t],t,function(t){if(r.script=t,r.script.owner=r,r.code=o.proxy(r.script),s.template){r.template=s.template;i.loadSpriteTemplate(s.template,[],[],function(t,n){if(t?(s.components&&i.mergeComponents(t,s.components),r.components=t):s.components&&(r.components=s.components),n&&(r.script?(r.script.base=n,r.base=o.proxy(n)):(r.script={base:n,helper:n.helper},r.code=o.proxy(n),r.base=r.code)),!r.code&&r.base&&(r.code=r.base),r.script){var a=i.systems.event;a&&a.callEvent(r,"onInit")}i.addNewSpriteWithClones(r,s.active,s.count,e)})}else{if(r.script){var n=i.systems.event;n&&n.callEvent(r,"onInit")}i.addNewSpriteWithClones(r,s.active,s.count,e)}});else if(s.template){r.template=s.template;i.loadSpriteTemplate(s.template,[],[],function(t,n){if(t?(s.components&&i.mergeComponents(t,s.components),r.components=t):s.components&&(r.components=s.components),n&&(r.script?(r.script.base=n,r.base=o.proxy(n)):(r.script={base:n,helper:n.helper},r.code=o.proxy(n),r.base=r.code)),!r.code&&r.base&&(r.code=r.base),r.script){var a=i.systems.event;a&&a.callEvent(r,"onInit")}i.addNewSpriteWithClones(r,s.active,s.count,e)})}else i.addNewSpriteWithClones(r,s.active,s.count,e)}else e(null)}):e(null)}else e(null)},t.prototype.mergeComponents=function(t,e){if(t&&e)for(var i=0,n=Object.keys(e);i<n.length;i++){var s=n[i];t[s]&&"object"==typeof t[s]&&"object"==typeof e[s]?this.mergeComponents(t[s],e[s]):t[s]=e[s]}},t.prototype.reset=function(){this.ticks=0,this._timers=[];var t=this.game.libraries.json;if(null!=t&&null!=t){var e=t.getJson("json/scenes/"+this.name+"/"+this.name+".json");if(null!=e&&null!=e){this.mergeComponents(this.components,e.components);for(var i=new Map,n=0,s=this._sprites;n<s.length;n++){if(!(h=s[n]).origin){var o=t.getJson("json/scenes/"+this._spriteSceneNames[h.name]+"/sprites/"+h.name+".json");if(null!=o&&null!=o){var r=null,a=null;h.template&&(a=this.reloadSpriteTemplate(h.template)),a?(o.components&&this.mergeComponents(a,o.components),r=a):o.components&&(r=o.components),r&&(this.mergeComponents(h.components,r),i.set(h.name,r)),null!=o.active&&(h.active=o.active)}}}for(var l=0,u=this._sprites;l<u.length;l++){var h;null!=(h=u[l]).origin&&null!=h.origin&&(this.mergeComponents(h.components,i.get(h.origin.name)),h.active=h.origin.active)}for(var p=0,c=this._systems;p<c.length;p++){var d=c[p];d.refresh&&d.refresh(this)}}}},t.prototype.extractSpriteTemplate=function(t,e){var i={component:null,script:null};if(t)for(;t.length>0;){var n=t.pop();i.component?this.mergeComponents(i.component,n):i.component=n}if(e&&e.length>0){for(var s=0;s<e.length-1;s++)e[s].base=e[s+1];e[e.length-1].base=void 0,i.script=e[0]}return i},t.prototype.loadSpriteTemplate=function(t,e,i,n){var s=this,o=this.game.libraries.json,r=this.game.libraries.script;o.loadJson("json/sprites/"+t+".json",function(o){if(o)if(o.components&&e.push(o.components),!0===o.script)r.loadSpriteScript(s.game.libraries.systemjs,t,function(t){if(t&&i.push(t),o.template)s.loadSpriteTemplate(o.template,e,i,n);else{var r=s.extractSpriteTemplate(e,i);n(r.component,r.script)}});else if(o.template)s.loadSpriteTemplate(o.template,e,i,n);else{var a=s.extractSpriteTemplate(e,i);n(a.component,a.script)}else{a=s.extractSpriteTemplate(e,i);n(a.component,a.script)}})},t.prototype.reloadSpriteTemplate=function(t){var e=this.game.libraries.json.getJson("json/sprites/"+t+".json");if(e.template){var i=this.reloadSpriteTemplate(e.template);return i?(e.components&&this.mergeComponents(i,e.components),i):e.components}return e.components},t.prototype.getLocalSpriteNames=function(){var t=[];return t.push.apply(t,this._localSpriteNames),t},t.prototype.getFreeSprite=function(t){if(t&&t.length>0){var e=this.pools[t];if(e&&e.length>0)for(var i=0,n=e;i<n.length;i++){if(0==(r=n[i]).active)return r}}else for(var s=0,o=this._sprites;s<o.length;s++){var r;if(0==(r=o[s]).active)return r}return null},t.prototype.getFreeSpriteCount=function(t){var e=0;if(t&&t.length>0){var i=this.pools[t];if(i&&i.length>0)for(var n=0,s=i;n<s.length;n++){0==s[n].active&&e++}}else for(var o=0,r=this._sprites;o<r.length;o++){0==r[o].active&&e++}return e},t.prototype.get=function(t){return this.components[t]},t.prototype.sys=function(t){return this.systems[t]},t.prototype.spr=function(t){return this.sprites[t]},t.prototype.call=function(t){for(var e,i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];if(t.indexOf(".")>=0){var s=t.split(".");if(s.length>=2&&s[0]&&s[1]){var o=this.sys(s[0]);if(o&&o[s[1]])return o[s[1]].apply(o,i)}}else if(this.script&&this.script[t])return(e=this.script)[t].apply(e,i)},t.prototype.timeout=function(t,e,i){var n=new o;n.start=this.ticks,n.timeout=t,n.target=i,n.callback=e,this._timers.push(n)},t.prototype.update=function(t){var e;if(0==this.paused){this.ticks+=t;for(var i=[],n=0,s=this._timers;n<s.length;n++){var o=s[n];this.ticks-o.start>=o.timeout?o.callback&&o.callback(o.target):i.push(o)}i.length!=this._timers.length&&(this._timers=[],i.length>0&&(e=this._timers).push.apply(e,i))}for(var r=0,a=this._systems;r<a.length;r++){var l=a[r];l.update&&l.update(this,t)}},t}();e.Scene=s;var o=function(){return function(){this.start=-1,this.timeout=0,this.target=null,this.callback=null}}();e.Timer=o}),System.registerDynamic("oge2d/core/game.js",["./scene"],!0,function(t,e,i){"use strict";this||self;Object.defineProperty(e,"__esModule",{value:!0}),e.Game=void 0;var n=t("./scene"),s=function(){function t(t){this.name="",this.container=null,this.width=0,this.height=0,this.fps=0,this.ticks=0,this.deltaTime=0,this.script=null,this.code=null,this.scenes={},this.systems={},this.libraries={},this.components={},this.basics=[],this._lastScene=null,this._nextScene=null,this._currentScene=null,this._loadingScenes=[],this._scenesToLoad=0,this.name=t}return Object.defineProperty(t.prototype,"lastScene",{get:function(){return this._lastScene},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"nextScene",{get:function(){return this._nextScene},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scene",{get:function(){return this._currentScene},set:function(t){if(t){if(this._nextScene=t,this._currentScene){for(var e=0,i=this._currentScene.systemList;e<i.length;e++){(a=i[e]).deactivate&&a.deactivate(this._currentScene)}if(l=this.systems.event){for(var n=0,s=this._currentScene.spriteList;n<s.length;n++){(p=s[n]).active&&l.callEvent(p,"onSceneDeactivate")}l.callEvent(this._currentScene,"onDeactivate")}}if(this._lastScene=this._currentScene,this._nextScene=null,this._currentScene=t,this._currentScene){for(var o=0,r=this._currentScene.systemList;o<r.length;o++){var a;(a=r[o]).activate&&a.activate(this._currentScene)}var l;if(l=this.systems.event){l.callEvent(this._currentScene,"onActivate");for(var u=0,h=this._currentScene.spriteList;u<h.length;u++){var p;(p=h[u]).active&&l.callEvent(p,"onSceneActivate")}}}}},enumerable:!1,configurable:!0}),t.prototype.init=function(t,e,i,n){var s,o=this;t.components&&(this.components=t.components),i.forEach(function(t,e){return o.libraries[e]=t});var r=[],a=[],l=null;e.forEach(function(t,e){o.systems[e]=t,"event"==e&&(l=t),o.components.hasOwnProperty(e)?r.push(t):a.push(t)}),t.basics&&(s=this.basics).push.apply(s,t.basics),this.preloadPacks(t.packs,function(){var e=o.libraries.script;if(e&&!0===t.script)e.loadGameScript(o.libraries.systemjs,o.name,function(i){o.script=i,o.script.owner=o,o.code=e.proxy(o.script);for(var s=0,u=r;s<u.length;s++){(c=u[s]).init&&c.init(o)}for(var h=0,p=a;h<p.length;h++){var c;(c=p[h]).init&&c.init(o)}l&&l.callEvent(o,"onInit"),o.loadScenes(t.scenes,function(){if(t.scenes&&t.scenes.length>0){var e=t.first&&t.first.length>0?t.first:t.scenes[0];o.scenes[e]&&(o.scene=o.scenes[e])}n(o)})});else{for(var i=0,s=r;i<s.length;i++){(p=s[i]).init&&p.init(o)}for(var u=0,h=a;u<h.length;u++){var p;(p=h[u]).init&&p.init(o)}o.loadScenes(t.scenes,function(){t.scenes&&t.scenes.length>0&&(o.scene=o.scenes[t.scenes[0]]),n(o)})}})},t.prototype.preloadPacks=function(t,e){if(t&&t.length>0){for(var i=[],n=0,s=t;n<s.length;n++){var o=s[n],r=o.indexOf(".")<0?o+".pack":o;i.push(r)}console.log("preloading pack file(s) ... "),this.libraries.preload.loadPacks(i,e,function(t,e,i){console.log("preloaded "+i+" ("+t+"/"+e+")")})}else e()},t.prototype.loadScenesOneByOne=function(t,e){var i=this;if(this._loadingScenes.length>0){var n=this._loadingScenes.shift();this.loadScene(n,function(n){i.loadScenesOneByOne(t,e)},function(t){var n=100/i._scenesToLoad*(i._scenesToLoad-(i._loadingScenes.length+1)+t/100);(n=Math.round(100*n)/100)>100&&(n=100),e&&e(n)})}else t()},t.prototype.loadScenes=function(t,e,i){if(null==t||null==t||t.length<=0)return i&&i(100),void e();if(this._loadingScenes=[],t)for(var n=0,s=t;n<s.length;n++){var o=s[n];this._loadingScenes.push(o)}this._scenesToLoad=this._loadingScenes.length,this.loadScenesOneByOne(e,i)},t.prototype.loadScene=function(t,e,i){var s=this,o=this.libraries.json;if(null!=o&&null!=o){var r=this.scenes[t];if(r)return i&&i(100),void e(r);o.loadJson("json/scenes/"+t+"/"+t+".json",function(o){null!=o&&null!=o?new n.Scene(s,t).init(o,function(t){t&&(s.scenes[t.name]=t),e(t)},i):e(null)})}else e(null)},t.prototype.get=function(t){return this.components[t]},t.prototype.sys=function(t){return this.systems[t]},t.prototype.lib=function(t){return this.libraries[t]},t.prototype.call=function(t){for(var e,i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];if(this.script&&this.script[t])return(e=this.script)[t].apply(e,i)},t.prototype.update=function(t){this.deltaTime=t,this.ticks+=t,null!=this.scene&&this.scene.update(t);var e=this.components.event;if(this.script){if(e&&e.queue)for(var i=0,n=e.queue;i<n.length;i++){var s=n[i],o=e[s.name];o&&this.script[o]&&this.script[o](this,s.data)}var r=e?e.onUpdate:void 0;r&&this.script[r]&&this.script[r](this)}e&&(null==e.queue||null==e.queue?e.queue=[]:e.queue.length>0&&(e.queue=[]))},t}();e.Game=s}),System.registerDynamic("oge2d/core/app.js",["./game"],!0,function(t,e,i){"use strict";this||self;Object.defineProperty(e,"__esModule",{value:!0}),e.App=void 0;var n=t("./game"),s=function(){function t(t){if(this.game=null,this.systems=new Map,this.libraries=new Map,t&&t.systems)for(var e=0,i=Object.keys(t.systems);e<i.length;e++){var n=i[e];this.systems.set(n,t.systems[n])}if(t&&t.libraries)for(var s=0,o=Object.keys(t.libraries);s<o.length;s++){n=o[s];this.libraries.set(n,t.libraries[n])}if(t){var r=window;r.SystemJS?this.libraries.set("systemjs",r.SystemJS):r.System&&this.libraries.set("systemjs",r.System)}}return t.prototype.load=function(t,e){var i=this,n=window,s=n.SystemJS||n.System;this.loadModules(s,t,function(){i.loadGame(t.game,t.container,function(t){e(t)})})},t.prototype.loadGame=function(t,e,i){var s=this,o=t&&t.length>0?t:"game",r=this.libraries.get("json");null!=r&&null!=r?r.loadJson("json/games/"+o+".json",function(t){if(null!=t&&null!=t){var r=new n.Game(o),a=e&&e.length>0?document.getElementById(e):document.body;r.container=a||document.body,r.init(t,s.systems,s.libraries,function(t){i&&i(t)})}else i&&i(null)}):i&&i(null)},t.prototype.loadModules=function(t,e,i){var n=this,s=[];this.loadSystems(t,e,function(o){o.forEach(function(t,e){return s.push(t)}),n.loadLibraries(t,e,function(t){t.forEach(function(t,e){return s.push(t)}),i(s)})})},t.prototype.loadSystems=function(t,e,i){var n=this;if(null!=e&&null!=e&&null!=e.systems&&null!=e.systems){for(var s=[],o=new Map,r=0,a=Object.keys(e.systems);r<a.length;r++){for(var l=a[r],u="",h=e.systems[l],p=h.split("/"),c=p[p.length-1],d="?",f="",m=0;m<c.length;m++)f=c.charAt(m),0==/[^a-zA-Z0-9]/.test(f)&&(0==/[^a-zA-Z0-9]/.test(d)?u+=f:u+=f.toUpperCase()),d=f;o.set(l,u),s.push(t.import(h))}Promise.all(s).then(function(t){o.forEach(function(e,i){for(var s=0,o=t;s<o.length;s++){var r=o[s];if(r.hasOwnProperty(e)){var a=Object.create(r[e].prototype);a.constructor.apply(a,[]),n.systems.set(i,a);break}}}),i(n.systems)})}else i(this.systems)},t.prototype.loadLibraries=function(t,e,i){var n=this;if(t&&this.libraries.set("systemjs",t),null!=e&&null!=e&&null!=e.libraries&&null!=e.libraries){for(var s=[],o=new Map,r=0,a=Object.keys(e.libraries);r<a.length;r++){for(var l=a[r],u="",h=e.libraries[l],p=h.split("/"),c=p[p.length-1],d="?",f="",m=0;m<c.length;m++)f=c.charAt(m),0==/[^a-zA-Z0-9]/.test(f)&&(0==/[^a-zA-Z0-9]/.test(d)?u+=f:u+=f.toUpperCase()),d=f;o.set(l,u),s.push(t.import(h))}Promise.all(s).then(function(t){o.forEach(function(e,i){for(var s=0,o=t;s<o.length;s++){var r=o[s];if(r.hasOwnProperty(e)){var a=Object.create(r[e].prototype);a.constructor.apply(a,[]),n.libraries.set(i,a);break}}}),i(n.libraries)})}else i(this.libraries)},t}();e.App=s}),System.registerDynamic("oge2d/system/display.js",[],!0,function(t,e,i){"use strict";this||self;Object.defineProperty(e,"__esModule",{value:!0}),e.AnimationContainerPixi=e.Display=void 0;var n=function(){function t(){this.name="display",this._pauses={},this._game=null,this._event=null,this._pixi=null,this._ticker=null}return t.prototype.init=function(t){var e=this;this._game=t,this._event=t.systems.event;var i=t.components.display;if(PIXI.settings.SCALE_MODE=PIXI.SCALE_MODES.NEAREST,this._pixi=new PIXI.Application({width:i.width,height:i.height}),this._pixi.stage=new PIXI.display.Stage,PIXI.settings.ROUND_PIXELS=!0,this._game.width=this._pixi.screen.width,this._game.height=this._pixi.screen.height,t.container?t.container.appendChild(this._pixi.view):document.body.appendChild(this._pixi.view),i.pixi=this._pixi,i.object=this._pixi.stage,i.plugins=this._pixi.renderer.plugins,i.layers){var n=0,s={};if(Array.isArray(i.layers)){var o=[];o.push.apply(o,i.layers),i.layers={};for(var r=0,a=o;r<a.length;r++){var l=a[r];i.layers[l]=""}}this._pixi.stage.group.enableSort=!0;var u=new PIXI.display.Group(0,!1);this._pixi.stage.addChild(new PIXI.display.Layer(u)),i.bglayer=u;for(var h=0,p=Object.keys(i.layers);h<p.length;h++){var c=p[h];c.length>0&&(n++,"default"==i.layers[c]?(s[c]=new PIXI.display.Group(n,function(t){t.zOrder=1e4*t.y+t.x}),this._pixi.stage.addChild(new PIXI.display.Layer(s[c]))):i.layers[c]&&i.layers[c].length>0&&t.script&&t.script[i.layers[c]]?(s[c]=new PIXI.display.Group(n,!0),s[c].on("sort",t.script[i.layers[c]]),this._pixi.stage.addChild(new PIXI.display.Layer(s[c]))):(s[c]=new PIXI.display.Group(n,!1),this._pixi.stage.addChild(new PIXI.display.Layer(s[c]))))}i.layers=s}return this._ticker=this._pixi.ticker.add(function(t){e._game.fps=e._ticker.FPS,e._game.update(e._ticker.elapsedMS)}),i.ticker=this._ticker,t.components.display=i,!0},t.prototype.preset=function(t,e){if(t){var i=t.components.display;if(null!=i&&null!=i||(t.components.display={},i=t.components.display),!i||null!=i.object&&null!=i.object||(i.object=new PIXI.Container),i.object&&t.game){var n=t.game.components.display;if(n.bglayer&&(null==i.bgcontainer||null==i.bgcontainer)){var s=new PIXI.Container;s.parentGroup=n.bglayer,i.object.addChild(s),i.bgcontainer=s}}this._pauses[t.name]=!1}e&&e()},t.prototype.prepare=function(t,e){var i=this,n=t.components.display;if(n&&n.object)e&&e();else{var o=null;if((n=t.scene.components.display)&&n.object&&(o=n.object),o&&(n=t.components.display),o&&n&&(null==n.object||null==n.object)){var r=t.components.text,a=t.components.graphic,l=t.components.animation;if(r){var u=r.content&&r.content.length>0?Array.isArray(r.content)?r.content.join("\n"):r.content.toString():"";r.content=u;var h=new PIXI.Text(u,r.style?r.style:void 0);return this.applySpriteProperties(h,n),n.object=h,void(e&&e())}if(a&&a.image&&a.area){if((p=a.image.toString()).indexOf(".")<0&&(p+=".png"),c=t.game.libraries.image)return void c.loadTexture("img/"+p,a.area,function(t){if(t){var s=a.slice&&a.slice.length>=4?new PIXI.NineSlicePlane(t,a.slice[0],a.slice[1],a.slice[2],a.slice[3]):new PIXI.Sprite(t);i.applySpriteProperties(s,n),n.object=s}e&&e()})}else if(l&&l.image&&l.sheets){var p,c;if((p=l.image.toString()).indexOf(".")<0&&(p+=".png"),c=t.game.libraries.image){for(var d=[],f=new Map,m=new Map,g=l.sheets,y=new s,v=Object.keys(g),_=0,b=v;_<b.length;_++){for(var x=b[_],S=g[x],w=Math.floor(S.length/4),T=[],j=[],P=0;P<w;P++)T.push("img/"+p),j.push({x:S[4*P],y:S[4*P+1],width:S[4*P+2],height:S[4*P+3]});d.push(x),f.set(x,T),m.set(x,j)}return void c.loadSheets(d,f,m,function(s){if(s&&s.size>0){s.forEach(function(t,e){return y.items.set(e,t)}),l.current&&y.items.has(l.current.toString())?y.current=l.current.toString():y.current=v[0];var o=new PIXI.AnimatedSprite(y.items.get(y.current),!0);i.applySpriteProperties(o,n),l.hasOwnProperty("loop")&&(o.loop=l.loop),l.hasOwnProperty("speed")&&(o.animationSpeed=l.speed),y.owner=t,y.sprite=o,y.events=i._event,n.object=o,n.animation=y,o.onComplete=y.done.bind(y),o.play()}e&&e()})}}else if(t.script){var A=this.getScriptFunction(t.script,"prepareTexture"),O=this.getScriptFunction(t.script,"prepareTextureAsync"),M=this.getScriptFunction(t.script,"prepareSprite"),C=this.getScriptFunction(t.script,"prepareSpriteAsync");if(A){var k=A?A(t):null;if(k){h=new PIXI.Sprite(k);this.applySpriteProperties(h,n),n.object=h}e&&e()}else if(O)O(t,function(t){if(t){var s=new PIXI.Sprite(t);i.applySpriteProperties(s,n),n.object=s}e&&e()});else if(M){(h=M(t))&&(this.applySpriteProperties(h,n),n.object=h),e&&e()}else C&&C(t,function(t){if(t){var s=t;i.applySpriteProperties(s,n),n.object=s}e&&e()});return}}e&&e()}},t.prototype.setup=function(t){this.updateDisplayParentNode(t),this.updateAnimationState(t)},t.prototype.activate=function(t){var e=t.components.display;if(e&&(null!=e.object&&null!=e.object||(e.object=new PIXI.Container),e.object&&this._pixi.stage.addChild(e.object),e.bgcolor)){var i=e.bgcolor.toString();i.length>1&&"#"==i.charAt(0)&&(this._pixi.renderer.backgroundColor=parseInt(i.substring(1),16))}},t.prototype.deactivate=function(t){var e=t.components.display;e&&e.object&&e.object instanceof PIXI.Container&&this._pixi.stage.removeChild(e.object)},t.prototype.include=function(t){var e=null,i=t.scene.components.display;i&&i.object&&(e=i.object),this.updateSpriteParentNode(t,e)},t.prototype.exclude=function(t){var e=t.components.display;if(e&&e.object){var i=null;(e=t.scene.components.display)&&e.object&&(i=e.object),i&&(e=t.components.display),i&&e&&e.object&&i==e.object.parent&&i.removeChild(e.object)}},t.prototype.enable=function(t){var e=t.components.display;e&&e.object&&(e.object.visible=!0)},t.prototype.disable=function(t){var e=t.components.display;e&&e.object&&(e.object.visible=!1)},t.prototype.refresh=function(t){if(t.components.display){for(var e=0,i=t.spriteList;e<i.length;e++){var n=i[e],s=n.components.display;if(s&&s.object){var o=n.components.text,r=n.components.animation;if(this.applySpriteProperties(s.object,s),o){var a=o.content&&o.content.length>0?Array.isArray(o.content)?o.content.join("\n"):o.content.toString():"";o.content=a,a!=s.object.text&&(s.object.text=a)}else if(r)if(r.hasOwnProperty("loop")&&(s.object.loop=r.loop),r.hasOwnProperty("speed")&&(s.object.animationSpeed=r.speed),r.current&&s.animation)s.animation.set(r.current.toString());else if(r.sheets&&s.animation){var l=Object.keys(r.sheets);l.length>0&&s.animation.set(l[0])}}}this.updateDisplayParentNode(t),this.updateAnimationState(t)}},t.prototype.update=function(t,e){this.updateAnimationState(t)},t.prototype.applySpriteProperties=function(t,e){for(var i=0,n=Object.keys(e);i<n.length;i++){var s=n[i];if("object"!=s&&("animation"!=s&&"parent"!=s))if("angle"!=s)if("tint"!=s||"string"!=typeof e[s])if("layer"!=s){if(null!=t[s])if("object"==typeof e[s])for(var o=0,r=Object.keys(e[s]);o<r.length;o++){var a=r[o];if(null!=t[s][a])if("object"==typeof e[s][a])for(var l=0,u=Object.keys(e[s][a]);l<u.length;l++){var h=u[l];t[s][a][h]=e[s][a][h]}else t[s][a]=e[s][a]}else t[s]=e[s]}else this._game.components.display.layers&&this._game.components.display.layers[e[s].toString()]&&(t.parentGroup=this._game.components.display.layers[e[s].toString()]);else{var p=e[s].toString();p.length>1&&"#"==p.charAt(0)&&(t.tint=parseInt(p.substring(1),16))}else t.rotation=e[s]*Math.PI/180}},t.prototype.updateAnimationState=function(t){if(this._pauses[t.name]!=t.paused){for(var e=0,i=t.spriteList;e<i.length;e++){var n=i[e];if(n.active){var s=n.components.display;s&&s.object&&s.animation&&(t.paused?s.object.stop():s.object.play())}}this._pauses[t.name]=t.paused}},t.prototype.updateSpriteParentNode=function(t,e){var i=t.components.display;if(i&&i.object){var n=null,s=null,o=null;i.parent&&(s=i.parent),s&&s.length>0&&(o=t.scene.sprites[s]),o&&o.components.display&&(n=o.components.display.object),null!=n&&null!=n||(n=e),n&&n!=i.object.parent&&n.addChild(i.object),i.object.visible=t.active}},t.prototype.updateDisplayParentNode=function(t){var e=t.spriteList,i=t.components.stage,n=t.components.display,s=null,o=null;i&&i.display&&(o=i.display),n&&n.object&&(s=n.object);for(var r=0,a=e;r<a.length;r++){var l=a[r];this.updateSpriteParentNode(l,l.components.stage&&o?o:s)}},t.prototype.getScriptFunction=function(t,e){return t?t[e]?t[e]:this.getScriptFunction(t.base,e):null},t}();e.Display=n;var s=function(){function t(){this.owner=null,this.events=null,this.current="",this.sprite=null,this.items=new Map,this.onComplete=null}return t.prototype.set=function(t,e){!0!==e&&this.current==t||this.sprite&&this.items.get(t)&&(this.sprite.textures=this.items.get(t),this.current=t,this.sprite.play())},t.prototype.reset=function(t,e){if(this.sprite&&(this.sprite.gotoAndStop(0),t)){if(!0!==e&&this.current==t)return;this.items.get(t)&&(this.sprite.textures=this.items.get(t),this.sprite.texture=this.sprite.textures[0],this.current=t)}},t.prototype.play=function(t){void 0===t&&(t=!0),this.sprite&&(this.sprite.loop=t,this.sprite.play())},t.prototype.done=function(){this.sprite&&!this.sprite.loop&&this.events&&this.owner&&(this.onComplete?this.onComplete(this.owner):this.events.addEvent(this.owner,"onAnimationComplete"))},t}();e.AnimationContainerPixi=s}),System.registerDynamic("oge2d/system/stage.js",[],!0,function(t,e,i){"use strict";this||self;Object.defineProperty(e,"__esModule",{value:!0}),e.GameMap=e.RangeFinder=e.VisitNode=e.PathFinder=e.ResultNode=e.StepNode=e.Stage=void 0;var n=function(){function t(){this.name="stage",this._game=null,this._loadingTilesets=[],this._loadedTilesets=[],this._tilesets={},this._tilemaps={},this._gamemaps={}}return t.prototype.init=function(t){return this._game=t,!0},t.prototype.preset=function(t,e){var i=this,n=t.components.stage;if(null!=n&&null!=n){n.maxX=n.maxY=0;var s=null,o=t.components.display;if(o&&o.object&&(s=o.object),null!=s&&null!=s){var r=t.game.libraries.image;if(null!=r&&null!=r){s=o.bgcontainer;var a=n.map?n.map.toString():"",l=0,u=0,h=0;if(n.pics&&n.pics.length>0){for(var p=[],c=[],d=0,f=n.pics;d<f.length;d++){var m=f[d];m.indexOf(".")<0&&(m+=".png"),p.push("img/"+m);var g={x:0,y:0,width:0,height:0},y=n.areas[l++],v=n.areas[l++];g.width=n.areas[l++],g.height=n.areas[l++],y=y+g.width-this._game.width,v=v+g.height-this._game.height,y>u&&(u=y),v>h&&(h=v),c.push(g)}u>n.maxX&&(n.maxX=u),h>n.maxY&&(n.maxY=h),l=0,r.loadTextures(p,c,function(t){if(t&&t.length>0){n.blocks=[];for(var o=0,r=t;o<r.length;o++){var p=r[o],c=new PIXI.Sprite(p);c.x=n.areas[l++],c.y=n.areas[l++],s.addChild(c),n.blocks.push(c),l+=2}}a&&a.length>0?i.loadTilemap(a,function(t){u=0,h=0,t&&t.columnCount>0&&t.tileWidth>0&&(u=t.columnCount*t.tileWidth-i._game.width),t&&t.rowCount>0&&t.tileHeight>0&&(h=t.rowCount*t.tileHeight-i._game.height),u>n.maxX&&(n.maxX=u),h>n.maxY&&(n.maxY=h),n.tilemap=t,t&&(n.gamemap=i._gamemaps[a],s.addChild(n.tilemap.display)),s.children&&s.children.length>0&&(n.display=s),e&&e()}):(s.children&&s.children.length>0&&(n.display=s),e&&e())})}else a&&a.length>0?this.loadTilemap(a,function(t){u=0,h=0,t&&t.columnCount>0&&t.tileWidth>0&&(u=t.columnCount*t.tileWidth-i._game.width),t&&t.rowCount>0&&t.tileHeight>0&&(h=t.rowCount*t.tileHeight-i._game.height),u>n.maxX&&(n.maxX=u),h>n.maxY&&(n.maxY=h),n.tilemap=t,t&&(n.gamemap=i._gamemaps[a],s.addChild(n.tilemap.display)),s.children&&s.children.length>0&&(n.display=s),e&&e()}):(s.children&&s.children.length>0&&(n.display=s),e&&e())}else e&&e()}else e&&e()}else e&&e()},t.prototype.setup=function(t){var e=t.components.stage;e&&(isNaN(e.x)||(e.x<0&&(e.x=0),e.x>e.maxX&&(e.x=e.maxX)),isNaN(e.y)||(e.y<0&&(e.y=0),e.y>e.maxY&&(e.y=e.maxY)),e.waiting=!1,e.looping=!1,e.scrolling=!1,e.shake=null,e.callback=null)},t.prototype.activate=function(t){var e=t.components.stage;if(e){if(e.follow){var i=t.sprites[e.follow],n=i?i.components.stage:null;n&&(e.x=Math.round(n.x-t.game.width/2),e.y=Math.round(n.y-t.game.height/2))}isNaN(e.x)||(e.x<0&&(e.x=0),e.x>e.maxX&&(e.x=e.maxX)),isNaN(e.y)||(e.y<0&&(e.y=0),e.y>e.maxY&&(e.y=e.maxY))}},t.prototype.enable=function(t){var e=t.scene.components.stage;if(e){var i=t.components.display;if(i&&i.object)if(t.active){var n=t.components.stage;n&&(i.object.x=Math.round(n.x-e.x),i.object.y=Math.round(n.y-e.y)),0==i.object.visible&&(i.object.visible=!0)}else 1==i.object.visible&&(i.object.visible=!1)}},t.prototype.update=function(t,e){var i=t.components.stage;if(i){if(!0===i.waiting&&i.x==i.targetX&&i.y==i.targetY&&(i.waiting=!1,i.callback))return i.callback(t),void(i.callback=null);if(!0===i.looping&&i.x==i.endX&&i.y==i.endY&&(i.x=i.beginX,i.y=i.beginY),!0===i.scrolling){var n=i.x+i.speedX,s=i.y+i.speedY;n>=0&&n<=i.maxX&&(i.x=n),s>=0&&s<=i.maxY&&(i.y=s)}else if(i.follow){var o=t.sprites[i.follow],r=o?o.components.stage:null;if(r){n=Math.round(r.x-t.game.width/2),s=Math.round(r.y-t.game.height/2);n>i.maxX?i.x=i.maxX:i.x=n<0?0:n,s>i.maxY?i.y=i.maxY:i.y=s<0?0:s}}if(i.blocks)for(var a=0,l=0,u=i.blocks;l<u.length;l++){var h=u[l];h.x=0-i.x+i.areas[a++],h.y=0-i.y+i.areas[a++],a+=2}i.tilemap&&this.updateTilemapView(t);for(var p=0,c=t.spriteList;p<c.length;p++){var d=c[p],f=d.components.display;if(f&&f.object)if(d.active){var m=d.components.stage;m&&(f.object.x=Math.round(m.x-i.x),f.object.y=Math.round(m.y-i.y)),0==f.object.visible&&(f.object.visible=!0)}else 1==f.object.visible&&(f.object.visible=!1)}if(i.shake){i.shake.total++;var g=i?i.display:null;g&&i.shake.speed>0&&i.shake.total%(11-i.shake.speed)==0&&(g.position.x!=g.pivot.x?g.position.x=g.pivot.x:(i.shake.minX||i.shake.maxX)&&(g.position.x=g.pivot.x+this.getRandomInt(i.shake.minX,i.shake.maxX)),g.position.y!=g.pivot.y?g.position.y=g.pivot.y:(i.shake.minY||i.shake.maxY)&&(g.position.y=g.pivot.y+this.getRandomInt(i.shake.minY,i.shake.maxY)),i.shake.count++,i.shake.times>0&&i.shake.times==i.shake.count&&(i.shake.callback&&i.shake.callback(),this.shake(t,!1)))}}},t.prototype.getRandomInt=function(t,e){return Math.floor(Math.random()*(e-t+1)+t)},t.prototype.shake=function(t,e,i,n,s,o,r,a){void 0===i&&(i=0),void 0===n&&(n=0),void 0===s&&(s=0),void 0===o&&(o=0),void 0===r&&(r=0),void 0===a&&(a=null);var l=t.components.stage;if(l)if("boolean"==typeof e)if(!1===e){l.shake=null;var u=l?l.display:null;u&&(u.position.x=u.pivot.x,u.position.y=u.pivot.y)}else!0===e&&this.shake(t,9,1,10,1,10);else l.shake={count:0,total:0,times:r,callback:a,speed:e>10?10:e,minX:s,minY:i,maxX:o>s?o:s,maxY:n>i?n:i}},t.prototype.transform=function(t,e){void 0===e&&(e=!0);var i=this._game.scene.components.stage;return i?{x:e?t.x+i.x:t.x-i.x,y:e?t.y+i.y:t.y-i.y}:t},t.prototype.follow=function(t,e){var i=t.components.stage;if(i)if(null==e||0==e.length)i.follow=null;else{var n=t.sprites[e];if(n&&(i.follow=e),n&&i.follow){i.scrolling=!1;var s=n?n.components.stage:null;s&&(i.x=Math.round(s.x-t.game.width/2),i.y=Math.round(s.y-t.game.height/2),i.x<0&&(i.x=0),i.x>i.maxX&&(i.x=i.maxX),i.y<0&&(i.y=0),i.y>i.maxY&&(i.y=i.maxY))}}},t.prototype.zoom=function(t,e,i,n,s){var o=t.get("stage"),r=o?o.display:null;if(null!=r&&null!=r)if("boolean"==typeof e)!1===e&&(r.scale.x=1,r.scale.y=1);else if(e>0){var a=e,l=i&&i>0?i:e,u=null==n?this._game.width/2:n,h=null==s?this._game.height/2:s;r.scale.x=a,r.scale.y=l,r.pivot.x=u,r.pivot.y=h,r.position.x=r.pivot.x,r.position.y=r.pivot.y}},t.prototype.zoomTo=function(t,e,i,n,s,o,r){var a=t.get("stage"),l=t.sys("tween"),u=a&&l?a.display:null;null!=u&&null!=u&&(u.pivot.x=n,u.pivot.y=s,u.position.x=u.pivot.x,u.position.y=u.pivot.y,l.get(u.scale).to({x:e,y:i},o).call(function(){r&&r()}))},t.prototype.setPivot=function(t,e,i){var n=t.get("stage"),s=n?n.display:null;s&&(s.pivot.x=e,s.pivot.y=i,s.position.x=s.pivot.x,s.position.y=s.pivot.y)},t.prototype.setPos=function(t,e,i){var n=i?i.components:this._game.scene.components,s=n?n.stage:null;s&&(s.x=t,s.y=e)},t.prototype.setSpritePos=function(t,e,i){this.setPos(e,i,t)},t.prototype.getViewRect=function(){var t=this._game.scene,e=new PIXI.Rectangle(0,0,t.game.width,t.game.height),i=t.components.stage;return i&&(e.x+=i.x,e.y+=i.y),i},t.prototype.wait=function(t,e,i){var n=this._game.scene.components.stage;n&&(n.waiting=!0,n.targetX=t,n.targetY=e,n.callback=i)},t.prototype.scroll=function(t,e){var i=this._game.scene.components.stage;i&&("number"==typeof t?(i.scrolling=!0,i.speedX=t,i.speedY=e||0):i.scrolling=!0===t,!0===i.scrolling&&(i.follow=null))},t.prototype.loop=function(t,e,i,n){var s=this._game.scene.components.stage;s&&(s.looping=!0,s.beginX=t,s.beginY=e,s.endX=i,s.endY=n)},t.prototype.loadTileset=function(t,e){var i=this;if(this._tilesets[t])e&&e(this._tilesets[t]);else{var n=this._game.libraries.json;if(null!=n&&null!=n){var s=this._game.libraries.image;null!=s&&null!=s?n.loadJson("json/tilesets/"+t+".json",function(n){if(null==n||null==n)return console.error("Failed to load tileset: "+t),void(e&&e(null));var o=n.image.toString();o.indexOf(".")<0&&(o+=".png");var r="img/"+o;s.loadImage(r,function(a){if(null==a||null==a)return console.error("Failed to load tileset image: img/"+o),void(e&&e(null));n.texture=a;for(var l={x:0,y:0,width:n.tileWidth,height:n.tileHeight},u=0,h=n.tiles;u<h.length;u++){var p=h[u];p.textures=[];for(var c=0;c<p.offsets.length;c+=2){l.x=p.offsets[c],l.y=p.offsets[c+1];var d=s.getTexture(r,l);d&&p.textures.push(d)}}i._tilesets[t]=n,e&&e(n)})}):e&&e(null)}else e&&e(null)}},t.prototype.loadTilesetsOneByOne=function(t){var e=this;if(this._loadingTilesets.length<=0){for(var i=[],n=0,s=this._loadedTilesets;n<s.length;n++){var o=s[n];i.push(o)}return this._loadedTilesets=[],void t(i)}var r=this._loadingTilesets.shift();this.loadTileset(r,function(i){i&&e._loadedTilesets.push(i),e.loadTilesetsOneByOne(t)})},t.prototype.loadTilesets=function(t,e){this._loadingTilesets=[],this._loadedTilesets=[];for(var i=0,n=t;i<n.length;i++){var s=n[i];this._loadingTilesets.push(s)}this.loadTilesetsOneByOne(function(t){e(t)})},t.prototype.loadTilemap=function(t,e){var i=this;if(this._tilemaps[t])e&&e(this._tilemaps[t]);else{var n=this._game.libraries.json;null!=n&&null!=n?n.loadJson("json/tilemaps/"+t+".json",function(n){if(null==n||null==n)return console.error("Failed to load tilemap: "+t),void(e&&e(null));n.width=n.tileWidth*n.columnCount,n.height=n.tileHeight*n.rowCount,n.viewWidth=n.width<=i._game.width?i._game.width:n.width,n.viewHeight=n.height<=i._game.height?i._game.height:n.height;var s=n.tileWidth,o=n.tileHeight;if(n.bgcolor){var r=n.bgcolor.toString();r.length>=7&&"#"==r.charAt(0)&&parseInt(r.substr(1,6),16),r.length>=9&&"#"==r.charAt(0)&&(n.bgcolorOpacity=Math.round(parseInt(r.substr(7,2),16)/255*100)/100)}var a=document.createElement("canvas");a.width=s,a.height=s;var l=a.getContext("2d");n.bgcolor?l.fillStyle=n.bgcolor.toString():l.fillStyle="rgba(0, 0, 0, 1)",l.fillRect(0,0,s,s),n.defaultTileTexture=PIXI.Texture.from(a),n.defaultTileTextures=[n.defaultTileTexture];var h=n.viewWidth%s;h=0==h?Math.floor(n.viewWidth/s)+1:Math.floor((n.viewWidth-h)/s)+2;var p=n.viewHeight%o;p=0==p?Math.floor(n.viewHeight/o)+1:Math.floor((n.viewHeight-p)/o)+2,n.display=new PIXI.Container,n.sprites=[],n.spriteCount=h*p*2;for(var c=0;c<n.spriteCount;c++){var d=new PIXI.AnimatedSprite(n.defaultTileTextures,!0);d.visible=!1,null!=n.bgcolorOpacity&&(d.alpha=n.bgcolorOpacity),n.display.addChild(d),n.sprites.push(d)}n.tilecosts=[],i.loadTilesets(n.tilesetNames,function(s){n.tilesets=[];for(var o=0,r=n.tilesetNames;o<r.length;o++){var a=r[o];n.tilesets.push(i._tilesets[a])}for(var l=0;l<n.cells.length;l++){var h=0,p=n.cells[l];if(null!=p.cost)h=p.cost;else for(var c=0;c<p.ids.length;c+=2){var d=p.ids[c],f=p.ids[c+1];if(d>=0&&f>=0){var m=n.tilesets[d].tiles[f];if(null!=m.cost){h=m.cost;break}}}n.tilecosts.push(h)}i._tilemaps[t]=n,i._gamemaps[t]=new u(n),e&&e(n)})}):e&&e(null)}},t.prototype.updateTilemapView=function(t){var e=t.components.stage,i=e?e.tilemap:null;if(null!=i&&null!=i){var n=e.x%i.tileWidth,s=e.y%i.tileHeight,o=Math.round((e.x-n)/i.tileWidth),r=Math.round((e.y-s)/i.tileHeight),a=o*i.tileWidth,l=r*i.tileHeight,u=e.x+i.viewWidth,h=e.y+i.viewHeight;u>i.width&&(u=i.width),h>i.height&&(h=i.height);for(var p=0,c=r,d=o;l<h;){d=o;for(var f=a;f<u;){var m=c*i.columnCount+d;if(m>=0&&m<i.cells.length)for(var g=i.cells[m],y=i.tileWidth*d-e.x,v=i.tileHeight*c-e.y,_=0;_<g.ids.length;_+=2){(P=i.sprites[p++]).x=y,P.y=v;var b=g.ids[_],x=g.ids[_+1];if(b>=0&&x>=0){var S=i.tilesets[b].tiles[x];if((T=P.textures!==S.textures)&&(P.gotoAndStop(0),P.textures=S.textures,P.texture=P.textures[0],P.alpha=1),P.textures.length>1){var w=S.speed&&S.speed>0?S.speed:1;P.animationSpeed!=w&&(P.animationSpeed=w)}T?P.textures.length>1&&!t.paused&&P.gotoAndPlay(0):P.textures.length>1&&P.playing===t.paused&&(P.playing?P.stop():P.play())}else{var T;(T=P.textures!==i.defaultTileTextures)&&(P.gotoAndStop(0),P.textures=i.defaultTileTextures,P.texture=P.textures[0],P.alpha=i.bgcolorOpacity)}0==P.visible&&(P.visible=!0)}f+=i.tileWidth,d++}l+=i.tileHeight,c++}for(var j=p;j<i.sprites.length;j++){var P;if(!(P=i.sprites[j]).visible)break;P.visible=!1}}},t}();e.Stage=n;var s=function(){return function(){this.idx=-1,this.col=-1,this.row=-1,this.prior=null}}();e.StepNode=s;var o=function(){return function(){this.idx=-1,this.dist=-1,this.step=null,this.next=null}}();e.ResultNode=o;var r=function(){function t(t){this.tilemap=null,this.eight=!1,this.steps=null,this.footprints=null,this.openQueue=null,this.closedQueue=null,this.travelCosts=null,this.tilemap=t,this.travelCosts=new Array(t.tilecosts.length)}return t.prototype.clear=function(){this.steps=[],this.footprints=[],this.openQueue=null,this.closedQueue=null,this.travelCosts.fill(0)},t.prototype.dist=function(t,e,i,n){return Math.abs(i-t)+Math.abs(n-e)},t.prototype.add=function(t){if(t){for(var e=null,i=this.openQueue;null!=i&&t.idx+t.dist>i.idx+i.dist;)e=i,i=i.next;e?e.next=t:this.openQueue=t,t.next=i}},t.prototype.archive=function(t){if(t){for(var e=null,i=this.closedQueue;null!=i;){if(!(t.dist==i.dist?t.idx>i.idx:t.dist>i.dist))break;e=i,i=i.next}e?e.next=t:this.closedQueue=t,t.next=i}},t.prototype.pop=function(){var t=this.openQueue;return this.openQueue&&(this.openQueue=this.openQueue.next),t&&(t.next=null),t},t.prototype.createStep=function(t,e,i){var n=new s;return n.idx=t?t.idx+1:1,n.col=e,n.row=i,n.prior=t,this.steps.push(n),n},t.prototype.createFootprint=function(t,e){var i=new o;return i.idx=t?t.idx:0,i.step=t,i.dist=e,i.next=null,this.footprints.push(i),i},t.prototype.test=function(t,e,i,n,s,o){if(t<0||e<0||t>=this.tilemap.columnCount||e>=this.tilemap.rowCount)return!1;var r=this.tilemap.columnCount*e+t;if((o?o(t,e,this.tilemap.tilecosts[r]):this.tilemap.tilecosts[r])<0)return!1;var a=1;if(s&&(a=s.idx+1),this.travelCosts[r]>0&&a>=this.travelCosts[r])return!1;this.travelCosts[r]=a;var l=this.createStep(s,t,e),u=this.createFootprint(l,this.dist(t,e,i,n));return this.add(u),!0},t.prototype.getFootprint=function(t,e,i,n,s){if(!this.test(t,e,i,n,null,function(t,e,i){return 0}))return null;for(var o=this.pop();o;){var r=o.step;if(r){var a=r.col,l=r.row;if(a==i&&l==n){this.archive(o);break}var u=this.test(a,l-1,i,n,r,s),h=this.test(a+1,l,i,n,r,s),p=this.test(a,l+1,i,n,r,s),c=this.test(a-1,l,i,n,r,s),d=u&&h&&p&&c;if(this.eight){var f=!1,m=!1,g=!1,y=!1;(u||h)&&(f=this.test(a+1,l-1,i,n,r,s)),(p||h)&&(m=this.test(a+1,l+1,i,n,r,s)),(p||c)&&(g=this.test(a-1,l+1,i,n,r,s)),(u||c)&&(y=this.test(a-1,l-1,i,n,r,s));var v=!d;v||!u&&!h||(v=v||!f),v||!p&&!h||(v=v||!m),v||!p&&!c||(v=v||!g),v||!u&&!c||(v=v||!y),v&&this.archive(o)}else d||this.archive(o)}o=this.pop()}return this.closedQueue},t.prototype.find=function(t,e,i,n,s,o){void 0===s&&(s=!0),this.clear();for(var r=this.getFootprint(t,e,i,n,o),a=r?r.step:null,l=a?new Array(a.idx):null,u=a?a.idx:-1;a;)--u>=0&&(l[u]={x:a.col,y:a.row}),a=a.prior;return!s&&l&&l.length>0&&l.shift(),l},t}();e.PathFinder=r;var a=function(){return function(){this.mp=-1,this.col=-1,this.row=-1,this.next=null}}();e.VisitNode=a;var l=function(){function t(t){this.tilemap=null,this.nodes=null,this.current=null,this.next=null,this.history=null,this.tilemap=t,this.history=new Array(t.tilecosts.length)}return t.prototype.clear=function(){this.nodes=[],this.current=null,this.next=null,this.history.fill(-1)},t.prototype.add=function(t,e,i){var n=new a;return n.mp=i,n.col=t,n.row=e,n.next=this.next,this.next=n,this.next},t.prototype.test=function(t,e,i,n){if(t<0||e<0||t>=this.tilemap.columnCount||e>=this.tilemap.rowCount)return!1;var s=this.tilemap.columnCount*e+t,o=n?n(t,e,this.tilemap.tilecosts[s]):this.tilemap.tilecosts[s];if(o<0||o>i)return!1;var r=i-o;return!(this.history[s]>=r)&&(this.history[s]=r,this.add(t,e,r),!0)},t.prototype.travel=function(t,e,i,n){if(this.test(t,e,i,function(t,e,i){return 0}))for(;this.next;)for(this.current=this.next,this.next=null;this.current;){var s=this.current.col,o=this.current.row,r=this.current.mp;this.test(s,o-1,r,n),this.test(s+1,o,r,n),this.test(s,o+1,r,n),this.test(s-1,o,r,n),this.current=this.current.next}},t.prototype.find=function(t,e,i,n,s){void 0===n&&(n=!0),this.clear(),this.travel(t,e,i,s);for(var o=new Array,r=0;r<this.tilemap.columnCount;r++)for(var a=0;a<this.tilemap.rowCount;a++)(n||r!=t||a!=e)&&this.history[this.tilemap.columnCount*a+r]>=0&&o.push({x:r,y:a});return o},t}();e.RangeFinder=l;var u=function(){function t(t){this.tilemap=null,this.pathFinder=null,this.rangeFinder=null,this.tilemap=t,this.pathFinder=new r(t),this.rangeFinder=new l(t)}return t.prototype.pixelToTile=function(t,e){return this.tilemap?{x:Math.floor(t/this.tilemap.tileWidth),y:Math.floor(e/this.tilemap.tileHeight)}:null},t.prototype.tileToPixel=function(t,e){return this.tilemap?{x:t*this.tilemap.tileWidth+Math.floor(this.tilemap.tileWidth/2),y:e*this.tilemap.tileHeight+Math.floor(this.tilemap.tileHeight/2)}:null},t.prototype.align=function(t,e){var i=this.pixelToTile(t,e);return i?this.tileToPixel(i.x,i.y):null},t.prototype.findPath=function(t,e,i,n,s,o){return void 0===s&&(s=!0),this.pathFinder.find(t,e,i,n,s,o)},t.prototype.findRange=function(t,e,i,n,s){return void 0===n&&(n=!0),this.rangeFinder.find(t,e,i,n,s)},t.prototype.getTileCost=function(t,e){if(this.tilemap){var i=t>=0&&e>=0?this.tilemap.columnCount*e+t:-1;return i>=0&&i<this.tilemap.tilecosts.length?this.tilemap.tilecosts[i]:void 0}},t}();e.GameMap=u}),System.registerDynamic("oge2d/system/tween.js",[],!0,function(t,e,i){"use strict";this||self;Object.defineProperty(e,"__esModule",{value:!0}),e.Tween=void 0;var n=function(){function t(){this.name="tween",this._game=null,this._ticker=null}return t.prototype.init=function(t){return this._game=t,t.components.display&&(this._ticker=t.components.display.ticker),!0},t.prototype.activate=function(t){createjs.Tween.removeAllTweens()},t.prototype.deactivate=function(t){createjs.Tween.removeAllTweens()},t.prototype.update=function(t,e){var i=createjs.Ticker;i?i.paused!=t.paused&&(i.paused=t.paused):createjs.Tween.tick(this._ticker?this._ticker.deltaTime:1,t.paused)},t.prototype.get=function(t,e,i){return void 0===e&&(e=void 0),void 0===i&&(i=!0),createjs.Tween.get(t,e,void 0,i)},t.prototype.blink=function(t,e,i){createjs.Tween.get(t,{loop:!0}).to({alpha:1}).wait(50).to({alpha:0}).wait(50),!isNaN(e)&&e>0&&this._game.scene.timeout(e,function(t){createjs.Tween.removeTweens(t),t.alpha=1,i&&i(t)},t)},t.prototype.clear=function(t){t?createjs.Tween.removeTweens(t):createjs.Tween.removeAllTweens()},t.prototype.moveTo=function(t,e,i,n){var s=Math.sqrt((t.x-e)*(t.x-e)+(t.y-i)*(t.y-i))/(n<=0?1:n)*1e3;return createjs.Tween.get(t,{override:!0}).to({x:e,y:i},s)},t}();e.Tween=n}),System.registerDynamic("oge2d/system/transition.js",[],!0,function(t,e,i){"use strict";this||self;Object.defineProperty(e,"__esModule",{value:!0}),e.Transition=void 0;var n=function(){function t(){this.name="transition",this._game=null,this._stage=null,this._dark=null,this._target=""}return t.prototype.init=function(t){this._game=t,this._stage=t.components.display.object;var e=document.createElement("canvas");e.width=e.height=1;var i=e.getContext("2d");i.fillStyle="rgba(0, 0, 0, 1)",i.fillRect(0,0,1,1),this._dark=new PIXI.Sprite(PIXI.Texture.from(e)),this._dark.scale.set(t.width,t.height);var n=t.components.display.layers,s=n?Object.keys(n):[];return s.length>0&&(this._dark.parentGroup=new PIXI.display.Group(s.length+1,!1),this._stage.addChild(new PIXI.display.Layer(this._dark.parentGroup))),!0},t.prototype.isWorking=function(){return this._target&&this._target.length>0},t.prototype.callScene=function(t,e,i){var n=this,s=i?i/2:1e3;if(!(this._target&&this._target.length>0)){var o=this._game.scene.systems.tween;o&&t&&this._game.scene.name!=t&&(this._target=t,this._dark.alpha=0,this._stage.addChild(this._dark),o.get(this._dark).to({alpha:1},s).call(function(){n._target&&n._target==t&&n._game.loadScene(t,function(t){if(t){e&&e(t),n._stage.removeChild(n._dark),n._game.scene=t;var i=n._game.scene.systems.tween;i&&(n._dark.alpha=1,n._stage.addChild(n._dark),i.get(n._dark).to({alpha:0},s).call(function(){n._stage.removeChild(n._dark)}))}n._target=""})}))}},t}();e.Transition=n}),System.registerDynamic("oge2d/system/motion.js",[],!0,function(t,e,i){"use strict";this||self;Object.defineProperty(e,"__esModule",{value:!0}),e.Motion=void 0;var n=function(){function t(){this.name="motion",this._game=null,this._event=null}return t.prototype.init=function(t){return this._game=t,this._event=t.systems.event,!0},t.prototype.update=function(t,e){if(!t.paused)for(var i=t.spriteList,n=0;n<=i.length;n++){var s=n==i.length?t:i[n],o=n==i.length||s.active?s.components.motion:null;if(null!=o&&null!=o&&0!=o.state){if(1==o.state&&o.speed>0){if(null==(h=this.getTargetPos(s))||null==h)continue;if(0==o.style){var r=h.x,a=h.y,l=[],u=[];this.generateBeeline(r,a,o.targetX,o.targetY,l,u),o.dataX=l,o.dataY=u,l.length>0?o.state=2:o.state=0,2==o.state&&(o.current=0)}else o.state=0}if(2==o.state&&o.speed>0){var h;if(null==(h=this.getTargetPos(s))||null==h)continue;l=o.dataX,u=o.dataY;var p=o.current;p<l.length?(h.x=l[p],h.y=u[p],o.onStep&&o.onStep(s,p,l.length),o.current+=o.speed):(h.x=l[l.length-1],h.y=u[u.length-1],o.state=3)}if(3==o.state){o.state=0;var c=o.onEnd;c?c(s):this._event&&this._event.addEvent(s,"onMotionDone"),0==o.state&&(o.callback=null)}}}},t.prototype.createMotionData=function(){return{state:0,style:0,speed:0,current:0,segment:0,middleX:0,middleY:0,targetX:0,targetY:0,dataX:[],dataY:[],onStep:null,onEnd:null}},t.prototype.createPathData=function(){return{state:0,speed:0,current:0,offsetX:0,offsetY:0,listX:[],listY:[],nodes:[]}},t.prototype.getTargetPos=function(t){var e=t.components.stage;return e||((e=t.components.display)?e.object:null)},t.prototype.moveTo=function(t,e,i,n,s,o){var r=this.getTargetPos(t);if(null!=r&&null!=r&&(r.x!=e||r.y!=i))return this.pathTo(t,e,i,n,null,null,s,o);s&&s(t)},t.prototype.pathTo=function(t,e,i,n,s,o,r,a){var l=t.components.motion;null!=l&&null!=l||(l=this.createMotionData()),l.targetX=e,l.targetY=i,l.speed=n,l.state=1,l.onStep=a,l.onEnd=r,s&&(l.dataX=s),o&&(l.dataY=o),s&&(l.state=s.length>0?2:0,2==l.state&&(l.current=0)),t.components.motion=l},t.prototype.moveToNode=function(t,e,i,n){var s=this,o=t.components.path;if(o){if(o.state<=0||2*e>=o.nodes.length)return o.state=0,void(i&&i(t));var r=o.nodes[2*e]+o.offsetX,a=o.nodes[2*e+1]+o.offsetY;n&&n(t,e-1,r,a),this.pathTo(t,r,a,o.speed,o.listX[e],o.listY[e],function(t){s.moveToNode(t,e+1,i,n)})}else i&&i(t)},t.prototype.applyPath=function(t,e,i,n,s,o,r){var a=t.components.path;if(null!=a&&null!=a||(a=this.createPathData()),t.components.path=a,a.state=0,a.offsetX=e,a.offsetY=i,!(null==s||s.length<=1)){var l=s;if(n<0){l=[];for(var u=0,h=s.length;u<h;)l[u]=s[h-u-2],l[u+1]=s[h-u-1],u+=2}a.nodes=l,a.speed=n>0?n:0-n;var p=this.getTargetPos(t);if(null!=p&&null!=p)if(p.x=e+l[0],p.y=i+l[1],l.length<=2)o&&o(t);else{var c=e+l[0],d=i+l[1],f=Math.floor(l.length/2),m=new Array,g=new Array;m.push([]),g.push([]);for(var y=1;y<f;y++){var v=new Array,_=new Array;this.generateBeeline(c,d,e+l[2*y],i+l[2*y+1],v,_),m.push(v),g.push(_),c=e+l[2*y],d=i+l[2*y+1]}a.listX=m,a.listY=g,a.state=1,this.moveToNode(t,1,o,r)}}},t.prototype.getMotionAngle=function(t,e,i,n){var s=Math.abs(i-t),o=Math.abs(n-e),r=0==s?90:180*Math.atan(o/s)/Math.PI;return i<=t&&n<=e?r=180-r:i<=t&&n>=e?r=180+r:i>=t&&n>=e&&(r=0-r),r<0&&(r+=360),r>360&&(r-=360),r},t.prototype.moveOutside=function(t,e,i,n,s,o,r,a,l){var u=this.getTargetPos(t);if(null!=u&&null!=u){var h=u.x,p=u.y,c=0,d=0;i>=0&&i<=45||i>315&&i<=360?(c=o,d=p-Math.abs(c-h)*Math.tan(i*Math.PI/180)):i>45&&i<=135?(d=s,c=h+Math.abs(p-d)/Math.tan(i*Math.PI/180)):i>135&&i<=225?(c=n,d=p+Math.abs(c-h)*Math.tan(i*Math.PI/180)):i>225&&i<=315&&(d=r,c=h-Math.abs(p-d)/Math.tan(i*Math.PI/180)),this.moveTo(t,c,d,e,a,l)}},t.prototype.generateBeeline=function(t,e,i,n,s,o){Math.floor(Math.max(Math.min(t,i),0)),Math.floor(Math.max(Math.min(e,n),0));var r,a,l,u,h,p,c,d,f=Math.floor(Math.abs(i-t)),m=Math.floor(Math.abs(n-e));f>=m?(a=f+1,r=2*m-f,l=2*m,u=2*(m-f),h=1,p=1,c=0,d=1):(a=m+1,r=2*f-m,l=2*f,u=2*(f-m),h=0,p=1,c=1,d=1),t>i&&(h=0-h,p=0-p),e>n&&(c=0-c,d=0-d);var g=Math.floor(t)+(r<0?h:p),y=Math.floor(e)+(r<0?c:d);r+=r<0?l:u;for(var v=2;v<a-1;v++)r<0?(r+=l,g+=h,y+=c):(r+=u,g+=p,y+=d),s.push(g),o.push(y);t==i&&e==n||(s.push(i),o.push(n))},t}();e.Motion=n}),System.registerDynamic("oge2d/system/collision.js",[],!0,function(t,e,i){"use strict";this||self;Object.defineProperty(e,"__esModule",{value:!0}),e.Collision=void 0;var n=function(){function t(){this.name="collision",this._game=null,this._event=null,this.onCollision=null}return t.prototype.init=function(t){return this._game=t,this._event=t.systems.event,!0},t.prototype.update=function(t,e){if(!t.paused){for(var i=[],n=[],s=0,o=t.spriteList;s<o.length;s++){var r=o[s];if(r.active&&r.components.collision&&!0===r.components.collision.enabled&&r.components.display&&r.components.display.object){i.push(r);var a=r.components.display.object.getBounds(!1),l=r.components.collision.hitbox;if(l){var u=r.components.display.object.anchor;n.push({x:a.x+a.width*u.x+l.x,y:a.y+a.height*u.y+l.y,width:l.width,height:l.height})}else n.push(a)}}for(var h=0;h<i.length;h++)for(var p=h+1;p<i.length;p++)this.hitTestRect(n[h],n[p])&&(this.onCollision?this.onCollision(i[h],i[p]):this._event&&(this._event.addEvent(i[h],"onCollision",i[p]),this._event.addEvent(i[p],"onCollision",i[h])))}},t.prototype.hitTestRect=function(t,e){var i=t.width/2,n=t.height/2,s=e.width/2,o=e.height/2,r=t.x+i-(e.x+s),a=t.y+n-(e.y+o),l=i+s,u=n+o;return Math.abs(r)<l&&Math.abs(a)<u},t}();e.Collision=n}),System.registerDynamic("oge2d/system/mouse.js",[],!0,function(t,e,i){"use strict";this||self;Object.defineProperty(e,"__esModule",{value:!0}),e.MouseContext=e.Mouse=void 0;var n=function(){function t(){this.name="mouse",this._game=null,this._stage=null,this._interaction=null,this._sceneMouseContexts=new Map,this._sceneSpriteMouseContexts=new Map}return t.prototype.getSceneMouseContext=function(t,e){var i=t.name+"-"+e,n=this._sceneMouseContexts.get(i);return null!=n&&null!=n||(this._sceneMouseContexts.set(i,new s),(n=this._sceneMouseContexts.get(i)).emit=n.emit.bind(n)),n.target=t,n.event=e,n},t.prototype.getSceneSpriteMouseContext=function(t,e,i){var n=t.scene.name+"-"+t.name+"-"+e,o=this._sceneSpriteMouseContexts.get(n);return null!=o&&null!=o||(this._sceneSpriteMouseContexts.set(n,new s),(o=this._sceneSpriteMouseContexts.get(n)).emit=o.emit.bind(o)),o.target=t,o.event=e,o.shareable=i,o},t.prototype.init=function(t){var e=this;this._game=t,this._stage=t.components.display.object,this._interaction=t.components.display.plugins.interaction;navigator.userAgent.indexOf("Mobile")>=0&&(navigator.userAgent.indexOf("iPad")>=0||navigator.userAgent.indexOf("iPhone"));return!0,this._game.libraries.audio&&(window.addEventListener("touchend",function(){0==e._game.libraries.audio.isPlayingDummy&&e._game.libraries.audio.playDummy()}),window.addEventListener("mousedown",function(){0==e._game.libraries.audio.isPlayingDummy&&e._game.libraries.audio.playDummy()})),!0},t.prototype.preset=function(t,e){var i=t.components.display,n=t.components.mouse;if(n&&i&&i.object){var s=i?i.object:null;i&&i.bgcontainer&&(s=i.bgcontainer),s&&n.enabled&&(s.hitArea=new PIXI.Rectangle(0,0,this._game.components.display.width,this._game.components.display.height))}e&&e()},t.prototype.prepare=function(t,e){if(t&&t.components.mouse){t.active?this.enable(t):this.disable(t);var i=t.components.mouse.hitbox;if(i){var n=t.components.display;n&&n.object&&(n.object.hitArea=new PIXI.Rectangle(i.x,i.y,i.width,i.height))}}e&&e()},t.prototype.setup=function(t){},t.prototype.activate=function(t){var e=t.components.display,i=t.components.mouse,n=e?e.object:null;if(e&&e.bgcontainer&&(n=e.bgcontainer),i&&e&&e.object&&n)if(i.enabled){if(n.interactive=!0,i.actions&&i.actions.length>0)for(var s=0,o=i.actions;s<o.length;s++){var r=o[s],a=r.toString();if(a.length>0){a="on"+a.charAt(0).toUpperCase()+a.substr(1);var l=this.getSceneMouseContext(t,a);!1===l.active&&(n.on(r,l.emit),l.active=!0)}}}else n.interactive=!1},t.prototype.deactivate=function(t){var e=t.components.display,i=t.components.mouse,n=e?e.object:null;if(e&&e.bgcontainer&&(n=e.bgcontainer),i&&e&&e.object&&n&&(n.interactive=!1,i.actions&&i.actions.length>0))for(var s=0,o=i.actions;s<o.length;s++){var r=o[s],a=r.toString();if(a.length>0){a="on"+a.charAt(0).toUpperCase()+a.substr(1);var l=this.getSceneMouseContext(t,a);!0===l.active&&(n.off(r,l.emit),l.active=!1)}}},t.prototype.include=function(t){this.enable(t)},t.prototype.exclude=function(t){this.disable(t)},t.prototype.enable=function(t){var e=t.components.display,i=t.components.mouse,n=e?e.object:null;if(i&&e&&e.object&&n)if(i.enabled){if(n.interactive=!0,i.actions&&i.actions.length>0)for(var s=0,o=i.actions;s<o.length;s++){var r=o[s],a=r.toString();if(a.length>0){a="on"+a.charAt(0).toUpperCase()+a.substr(1);var l=this.getSceneSpriteMouseContext(t,a,!0===i.shareable);!1===l.active&&(n.on(r,l.emit),l.active=!0)}}}else n.interactive=!1},t.prototype.disable=function(t){var e=t.components.display,i=t.components.mouse,n=e?e.object:null;if(i&&e&&e.object&&n&&(n.interactive=!1,i.actions&&i.actions.length>0))for(var s=0,o=i.actions;s<o.length;s++){var r=o[s],a=r.toString();if(a.length>0){a="on"+a.charAt(0).toUpperCase()+a.substr(1);var l=this.getSceneSpriteMouseContext(t,a,!0===i.shareable);!0===l.active&&(n.off(r,l.emit),l.active=!1)}}},t.prototype.update=function(t,e){},t.prototype.getPos=function(t){var e={x:this._interaction.mouse.global.x,y:this._interaction.mouse.global.y},i=this._game.scene,n=i&&i.components.display?i.components.display.object:null;t&&n&&(e=t.getLocalPosition(n));var s=i?i.systems.stage:null;return s&&s.transform&&(e=s.transform(e)),e},t}();e.Mouse=n;var s=function(){function t(){this.event="",this.target=null,this.active=!1,this.shareable=!1}return t.prototype.emit=function(t){if(t.stopped=0==this.shareable,this.target){var e=this.target.systems?this.target.systems.event:this.target.scene?this.target.scene.systems.event:null;e&&e.addEvent(this.target,this.event,t)}},t}();e.MouseContext=s}),System.registerDynamic("oge2d/system/keyboard.js",[],!0,function(t,e,i){"use strict";this||self;Object.defineProperty(e,"__esModule",{value:!0}),e.Keyboard=void 0;var n=function(){function t(){this.name="keyboard",this._game=null,this._event=null,this.states={},this.ticks={}}return t.prototype.init=function(t){var e=this;return this._game=t,document.body.addEventListener("keydown",function(t){e.states[t.key]=!0}),document.body.addEventListener("keyup",function(t){e.states[t.key]=!1,e._game.scene&&e._event&&e._event.addEvent(e._game.scene,"onKeyPress",t.key)}),!0},t.prototype.activate=function(t){this._event=t.systems.event,this.reset()},t.prototype.deactivate=function(t){this.reset()},t.prototype.update=function(t,e){},t.prototype.reset=function(){for(var t=0,e=Object.keys(this.states);t<e.length;t++){var i=e[t];this.states[i]=!1,this.ticks[i]=0}},t}();e.Keyboard=n}),System.registerDynamic("oge2d/core/sprite.js",[],!0,function(t,e,i){"use strict";this||self;var n=e&&e.__spreadArrays||function(){for(var t=0,e=0,i=arguments.length;e<i;e++)t+=arguments[e].length;var n=Array(t),s=0;for(e=0;e<i;e++)for(var o=arguments[e],r=0,a=o.length;r<a;r++,s++)n[s]=o[r];return n};Object.defineProperty(e,"__esModule",{value:!0}),e.Plot=e.Sprite=void 0;var s=function(){function t(t,e){this.name="",this.game=null,this.scene=null,this.origin=null,this.script=null,this.code=null,this.base=null,this.plot=null,this.template="",this.components={},this._active=!1,this.game=t.game,this.scene=t,this.name=e}return Object.defineProperty(t.prototype,"active",{get:function(){return this._active},set:function(t){if(t!=this._active){var e=this.scene.systemList;if(this._active=t,this._active){for(var i=0,n=e;i<n.length;i++){(r=n[i]).enable&&r.enable(this)}(a=this.scene.systems.event)&&a.callEvent(this,"onActivate")}else{for(var s=0,o=e;s<o.length;s++){var r;(r=o[s]).disable&&r.disable(this)}var a;(a=this.scene.systems.event)&&a.callEvent(this,"onDeactivate")}}},enumerable:!1,configurable:!0}),t.prototype.get=function(t){return this.components[t]},t.prototype.call=function(t){for(var e,i=[],s=1;s<arguments.length;s++)i[s-1]=arguments[s];if(this.script&&this.script.helper)return this.script.helper.caller=this.name,(e=this.script.helper).call.apply(e,n([this.script,t],i))},t}();e.Sprite=s;var o=function(){function t(t,e){this.done=!1,this._spr=null,this._gen=null,this._wait=[],this._func=null,this._spr=t,this._func=e,this.reset()}return Object.defineProperty(t.prototype,"available",{get:function(){return null!=this._gen&&null!=this._gen},enumerable:!1,configurable:!0}),t.prototype.reset=function(){this._gen=this._func?this._func(this._spr):null,this.done=!1,this._wait=[]},t.prototype.pause=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(t){for(var i=0,n=0,s=t;n<s.length;n++){var o=s[n];this._wait.indexOf(o)<0&&(this._wait.push(o),i++)}return i}return 0},t.prototype.resume=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(t){for(var i=0,n=0,s=t;n<s.length;n++){var o=s[n],r=this._wait.indexOf(o);r>=0&&(this._wait.splice(r,1),i++)}return i}return 0},t.prototype.wait=function(t){var e=this;return null==t?this.pause("::::"):"string"==typeof t?this.pause(t):t<=0?void 0:(this._spr.scene.timeout(t,function(){return e.resume("::timer::")}),this.pause("::timer::"))},t.prototype.signal=function(t){return t?this.resume(t):this.resume("::::")},t.prototype.next=function(){if(this._wait.length>0)return null;var t=this._gen?this._gen.next():null;return t?(this.done=t.done,t.value):null},t}();e.Plot=o}),System.registerDynamic("oge2d/system/event-loop.js",["../core/sprite"],!0,function(t,e,i){"use strict";this||self;Object.defineProperty(e,"__esModule",{value:!0}),e.EventLoop=void 0;var n=t("../core/sprite"),s=function(){function t(){this.name="event",this._game=null}return t.prototype.init=function(t){var e=t.components.event;return e&&(e.queue=[]),this._game=t,!0},t.prototype.preset=function(t,e){var i=t.components.event;i&&(i.queue=[]),e&&e()},t.prototype.prepare=function(t,e){e&&e()},t.prototype.setup=function(t){},t.prototype.activate=function(t){var e=t.components.event;e&&(e.queue=[])},t.prototype.deactivate=function(t){var e=t.components.event;e&&(e.queue=[])},t.prototype.include=function(t){var e=t.components.event;e&&(null==e.queue||null==e.queue?e.queue=[]:e.queue.length>0&&(e.queue=[]))},t.prototype.exclude=function(t){var e=t.components.event;e&&(null==e.queue||null==e.queue?e.queue=[]:e.queue.length>0&&(e.queue=[]))},t.prototype.enable=function(t){var e=t.components.event;if(e&&(null==e.queue||null==e.queue?e.queue=[]:e.queue.length>0&&(e.queue=[])),null!=t.components.plot&&!0===t.components.plot&&t.active&&e)if(t.plot)t.plot.reset();else{var i=e.onUpdate;if("string"==(i?typeof i:null)&&t.script){var s=this.getScriptFunction(t.script,i);if(s){var o=s,r=o?new n.Plot(t,o):null;r&&r.available&&(t.plot=r)}}}},t.prototype.disable=function(t){var e=t.components.event;e&&(null==e.queue||null==e.queue?e.queue=[]:e.queue.length>0&&(e.queue=[]))},t.prototype.update=function(t,e){for(var i=0,n=t.spriteList;i<n.length;i++){var s=n[i],o=s.components.event;if(s.active&&o){if(o.queue&&o.queue.length>0)for(var r=0,a=o.queue;r<a.length;r++){if((p=a[r]).data&&"function"==typeof p.data)p.data(s);else"string"==(d=(c=o[p.name])?typeof c:null)&&s.script?this.callScript(s,s.script,c,p.data):"function"==d&&c(s,p.data)}if(o)if(s.plot)0==s.plot.done&&s.plot.next();else"string"==(d=(c=o.onUpdate)?typeof c:null)&&s.script?this.callScript(s,s.script,c):"function"==d&&c(s)}o&&(null==o.queue||null==o.queue?o.queue=[]:o.queue.length>0&&(o.queue=[]))}var l=t.components.event;if(l&&l.queue)for(var u=0,h=l.queue;u<h.length;u++){var p,c,d;if((p=h[u]).data&&"function"==typeof p.data)p.data(t);else"string"==(d=(c=l[p.name])?typeof c:null)?t.call(c,t,p.data):"function"==d&&c(t,p.data)}l&&("string"==(d=(c=l.onUpdate)?typeof c:null)?t.call(c,t):"function"==d&&c(t));l&&(null==l.queue||null==l.queue?l.queue=[]:l.queue.length>0&&(l.queue=[]))},t.prototype.addEvent=function(t,e,i){if(t&&t.components){var n=t.components.event;n&&(null!=n.queue&&null!=n.queue||(n.queue=[]),n.queue.push({name:e,data:i}))}},t.prototype.callEvent=function(t,e,i){if(t&&t.components){var n=t.components.event;if(n){var s=n[e],o=s?typeof s:null;"string"==o&&t.script?this.callScript(t,t.script,s,i):"function"==o&&s(t,i)}}},t.prototype.callScript=function(t,e,i,n){e&&(e[i]?e[i](t,n):this.callScript(t,e.base,i,n))},t.prototype.getScriptFunction=function(t,e){return t?t[e]?t[e]:this.getScriptFunction(t.base,e):null},t}();e.EventLoop=s}),System.registerDynamic("oge2d/library/json.js",["./loader"],!0,function(t,e,i){"use strict";this||self;Object.defineProperty(e,"__esModule",{value:!0}),e.Json=void 0;var n=t("./loader"),s=function(){function t(){this.name="json",this._objectsToLoad=0,this._loadedObjects=[],this._loadingObjectUrls=[],this._texts=new Map}return t.prototype.loadString=function(t,e){var i=this,s=this._texts.get(t);null==s||null==s?n.Loader.loadText(t,function(n){i._texts.get(t)||(null!=n&&null!=n?(n.length>0&&i._texts.set(t,n),e(n)):e(""))}):e(s)},t.prototype.loadJsons=function(t,e,i){var n;this._loadedObjects=[],this._loadingObjectUrls=[],(n=this._loadingObjectUrls).push.apply(n,t),this._objectsToLoad=this._loadingObjectUrls.length,this.loadJsonsOneByOne(e,i)},t.prototype.loadJsonsOneByOne=function(t,e){var i=this;if(this._loadingObjectUrls.length<=0){var n=[];n.push.apply(n,this._loadedObjects),this._loadedObjects=[],t(n)}else{var s=this._loadingObjectUrls.shift();this.loadJson(s,function(n){e&&e(i._objectsToLoad-i._loadingObjectUrls.length,i._objectsToLoad),n&&i._loadedObjects.push(n),i.loadJsonsOneByOne(t,e)})}},t.prototype.loadJson=function(t,e){this.loadString(t,function(i){var n=null;if(null!=i&&null!=i&&i.length>0)try{n=JSON.parse(i)}catch(e){n=null,console.error("Failed to parse json string from "+t),console.error(e)}null==n&&(n=null),e(n)})},t.prototype.getJson=function(t){var e=null,i=this._texts.get(t);if(null!=i&&null!=i&&i.length>0){try{e=JSON.parse(i)}catch(i){e=null,console.error("Failed to parse json string from "+t),console.error(i)}null==e&&(e=null)}return e},t}();e.Json=s}),System.registerDynamic("oge2d/library/audio.js",["./loader"],!0,function(t,e,i){"use strict";this||self;Object.defineProperty(e,"__esModule",{value:!0}),e.Sound=e.Music=e.Audio=void 0;var n=t("./loader"),s=function(){function t(){this.name="audio",this._context=null,this._isPlayingDummy=!1,this._dummyAudioSource=null,this._dummyAudioBuffer=null,this._dummyGain=null,this._musicsToLoad=0,this._loadedMusics=[],this._loadingMusicUrls=[],this._soundsToLoad=0,this._loadedSounds=[],this._loadingSoundUrls=[],this.musics={},this.sounds={};var t=window;if(t.Oge2dGlobal&&t.Oge2dGlobal.audioContext&&(this._context=t.Oge2dGlobal.audioContext),null==this._context||null==this._context){var e=t.AudioContext||t.webkitAudioContext||t.mozAudioContext||t.oAudioContext||t.msAudioContext;e&&(this._context=new e)}null!=this._context&&null!=this._context||console.error("No Web Audio API Supported")}return t.setGainValue=function(t,e,i){t.setValueAtTime&&i?t.setValueAtTime(e,i.currentTime):t.value=e},t.prototype.playDummy=function(){this._isPlayingDummy=!0,null==this._dummyAudioSource&&(this._dummyAudioBuffer=this._context.createBuffer(2,1,this._context.sampleRate),this._dummyAudioSource=this._context.createBufferSource(),this._dummyAudioSource.buffer=this._dummyAudioBuffer,this._dummyGain=this._context.createGain(),this._dummyAudioSource.connect(this._dummyGain),this._dummyGain.connect(this._context.destination),t.setGainValue(this._dummyGain.gain,0,this._context),this._dummyAudioSource&&this._dummyAudioSource.start())},t.prototype.stopDummy=function(){this._dummyAudioSource&&(this._dummyAudioSource.stop(),this._dummyAudioSource.disconnect(),this._dummyGain.disconnect(),this._dummyAudioBuffer=null,this._dummyAudioSource=null,this._dummyGain=null),this._isPlayingDummy=!1},Object.defineProperty(t.prototype,"isPlayingDummy",{get:function(){return this._isPlayingDummy},enumerable:!1,configurable:!0}),t.prototype.getNameFromUrl=function(t){var e="",i=t.lastIndexOf("/"),n=t.lastIndexOf(".");return n>i&&n>0&&(i<0&&(i=-1),e=t.substring(i+1,n)),e},t.prototype.loadMusics=function(t,e,i){var n;this._context&&t&&t.length>0?(this._loadedMusics=[],this._loadingMusicUrls=[],(n=this._loadingMusicUrls).push.apply(n,t),this._musicsToLoad=this._loadingMusicUrls.length,this.loadMusicsOneByOne(e,i)):e([])},t.prototype.loadMusicsOneByOne=function(t,e){var i=this;if(this._loadingMusicUrls.length<=0){var n=[];n.push.apply(n,this._loadedMusics),this._loadedMusics=[],t(n)}else{var s=this._loadingMusicUrls.shift();this.loadMusic(s,function(n){e&&e(i._musicsToLoad-i._loadingMusicUrls.length,i._musicsToLoad),n&&i._loadedMusics.push(n),i.loadMusicsOneByOne(t,e)})}},t.prototype.loadMusic=function(t,e){var i=this;if(null!=this._context&&null!=this._context){var s=this.getNameFromUrl(t);if(s.length<=0)e(null);else{var r=this.musics[s];r?e(r):n.Loader.loadBuffer(t,function(t){if(!i.musics[s])if(t){var n=new o(i._context);n.loadBuffer(t,function(){if(n.isReady())return i.musics[s]=n,void e(n);e(null)})}else e(null)})}}else e(null)},t.prototype.loadSounds=function(t,e,i){var n;this._context&&t&&t.length>0?(this._loadedSounds=[],this._loadingSoundUrls=[],(n=this._loadingSoundUrls).push.apply(n,t),this._soundsToLoad=this._loadingSoundUrls.length,this.loadSoundsOneByOne(e,i)):e([])},t.prototype.loadSoundsOneByOne=function(t,e){var i=this;if(this._loadingSoundUrls.length<=0){var n=[];n.push.apply(n,this._loadedSounds),this._loadedSounds=[],t(n)}else{var s=this._loadingSoundUrls.shift();this.loadSound(s,function(n){e&&e(i._soundsToLoad-i._loadingSoundUrls.length,i._soundsToLoad),n&&i._loadedSounds.push(n),i.loadSoundsOneByOne(t,e)})}},t.prototype.loadSound=function(t,e){var i=this;if(null!=this._context&&null!=this._context){var s=this.getNameFromUrl(t);if(s.length<=0)e(null);else{var o=this.sounds[s];o?e(o):n.Loader.loadBuffer(t,function(t){if(!i.sounds[s])if(t){var n=new r(i._context);n.loadBuffer(t,function(){if(n.isReady())return i.sounds[s]=n,void e(n);e(null)})}else e(null)})}}else e(null)},t.STATE_UNPLAYABLE=0,t.STATE_READY=1,t.STATE_PLAYING=2,t.STATE_PAUSED=3,t.STATE_ENDED=4,t}();e.Audio=s;var o=function(){function t(t){this._context=null,this._state=0,this._volume=1,this._times=1,this._buffer=null,this._channel=null,this._gain=null,this._startTime=0,this._pauseTime=0,this._context=t,this._state=s.STATE_UNPLAYABLE}return t.prototype.isReady=function(){return this._state==s.STATE_READY},t.prototype.isCompleted=function(){return this._state==s.STATE_ENDED},t.prototype.isPlaying=function(){return this._state==s.STATE_PLAYING},t.prototype.isPaused=function(){return this._state==s.STATE_PAUSED},t.prototype.resume=function(){this._state==s.STATE_PAUSED&&this.play(this._times)},Object.defineProperty(t.prototype,"volume",{get:function(){return this._volume},set:function(t){var e=t<0?0:t>1?1:t;this._volume!=e&&(this._gain&&s.setGainValue(this._gain.gain,e,this._context),this._volume=e)},enumerable:!1,configurable:!0}),t.prototype.loadBuffer=function(t,e){var i=this;null!=this._context&&null!=this._context?this._context.decodeAudioData(t,function(t){i._buffer=t,i._buffer&&i._buffer.length>0&&(i._state=s.STATE_READY),e&&e()},function(){console.error("Failed to decode Web Audio Data"),e&&e()}):e&&e()},t.prototype.turnoff=function(){this._channel&&(this._channel.disconnect(),this._channel=null),this._gain&&(this._gain.disconnect(),this._gain=null)},t.prototype.turnon=function(){var t=this;null!=this._context&&null!=this._context&&null!=this._buffer&&null!=this._buffer&&(this.turnoff(),this._channel=this._context.createBufferSource(),null!=this._channel&&null!=this._channel&&(this._channel.buffer=this._buffer,this._channel.onended=function(){t._state==s.STATE_PLAYING&&(t._times>=0?(t._times>0&&t._times--,0==t._times?(t.turnoff(),t._state=s.STATE_ENDED):(t._pauseTime=0,t._startTime=t._context.currentTime,t.turnon())):(t._pauseTime=0,t._startTime=t._context.currentTime,t.turnon()))},this._gain=this._context.createGain(),null!=this._gain&&null!=this._gain&&(this._channel.connect(this._gain),this._gain.connect(this._context.destination),s.setGainValue(this._gain.gain,this._volume,this._context),this._pauseTime>0?(this._startTime=this._context.currentTime-this._pauseTime,this._channel.start(0,this._pauseTime)):(this._startTime=this._context.currentTime,this._channel.start(0)))))},t.prototype.play=function(t){null!=this._context&&null!=this._context&&null!=this._buffer&&null!=this._buffer&&this._state!=s.STATE_UNPLAYABLE&&this._state!=s.STATE_PLAYING&&(this._state!=s.STATE_READY&&this._state!=s.STATE_PAUSED&&this._state!=s.STATE_ENDED||(t?this._times=t<=0?-1:t:this._state==s.STATE_READY&&(this._times=-1),this._state=s.STATE_PLAYING,this.turnon()))},t.prototype.stop=function(){this._state!=s.STATE_UNPLAYABLE&&this._context&&this._channel&&(this._channel.stop(0),this.turnoff(),this._pauseTime=0,this._startTime=0,this._state=s.STATE_READY)},t.prototype.pause=function(){this._state==s.STATE_PLAYING&&this._context&&this._channel&&(this._pauseTime=this._context.currentTime-this._startTime,this._channel.stop(0),this.turnoff(),this._state=s.STATE_PAUSED)},t.prototype.reset=function(){this._state==s.STATE_ENDED?(this._pauseTime=0,this._startTime=0,this._state=s.STATE_READY):stop()},t.prototype.dispose=function(){stop(),this._state=s.STATE_UNPLAYABLE,this._buffer&&(this._buffer=null)},t}();e.Music=o;var r=function(){function t(t){this._context=null,this._state=0,this._volume=1,this._buffer=null,this._channels=[],this._gains=new Map,this._context=t,this._state=s.STATE_UNPLAYABLE}return t.prototype.isReady=function(){return this._state==s.STATE_READY},Object.defineProperty(t.prototype,"volume",{get:function(){return this._volume},set:function(t){var e=this,i=t<0?0:t>1?1:t;this._volume!=i&&(this._gains.forEach(function(t,n){return s.setGainValue(t.gain,i,e._context)}),this._volume=i)},enumerable:!1,configurable:!0}),t.prototype.loadBuffer=function(t,e){var i=this;null!=this._context&&null!=this._context?this._context.decodeAudioData(t,function(t){i._buffer=t,i._buffer&&i._buffer.length>0&&(i._state=s.STATE_READY),e&&e()},function(){console.error("Failed to decode Web Audio Data"),e&&e()}):e&&e()},t.prototype.turnoff=function(t){var e=null;t&&(e=this._gains.get(t),t.disconnect()),e&&e.disconnect(),t&&this._gains.delete(t)},t.prototype.turnon=function(){var t=this;if(null!=this._context&&null!=this._context&&null!=this._buffer&&null!=this._buffer){var e=this._context.createBufferSource();if(null!=e&&null!=e){e.buffer=this._buffer,e.onended=function(e){t.turnoff(e.target)};var i=this._context.createGain();null!=i&&null!=i&&(e.connect(i),i.connect(this._context.destination),s.setGainValue(i.gain,this._volume,this._context),this._gains.set(e,i),e.start(0))}}},t.prototype.play=function(){this._state!=s.STATE_UNPLAYABLE&&this._buffer&&this.turnon()},t.prototype.stop=function(){if(this._state!=s.STATE_UNPLAYABLE&&null!=this._buffer&&null!=this._buffer){var t=new Array;for(this._gains.forEach(function(e,i){return t.push(i)});t.length>0;){var e=t.pop();e&&(e.stop(0),this.turnoff(e))}}},t.prototype.dispose=function(){this.stop(),this._state=s.STATE_UNPLAYABLE,this._buffer&&(this._buffer=null),this._gains.clear(),this._channels=[]},t}();e.Sound=r}),System.registerDynamic("oge2d/library/texture.js",["./loader"],!0,function(t,e,i){"use strict";this||self;Object.defineProperty(e,"__esModule",{value:!0}),e.Texture=void 0;var n=t("./loader"),s=function(){function t(){this.name="image",this._images=new Map,this._baseimgs=new Map,this._h5images=new Map,this._imageArrays=[],this._textures=new Map,this._imagesToLoad=0,this._loadedImages=[],this._loadingImageUrls=[],this._loadingUrls=[],this._loadingAreas=[],this._loadedTextures=[],this._loadingSheetNames=[],this._loadedSheetUrls=new Map,this._loadedSheetAreas=new Map,this._loadedSheets=new Map,this._imageArrays=[this._images,this._baseimgs,this._h5images]}return t.prototype.loadSheets=function(t,e,i,n){var s=this;if(e.size==i.size){this._loadingSheetNames=[],this._loadedSheets.clear(),this._loadedSheetUrls.clear(),this._loadedSheetAreas.clear();for(var o=0,r=t;o<r.length;o++){var a=r[o];this._loadingSheetNames.push(a)}e.forEach(function(t,e){s._loadedSheetUrls.set(e,t)}),i.forEach(function(t,e){s._loadedSheetAreas.set(e,t)}),this.loadSheetsOneByOne(n)}else n(null)},t.prototype.loadSheetsOneByOne=function(t){var e=this;if(this._loadedSheetUrls.size==this._loadedSheetAreas.size){if(this._loadingSheetNames.length<=0){var i=new Map;return this._loadedSheets.forEach(function(t,e){i.set(e,t)}),this._loadedSheets.clear(),this._loadedSheetUrls.clear(),this._loadedSheetAreas.clear(),void t(i)}var n=this._loadingSheetNames.shift(),s=this._loadedSheetUrls.get(n),o=this._loadedSheetAreas.get(n);n&&s&&o?this.loadTextures(s,o,function(i){e._loadedSheets.set(n,i),e._loadedSheetUrls.delete(n),e._loadedSheetAreas.delete(n),e.loadSheetsOneByOne(t)}):t(null)}else t(null)},t.prototype.loadTextures=function(t,e,i){if(t.length==e.length){this._loadingUrls=[],this._loadingAreas=[],this._loadedTextures=[];for(var n=0,s=t;n<s.length;n++){var o=s[n];this._loadingUrls.push(o)}for(var r=0,a=e;r<a.length;r++){o=a[r];this._loadingAreas.push(o)}this.loadTexturesOneByOne(i)}else i([])},t.prototype.loadTexturesOneByOne=function(t){var e=this;if(this._loadingUrls.length==this._loadingAreas.length){if(this._loadingUrls.length<=0){for(var i=[],n=0,s=this._loadedTextures;n<s.length;n++){var o=s[n];i.push(o)}return this._loadedTextures=[],void t(i)}var r=this._loadingUrls.shift(),a=this._loadingAreas.shift();this.loadTexture(r,a,function(i){i&&e._loadedTextures.push(i),e.loadTexturesOneByOne(t)})}else t([])},t.prototype.getTexture=function(t,e){var i=e?t+","+e.x+","+e.y+","+e.width+","+e.height:t,n=this._textures.get(i);if(n)return n;var s=e?this._images.get(t):null;if(s&&e){var o=new PIXI.Texture(s,new PIXI.Rectangle(e.x,e.y,e.width,e.height));if(o&&this._textures.set(i,o),o)return o}return null},t.prototype.setTexture=function(t,e){if(null!=e&&null!=e){var i=this._textures.get(t);i&&i!=e&&i.destroy(!1),this._textures.set(t,e)}},t.prototype.loadTexture=function(t,e,i){var n=this,s=t+","+e.x+","+e.y+","+e.width+","+e.height,o=this._textures.get(s);null==o||null==o?this.loadImage(t,function(t){if(t){t.update();var o=new PIXI.Texture(t,new PIXI.Rectangle(e.x,e.y,e.width,e.height));o&&n._textures.set(s,o),i(o)}else i(null)}):i(o)},t.prototype.loadImages=function(t,e,i){var n;t&&t.length>0?(this._loadedImages=[],this._loadingImageUrls=[],(n=this._loadingImageUrls).push.apply(n,t),this._imagesToLoad=this._loadingImageUrls.length,this.loadImagesOneByOne(e,i)):e([])},t.prototype.loadImagesOneByOne=function(t,e){var i=this;if(this._loadingImageUrls.length<=0){var n=[];n.push.apply(n,this._loadedImages),this._loadedImages=[],t(n)}else{var s=this._loadingImageUrls.shift();this.loadImage(s,function(n){e&&e(i._imagesToLoad-i._loadingImageUrls.length,i._imagesToLoad),n&&i._loadedImages.push(n),i.loadImagesOneByOne(t,e)})}},t.prototype.loadImage=function(e,i){this.loadImageByType(e,t.IMG_TYPE_TEX,i)},t.prototype.loadImageByType=function(e,i,s){var o=this;if(i<t.IMG_TYPE_TEX||i>t.IMG_TYPE_HTML)s(null);else{var r=this._imageArrays[i],a=r.get(e);if(null==a||null==a){var l="",u=e.lastIndexOf(".");u>0&&(l=e.substring(u+1)),l.length<=0&&(l="png"),n.Loader.loadBytes(e,function(n){if(!r.get(e))if(null!=n&&null!=n&&n.length>0){var a=new Image;a.addEventListener("load",function(n){if(!r.get(e)){var o=null;i==t.IMG_TYPE_TEX?o=new PIXI.Texture(new PIXI.BaseTexture(a)):i==t.IMG_TYPE_BASE?o=new PIXI.BaseTexture(a):i==t.IMG_TYPE_HTML&&(o=a),o&&r.set(e,o),s(o)}}),a.src="data:image/"+l.toLowerCase()+";base64,"+o.bytesToBase64(n)}else s(null)})}else s(a)}},t.prototype.bytesToBase64=function(t){for(var e,i,n,s,o,r,a,l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",u="",h=0;h<t.length;)s=(e=t[h++])>>2,o=(3&e)<<4|(i=h<t.length?t[h++]:Number.NaN)>>4,r=(15&i)<<2|(n=h<t.length?t[h++]:Number.NaN)>>6,a=63&n,isNaN(i)?r=a=64:isNaN(n)&&(a=64),u+=l.charAt(s)+l.charAt(o)+l.charAt(r)+l.charAt(a);return u},t.IMG_TYPE_TEX=0,t.IMG_TYPE_BASE=1,t.IMG_TYPE_HTML=2,t}();e.Texture=s}),System.registerDynamic("oge2d/library/script.js",[],!0,function(t,e,i){"use strict";this||self;var n=e&&e.__spreadArrays||function(){for(var t=0,e=0,i=arguments.length;e<i;e++)t+=arguments[e].length;var n=Array(t),s=0;for(e=0;e<i;e++)for(var o=arguments[e],r=0,a=o.length;r<a;r++,s++)n[s]=o[r];return n};Object.defineProperty(e,"__esModule",{value:!0}),e.Script=void 0;var s=function(){function t(){this.name="script",this._games=new Map,this._scenes=new Map,this._sprites=new Map,this._modules=new Map}return t.prototype.getClassName=function(t){for(var e="",i=t,n="?",s="",o=0;o<i.length;o++)s=i.charAt(o),0==/[^a-zA-Z0-9]/.test(s)&&(0==/[^a-zA-Z0-9]/.test(n)?e+=s:e+=s.toUpperCase()),n=s;return e},t.prototype.getValidClassNameFromModule=function(t,e){var i=t||null;if(!e)return i;if(e.hasOwnProperty(i))return i;for(var n=0,s=Object.keys(e);n<s.length;n++){var o=s[n];if(o&&"function"==typeof e[o]){i=o;break}}return i||null},t.prototype.loadGameScript=function(t,e,i){var n=this,s="games/"+e+".js",o=this._games.get(s);if(null==o||null==o){var r="Game"+this.getClassName(e),a=this._modules.get(s);if(null!=a&&null!=a)if(r=this.getValidClassNameFromModule(r,a),a.hasOwnProperty(r)){var l=Object.create(a[r].prototype);l.constructor.apply(l,[]),l.helper=this,this._games.set(s,l),i(l)}else i(null);else t.import(s).then(function(t){if(t&&n._modules.set(s,t),r=n.getValidClassNameFromModule(r,t),t&&t.hasOwnProperty(r)){var e=Object.create(t[r].prototype);e.constructor.apply(e,[]),e.helper=n,n._games.set(s,e),i(e)}else i(null)}).catch(function(t){console.error("Failed to load game script:"),console.error(t),i(null)})}else i(o)},t.prototype.loadSceneScript=function(t,e,i){var n=this,s="scenes/"+e+"/"+e+".js",o=this._scenes.get(s);if(null==o||null==o){var r="Scene"+this.getClassName(e),a=this._modules.get(s);if(null!=a&&null!=a)if(r=this.getValidClassNameFromModule(r,a),a.hasOwnProperty(r)){var l=Object.create(a[r].prototype);l.constructor.apply(l,[]),l.helper=this,this._scenes.set(s,l),i(l)}else i(null);else t.import(s).then(function(t){if(t&&n._modules.set(s,t),r=n.getValidClassNameFromModule(r,t),t&&t.hasOwnProperty(r)){var e=Object.create(t[r].prototype);e.constructor.apply(e,[]),e.helper=n,n._scenes.set(s,e),i(e)}else i(null)}).catch(function(t){console.error("Failed to load scene ["+e+"] script:"),console.error(t),i(null)})}else i(o)},t.prototype.loadSpriteScript=function(t,e,i){var n=this,s="sprites/"+e+".js",o=this._sprites.get(s);if(null==o||null==o){var r="Sprite"+this.getClassName(e),a=this._modules.get(s);if(null!=a&&null!=a)if(r=this.getValidClassNameFromModule(r,a),a.hasOwnProperty(r)){var l=Object.create(a[r].prototype);l.constructor.apply(l,[]),l.helper=this,this._sprites.set(s,l),i(l)}else i(null);else t.import(s).then(function(t){if(t&&n._modules.set(s,t),r=n.getValidClassNameFromModule(r,t),t&&t.hasOwnProperty(r)){var e=Object.create(t[r].prototype);e.constructor.apply(e,[]),e.helper=n,n._sprites.set(s,e),i(e)}else i(null)}).catch(function(t){console.error("Failed to load sprite ["+e+"] script:"),console.error(t),i(null)})}else i(o)},t.prototype.loadSceneSpriteScript=function(t,e,i,n){var s=this,o="scenes/"+e+"/sprites/"+i+".js",r="Scene"+this.getClassName(e)+"Sprite"+this.getClassName(i),a=this._modules.get(o);if(null!=a&&null!=a)if(r=this.getValidClassNameFromModule(r,a),a.hasOwnProperty(r)){var l=Object.create(a[r].prototype);l.constructor.apply(l,[]),l.helper=this,n(l)}else n(null);else t.import(o).then(function(t){if(t&&s._modules.set(o,t),r=s.getValidClassNameFromModule(r,t),t&&t.hasOwnProperty(r)){var e=Object.create(t[r].prototype);e.constructor.apply(e,[]),e.helper=s,n(e)}else n(null)}).catch(function(t){console.error("Failed to load scene sprite ["+e+" - "+i+"] script:"),console.error(t),n(null)})},t.prototype.get=function(t,e){return t?null!=t[e]?t[e]:this.get(t.base,e):null},t.prototype.set=function(t,e,i){return!!t&&(null!=t[e]?t[e]=i:this.set(t.base,e,i),!0)},t.prototype.call=function(t,e){for(var i=[],s=2;s<arguments.length;s++)i[s-2]=arguments[s];if(t)return t[e]?t[e].apply(t,i):this.call.apply(this,n([t.base,e],i))},t.prototype.proxy=function(t){var e=null;if(t&&t.helper){var i=window;i&&i.Proxy&&(e=new i.Proxy(t,{get:function(t,e){return t.helper.get(t,e)},set:function(t,e,i){return t.helper.set(t,e,i)}}))}return e},t}();e.Script=s}),System.registerDynamic("oge2d/library/loader.js",[],!0,function(t,e,i){"use strict";this||self;Object.defineProperty(e,"__esModule",{value:!0}),e.Block=e.Loader=void 0;var n=function(){function t(){}return t.loadText=function(e,i){var n=t._cache.get(e);if(n&&n.text)i(n.text);else{var s=new XMLHttpRequest;s.open("GET",e,!0),s.onload=function(t){var e=(s.status+"")[0];if("0"!==e&&"2"!==e&&"3"!==e)i("");else{var n=s.responseText;i(null!=n&&null!=n?n:"")}},s.onerror=function(){i("")},s.send()}},t.loadBuffer=function(e,i){var n=t._cache.get(e);if(n&&n.buffer)i(n.buffer);else{var s=new XMLHttpRequest;s.open("GET",e,!0),s.responseType="arraybuffer",s.onload=function(t){var e=(s.status+"")[0];i("0"!==e&&"2"!==e&&"3"!==e?null:s.response)},s.onerror=function(){i(null)},s.send()}},t.loadBytes=function(e,i){var n=t._cache.get(e);if(n&&n.u8array)i(n.u8array);else{var s=new XMLHttpRequest;s.open("GET",e,!0),s.responseType="arraybuffer",s.onload=function(t){var e=(s.status+"")[0];i("0"!==e&&"2"!==e&&"3"!==e?null:new Uint8Array(s.response))},s.onerror=function(){i(null)},s.send()}},t.loadPackContent=function(e,i,n){var o=t._loadingPacks.get(e),r=o&&o.length>0?o.shift():null;r?r.getData(new zip.BlobWriter("application/octet-binary"),function(o){var a=new s;a.blob=o,t._cache.set(r.filename,a),i.set(r.filename,a);var l="",u=r.filename.indexOf(".");u>0&&(l=r.filename.substr(u).toLowerCase()),".png"==l||".jpg"==l||".jpeg"==l||".gif"==l||".bmp"==l?t.blobToBytes(a.blob,function(s){a.blob=null,a.u8array=s,t.loadPackContent(e,i,n)}):".mp3"==l||".m4a"==l||".ogg"==l||".aac"==l||".wav"==l?t.blobToBuffer(a.blob,function(s){a.blob=null,a.buffer=s,t.loadPackContent(e,i,n)}):".json"==l||".js"==l||".html"==l||".css"==l||".txt"==l?t.blobToText(a.blob,function(s){a.blob=null,a.text=s,t.loadPackContent(e,i,n)}):t.loadPackContent(e,i,n)},function(t,e){}):n(i)},t.loadPack=function(e,i){var n=new Map,s=new XMLHttpRequest;s.open("GET",e,!0),s.responseType="arraybuffer",s.onload=function(o){var r=(s.status+"")[0];if("0"!==r&&"2"!==r&&"3"!==r)i(null);else{var a=new Uint8Array(s.response);if(e.indexOf(".data")>0)for(var l=[111,103,101,50,100],u=0;u<a.length;u++)a[u]=a[u]^l[u%l.length];zip.createReader(new zip.BlobReader(new Blob([a])),function(s){s.getEntries(function(o){if(null==o||null==o||o.length<=0)return s.close(),void i(null);t._loadingPacks.set(e,[]);for(var r=0,a=o;r<a.length;r++){var l=a[r];t._loadingPacks.get(e).push(l)}t.loadPackContent(e,n,function(t){s.close(),i(t)})})},function(t){console.error(t),i(null)})}},s.onerror=function(){i(null)},s.send()},t.stringToUtf8ByteArray=function(t){for(var e=[],i=0,n=0;n<t.length;n++){var s=t.charCodeAt(n);s<128?e[i++]=s:s<2048?(e[i++]=s>>6|192,e[i++]=63&s|128):55296==(64512&s)&&n+1<t.length&&56320==(64512&t.charCodeAt(n+1))?(s=65536+((1023&s)<<10)+(1023&t.charCodeAt(++n)),e[i++]=s>>18|240,e[i++]=s>>12&63|128,e[i++]=s>>6&63|128,e[i++]=63&s|128):(e[i++]=s>>12|224,e[i++]=s>>6&63|128,e[i++]=63&s|128)}return e},t.utf8ByteArrayToString=function(t){for(var e=[],i=0,n=0;i<t.length;){var s=t[i++];if(s<128)e[n++]=String.fromCharCode(s);else if(s>191&&s<224){var o=t[i++];e[n++]=String.fromCharCode((31&s)<<6|63&o)}else if(s>239&&s<365){var r=((7&s)<<18|(63&(o=t[i++]))<<12|(63&(a=t[i++]))<<6|63&t[i++])-65536;e[n++]=String.fromCharCode(55296+(r>>10)),e[n++]=String.fromCharCode(56320+(1023&r))}else{o=t[i++];var a=t[i++];e[n++]=String.fromCharCode((15&s)<<12|(63&o)<<6|63&a)}}return e.join("")},t.blobToBuffer=function(t,e){var i=new FileReader;i.onload=function(){return e(i.result)},i.readAsArrayBuffer(t)},t.blobToBytes=function(e,i){return t.blobToBuffer(e,function(t){return i(new Uint8Array(t))})},t.blobToText=function(e,i){return t.blobToBytes(e,function(e){return i(t.utf8ByteArrayToString(e))})},t._cache=new Map,t._loadingPacks=new Map,t}();e.Loader=n;var s=function(){return function(){this.blob=null,this.text=null,this.u8array=null,this.buffer=null}}();e.Block=s}),System.registerDynamic("oge2d/library/preload.js",["./loader"],!0,function(t,e,i){"use strict";this||self;Object.defineProperty(e,"__esModule",{value:!0}),e.Preload=void 0;var n=t("./loader"),s=function(){function t(){this._setting=null,this._contents=[],this._loadingPacks=[],this._libraries={}}return t.prototype.preload=function(t,e,i,n){this.prepare(t)>0?this.load(e,i,n):i()},t.prototype.prepare=function(t){if(null==t||null==t)return 0;this._setting=t,this._contents=Object.keys(t),this.total=0,this.current=0;for(var e=0,i=this._contents;e<i.length;e++){var n=i[e];"musics"==n?this.total+=this._setting.musics.length:"sounds"==n?this.total+=this._setting.sounds.length:"images"==n&&(this.total+=this._setting.images.length)}return this.total},t.prototype.load=function(t,e,i){null!=this._setting&&null!=this._setting&&null!=t&&null!=t?(this._libraries=t,this.loadOneByOne(e,i)):e()},t.prototype.loadOneByOne=function(t,e){var i=this;if(this._contents.length<=0)t();else{var n=this._contents.shift();if("musics"==n){for(var s=[],o=0,r=this._setting.musics;o<r.length;o++){var a=r[o];s.push("audio/musics/"+a+(a.indexOf(".")>=0?"":".mp3"))}this._libraries.audio.loadMusics(s,function(n){return i.loadOneByOne(t,e)},function(t,n){i.current++,e&&e(i.current,i.total)})}else if("sounds"==n){s=[];for(var l=0,u=this._setting.sounds;l<u.length;l++){var h=u[l];s.push("audio/sounds/"+h+(h.indexOf(".")>=0?"":".mp3"))}this._libraries.audio.loadSounds(s,function(n){return i.loadOneByOne(t,e)},function(t,n){i.current++,e&&e(i.current,i.total)})}else if("images"==n){s=[];for(var p=0,c=this._setting.images;p<c.length;p++){var d=c[p];s.push("img/"+d+(d.indexOf(".")>=0?"":".png"))}this._libraries.image.loadImages(s,function(n){return i.loadOneByOne(t,e)},function(t,n){i.current++,e&&e(i.current,i.total)})}else if("jsons"==n){s=[];for(var f=0,m=this._setting.jsons;f<m.length;f++){var g=m[f];s.push("json/"+g+(g.indexOf(".")>=0?"":".json"))}this._libraries.json.loadJsons(s,function(n){return i.loadOneByOne(t,e)},function(t,n){i.current++,e&&e(i.current,i.total)})}else this.loadOneByOne(t,e)}},t.prototype.loadPack=function(t,e){n.Loader.loadPack(t,e)},t.prototype.loadPacks=function(t,e,i){var n;this._loadingPacks=[],(n=this._loadingPacks).push.apply(n,t),this.totalPackCount=this._loadingPacks.length,this.loadedPackCount=0,this.loadPacksOneByOne(e,i)},t.prototype.loadPacksOneByOne=function(t,e){var i=this;if(this._loadingPacks.length<=0)t();else{var n=this._loadingPacks.shift();this.loadPack(n,function(s){i.loadedPackCount++,e(i.loadedPackCount,i.totalPackCount,n),i.loadPacksOneByOne(t,e)})}},t}();e.Preload=s}),System.registerDynamic("oge2d-main.js",["./oge2d/core/app","./oge2d/system/display","./oge2d/system/stage","./oge2d/system/tween","./oge2d/system/transition","./oge2d/system/motion","./oge2d/system/collision","./oge2d/system/mouse","./oge2d/system/keyboard","./oge2d/system/event-loop","./oge2d/library/json","./oge2d/library/audio","./oge2d/library/texture","./oge2d/library/script","./oge2d/library/preload"],!0,function(t,e,i){"use strict";this||self;Object.defineProperty(e,"__esModule",{value:!0}),e.app=void 0;var n=t("./oge2d/core/app"),s=t("./oge2d/system/display"),o=t("./oge2d/system/stage"),r=t("./oge2d/system/tween"),a=t("./oge2d/system/transition"),l=t("./oge2d/system/motion"),u=t("./oge2d/system/collision"),h=t("./oge2d/system/mouse"),p=t("./oge2d/system/keyboard"),c=t("./oge2d/system/event-loop"),d=t("./oge2d/library/json"),f=t("./oge2d/library/audio"),m=t("./oge2d/library/texture"),g=t("./oge2d/library/script"),y=t("./oge2d/library/preload");e.app=new n.App({systems:{display:new s.Display,stage:new o.Stage,tween:new r.Tween,transition:new a.Transition,motion:new l.Motion,collision:new u.Collision,mouse:new h.Mouse,keyboard:new p.Keyboard,event:new c.EventLoop},libraries:{json:new d.Json,audio:new f.Audio,image:new m.Texture,script:new g.Script,preload:new y.Preload}})});